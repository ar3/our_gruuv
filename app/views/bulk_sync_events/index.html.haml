- content_for :go_back_link do
  = link_to organization_employees_path(current_organization), class: "go-back-link" do
    %i.bi.bi-arrow-left.me-2
    Back to #{current_organization.display_name} Teammates

- content_for :header do
  .d-flex.align-items-center
    %h1.mb-0.me-2 Bulk Sync Events
    .d-flex.align-items-center
      - if policy([BulkSyncEvent]).create?
        .dropdown
          %button#dropdownMenuButton.btn.btn-primary.dropdown-toggle.ml-2{"data-bs-toggle" => "dropdown", "aria-expanded" => "false", :type => "button"}
            %i.bi.bi-plus
          %ul.dropdown-menu{"aria-labelledby" => "dropdownMenuButton"}
            %li.dropdown-header Uploads
            %li
              = link_to "Upload Assignment Check-Ins", new_organization_bulk_sync_event_path(current_organization, bulk_sync_event: {type: 'BulkSyncEvent::UploadAssignmentCheckins'}), class: 'dropdown-item'
            %li
              = link_to "Upload Employee Positions", new_organization_bulk_sync_event_path(current_organization, bulk_sync_event: {type: 'BulkSyncEvent::UploadEmployees'}), class: 'dropdown-item'
            - if policy(current_organization).manage_maap?
              %li
                = link_to "Upload Assignments and Abilities", new_organization_bulk_sync_event_path(current_organization, bulk_sync_event: {type: 'BulkSyncEvent::UploadAssignmentsAndAbilities'}), class: 'dropdown-item'
              %li
                = link_to "Upload Assignments (Bulk)", new_organization_bulk_sync_event_path(current_organization, bulk_sync_event: {type: 'BulkSyncEvent::UploadAssignmentsBulk'}), class: 'dropdown-item'
            %li
              %hr.dropdown-divider
            %li.dropdown-header Syncs
            %li
              = link_to "Refresh People Names", new_organization_bulk_sync_event_path(current_organization, bulk_sync_event: {type: 'BulkSyncEvent::RefreshNamesSync'}), class: 'dropdown-item'
            %li
              = link_to "Refresh Slack Identities", new_organization_bulk_sync_event_path(current_organization, bulk_sync_event: {type: 'BulkSyncEvent::RefreshSlackSync'}), class: 'dropdown-item'
            %li
              = link_to "Ensure Assignment Tenures", new_organization_bulk_sync_event_path(current_organization, bulk_sync_event: {type: 'BulkSyncEvent::EnsureAssignmentTenuresSync'}), class: 'dropdown-item'
      - else
        .btn.btn-primary.disabled.ml-2{style: "opacity: 0.6; cursor: not-allowed;"}
          %i.bi.bi-plus
        %i.bi.bi-exclamation-triangle.text-warning.ms-2{"data-bs-toggle" => "tooltip", "data-bs-title" => "You need employment management permission to perform this action"}

- content_for :header_action do
  %button.btn.btn-outline-secondary{"data-bs-toggle" => "modal", "data-bs-target" => "#bulkSyncEventFilterModal", type: "button"}
    %i.bi.bi-funnel.me-2
    Filter & Sort

= render 'bulk_sync_events/spotlights/upload_data_overview'

.row.justify-content-center
  .col-lg-12
    - if @bulk_sync_events.any?
      .table-responsive
        %table.table.table-hover
          %thead
            %tr
              %th Created
              %th Source
              %th Type
              %th Status
              %th Creator
              %th Results
              %th Actions
          %tbody
            - @bulk_sync_events.each do |bulk_sync_event|
              %tr
                %td
                  %small.text-muted= format_date_in_user_timezone(bulk_sync_event.created_at, format: '%b %d, %Y')
                  %br
                  %small.text-muted= format_time_in_user_timezone(bulk_sync_event.created_at, format: '%I:%M %p')
                %td
                  - if bulk_sync_event.filename.present?
                    %code.small= bulk_sync_event.filename
                  - else
                    %span.text-muted.small= bulk_sync_event.source_info
                %td
                  %span{class: "badge bg-#{bulk_sync_event.type == 'BulkSyncEvent::UploadAssignmentCheckins' ? 'primary' : bulk_sync_event.type == 'BulkSyncEvent::UploadEmployees' ? 'success' : bulk_sync_event.type == 'BulkSyncEvent::UploadAssignmentsAndAbilities' ? 'info' : bulk_sync_event.type == 'BulkSyncEvent::RefreshNamesSync' ? 'info' : bulk_sync_event.type == 'BulkSyncEvent::EnsureAssignmentTenuresSync' ? 'info' : 'warning'}"}
                    = bulk_sync_event.display_name
                %td
                  %span{class: "badge bg-#{bulk_sync_event.status == 'completed' ? 'success' : bulk_sync_event.status == 'failed' ? 'danger' : bulk_sync_event.status == 'processing' ? 'warning' : 'secondary'}"}
                    = bulk_sync_event.status.humanize
                %td
                  %small= bulk_sync_event.creator.display_name
                %td
                  - if bulk_sync_event.completed?
                    %span.text-success.small
                      = "#{bulk_sync_event.success_count} success, #{bulk_sync_event.failure_count} failed"
                  - elsif bulk_sync_event.failed?
                    %span.text-danger.small
                      = "#{bulk_sync_event.failure_count} failed"
                  - elsif bulk_sync_event.processing?
                    %span.text-warning.small Processing...
                  - else
                    %span.text-muted.small Preview ready
                %td
                  .btn-group.btn-group-sm
                    = link_to organization_bulk_sync_event_path(current_organization, bulk_sync_event), class: "btn btn-outline-primary" do
                      %i.bi.bi-eye
                    = link_to organization_bulk_sync_event_path(current_organization, bulk_sync_event), method: :delete, class: "btn btn-outline-danger", data: { confirm: "Are you sure?" } do
                      %i.bi.bi-trash
    - else
      .alert.alert-info
        %h6.mb-2
          %i.bi.bi-info-circle.me-2
          No Bulk Sync Events Created
        %p.mb-2 Upload files or run syncs to manage data for your organization.
        = link_to "Create First Sync Event", new_organization_bulk_sync_event_path(current_organization, bulk_sync_event: {type: 'BulkSyncEvent::UploadAssignmentCheckins'}), class: "btn btn-primary btn-sm"

/ Modal for Filter & Sort
#bulkSyncEventFilterModal.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "bulkSyncEventFilterModalLabel", tabindex: "-1"}
  .modal-dialog.modal-lg
    .modal-content
      .modal-header
        %h5.modal-title#bulkSyncEventFilterModalLabel
          %i.bi.bi-funnel.me-2
          Filter & Sort Bulk Sync Events (coming soon)
        %button.btn-close{"aria-label" => "Close", "data-bs-dismiss" => "modal", type: "button"}
      .modal-body
        .row
          .col-md-6
            %h6.mb-3
              %i.bi.bi-funnel.me-2
              Filters
            .mb-3
              %label.form-label Sync Type
              %select.form-select
                %option All Types
                %option Assignment Check-Ins
                %option Employee Positions
                %option Refresh Names
                %option Refresh Slack
            .mb-3
              %label.form-label Status
              %select.form-select
                %option All Statuses
                %option Completed
                %option Processing
                %option Failed
                %option Preview Ready
            .mb-3
              %label.form-label Creator
              %select.form-select
                %option All Creators
                %option Current User
          .col-md-6
            %h6.mb-3
              %i.bi.bi-sort-down.me-2
              Sort Options
            .mb-3
              %label.form-label Sort By
              %select.form-select
                %option Created Date (Newest First)
                %option Created Date (Oldest First)
                %option Source (A-Z)
                %option Source (Z-A)
                %option Status
            .mb-3
              %label.form-label View Style
              .form-check
                %input.form-check-input{checked: "checked", type: "radio", name: "viewStyle", value: "table"}
                %label.form-check-label
                  %i.bi.bi-table.me-2
                  Table View
              .form-check
                %input.form-check-input{type: "radio", name: "viewStyle", value: "cards"}
                %label.form-check-label
                  %i.bi.bi-grid.me-2
                  Card View
              .form-check
                %input.form-check-input{type: "radio", name: "viewStyle", value: "list"}
                %label.form-check-label
                  %i.bi.bi-list.me-2
                  List View
            .mb-3
              %label.form-label Spotlight
              %select.form-select
                %option No Spotlight
                %option Recent Syncs (Last 7 Days)
                %option Failed Syncs
                %option Processing Syncs
      .modal-footer
        %button.btn.btn-secondary{"data-bs-dismiss" => "modal", type: "button"} Cancel
        %button.btn.btn-primary.disabled{type: "button"}
          %i.bi.bi-check.me-2
          Apply Filters
