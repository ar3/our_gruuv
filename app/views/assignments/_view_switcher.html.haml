- is_public_view = request.path.include?('/public_maap/assignments/')
- is_teammate_view = @teammate.present? && request.path.include?('/teammates/')
- is_person_view = @person.present? && !@teammate.present? && request.path.include?('/people/')
- is_ability_milestones_view = request.path.include?('/ability_milestones')
- is_consumer_assignments_view = request.path.include?('/consumer_assignments')
- is_edit_view = action_name == 'edit' && controller_name == 'assignments'
- is_organization_view = !is_public_view && !is_teammate_view && !is_person_view && !is_ability_milestones_view && !is_consumer_assignments_view && !is_edit_view && (@organization.present? || (@assignment && @assignment.company.present?))
- assignment_org = @organization || (@assignment&.company)

.dropdown
  %button.btn.btn-outline-primary.btn-sm.dropdown-toggle{"data-bs-toggle" => "dropdown", "aria-expanded" => "false", type: "button"}
    %i.bi.bi-eye.me-2
    = assignments_current_view_name
  %ul.dropdown-menu
    %li
      - if is_public_view
        .dropdown-item.text-muted
          %i.bi.bi-globe.me-2
          Public View (Active)
          %i.bi.bi-check-circle.text-success.ms-2
      - elsif @assignment && assignment_org
        = link_to organization_public_maap_assignment_path(assignment_org, @assignment), class: 'dropdown-item' do
          %i.bi.bi-globe.me-2
          Public View
      
    %li
      - if is_organization_view
        .dropdown-item.text-muted
          %i.bi.bi-building.me-2
          Organization View (Active)
          %i.bi.bi-check-circle.text-success.ms-2
      - elsif @assignment && assignment_org && policy(@assignment).show?
        = link_to organization_assignment_path(assignment_org, @assignment), class: 'dropdown-item' do
          %i.bi.bi-building.me-2
          Organization View
      - elsif @assignment && assignment_org
        .dropdown-item.text-muted.disabled
          %i.bi.bi-building.me-2
          Organization View
          %i.bi.bi-exclamation-triangle.text-warning.ms-2{"data-bs-toggle" => "tooltip", "data-bs-title" => "You must be in the organization hierarchy to view the organization version"}
      
    %li
      - if is_teammate_view
        .dropdown-item.text-muted
          %i.bi.bi-people.me-2
          Teammate View (Active)
          %i.bi.bi-check-circle.text-success.ms-2
      - elsif @assignment && @teammate && assignment_org && policy(@teammate.person).view_check_ins?
        = link_to organization_teammate_assignment_path(assignment_org, @teammate, @assignment), class: 'dropdown-item' do
          %i.bi.bi-people.me-2
          Teammate View
      - elsif @assignment && @teammate && assignment_org
        .dropdown-item.text-muted.disabled
          %i.bi.bi-people.me-2
          Teammate View
          %i.bi.bi-exclamation-triangle.text-warning.ms-2{"data-bs-toggle" => "tooltip", "data-bs-title" => "You need employment management permissions or to be in the managerial hierarchy to access teammate view features"}
      
    %li
      - if is_person_view
        .dropdown-item.text-muted
          %i.bi.bi-person.me-2
          Person View (Active)
          %i.bi.bi-check-circle.text-success.ms-2
      - elsif @assignment && @person && (policy(@person).view_check_ins? || policy(@person).public?)
        = link_to person_assignment_path(@person, @assignment), class: 'dropdown-item' do
          %i.bi.bi-person.me-2
          Person View
      - elsif @assignment && @person
        .dropdown-item.text-muted.disabled
          %i.bi.bi-person.me-2
          Person View
          %i.bi.bi-exclamation-triangle.text-warning.ms-2{"data-bs-toggle" => "tooltip", "data-bs-title" => "You need employment management permissions or to be in the managerial hierarchy to access person view features"}
    
    - if assignment_org && @assignment
      %li
        %hr.dropdown-divider
      
      %li
        - if is_ability_milestones_view
          .dropdown-item.text-muted
            %i.bi.bi-link-45deg.me-2
            Manage Ability Milestones (Active)
            %i.bi.bi-check-circle.text-success.ms-2
        - elsif @assignment && assignment_org && policy(@assignment).update?
          = link_to organization_assignment_ability_milestones_path(assignment_org, @assignment), class: 'dropdown-item' do
            %i.bi.bi-link-45deg.me-2
            Manage Ability Milestones
        - else
          .dropdown-item.text-muted.disabled
            %i.bi.bi-link-45deg.me-2
            Manage Ability Milestones
            %i.bi.bi-exclamation-triangle.text-warning.ms-2{"data-bs-toggle" => "tooltip", "data-bs-title" => "You need employment management permissions or admin access to manage ability milestones"}
      
      %li
        - if is_consumer_assignments_view
          .dropdown-item.text-muted
            %i.bi.bi-arrow-down-circle.me-2
            Manage Consumer Assignments (Active)
            %i.bi.bi-check-circle.text-success.ms-2
        - elsif @assignment && assignment_org && policy(@assignment).manage_consumer_assignments?
          = link_to organization_assignment_consumer_assignments_path(assignment_org, @assignment), class: 'dropdown-item' do
            %i.bi.bi-arrow-down-circle.me-2
            Manage Consumer Assignments
        - else
          .dropdown-item.text-muted.disabled
            %i.bi.bi-arrow-down-circle.me-2
            Manage Consumer Assignments
            %i.bi.bi-exclamation-triangle.text-warning.ms-2{"data-bs-toggle" => "tooltip", "data-bs-title" => "Requires manage MAAP permission"}
      
      %li
        - if is_edit_view
          .dropdown-item.text-muted
            %i.bi.bi-pencil.me-2
            Edit Assignment (Active)
            %i.bi.bi-check-circle.text-success.ms-2
        - elsif @assignment && assignment_org && policy(@assignment).update?
          = link_to edit_organization_assignment_path(assignment_org, @assignment), class: 'dropdown-item' do
            %i.bi.bi-pencil.me-2
            Edit Assignment
        - else
          .dropdown-item.text-muted.disabled
            %i.bi.bi-pencil.me-2
            Edit Assignment
            %i.bi.bi-exclamation-triangle.text-warning.ms-2{"data-bs-toggle" => "tooltip", "data-bs-title" => "You need employment management permissions or admin access to edit assignments"}
      
      %li
        %hr.dropdown-divider
      
      %li
        - if @assignment && assignment_org && policy(@assignment).destroy?
          = link_to organization_assignment_path(assignment_org, @assignment), 
            method: :delete, 
            data: { confirm: "Are you sure you want to delete this assignment?" }, 
            class: 'dropdown-item text-danger' do
            %i.bi.bi-trash.me-2
            Delete Assignment
        - else
          .dropdown-item.text-muted.disabled.text-danger
            %i.bi.bi-trash.me-2
            Delete Assignment
            %i.bi.bi-exclamation-triangle.text-warning.ms-2{"data-bs-toggle" => "tooltip", "data-bs-title" => "Only admins can delete assignments"}

