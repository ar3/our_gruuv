.container.mt-4
  .row
    .col-12
      .d-flex.justify-content-between.align-items-center.mb-4
        %h1 Huddle Summary
        = link_to "← Back to Huddle", huddle_path(@huddle), class: "btn btn-outline-secondary"
      
      .card.mb-4
        .card-header
          %h2.mb-0= @huddle.display_name
        .card-body
          .row
            .col-md-6
              %p
                %strong Organization:
                = @huddle.organization.display_name
              %p
                %strong Started:
                = @huddle.started_at.strftime('%B %d, %Y at %I:%M %p')
              %p
                %strong Status:
                - if @huddle.closed?
                  %span.badge.bg-secondary Closed
                - else
                  %span.badge.bg-success Active
            .col-md-6
              %p
                %strong Participants:
                = @huddle.huddle_participants.count
              %p
                %strong Feedback Submitted:
                = @huddle.huddle_feedbacks.count
              %p
                %strong Participation Rate:
                %span.badge.bg-info= "#{@huddle.participation_rate}%"
      
      - if @huddle.huddle_feedbacks.any?
        .row
          .col-md-6
            .card.mb-4
              .card-header
                %h3.mb-0 Average Ratings
              .card-body
                - ratings = @huddle.average_rating_by_category
                - if ratings.any?
                  .row
                    .col-6
                      %p
                        %strong Informed:
                        %span.badge.bg-primary= ratings[:informed]
                      %p
                        %strong Connected:
                        %span.badge.bg-success= ratings[:connected]
                    .col-6
                      %p
                        %strong Goals:
                        %span.badge.bg-warning= ratings[:goals]
                      %p
                        %strong Valuable:
                        %span.badge.bg-info= ratings[:valuable]
                  
                  .mt-3
                    %h4 Overall Score
                    %h2.text-center.text-primary= @huddle.nat_20_score
                    %p.text-center.text-muted Nat 20 Score
                - else
                  %p.text-muted No ratings available
          
          .col-md-6
            .card.mb-4
              .card-header
                %h3.mb-0 Insights
              .card-body
                - insights = @huddle.feedback_insights
                - if insights.any?
                  %ul.list-unstyled
                    - insights.each do |insight|
                      %li.mb-2
                        %i.bi.bi-lightbulb.me-2
                        = insight
                - else
                  %p.text-muted No insights available yet
        
        .row
          .col-12
            .card.mb-4
              .card-header
                %h3.mb-0 Feedback Highlights
              .card-body
                - appreciations = @huddle.huddle_feedbacks.where.not(appreciation: [nil, '']).limit(3)
                - if appreciations.any?
                  %h5 What went well:
                  - appreciations.each do |feedback|
                    .alert.alert-success
                      %i.bi.bi-heart.me-2
                      = feedback.appreciation
                
                - suggestions = @huddle.huddle_feedbacks.where.not(change_suggestion: [nil, '']).limit(3)
                - if suggestions.any?
                  %h5.mt-3 Improvement suggestions:
                  - suggestions.each do |feedback|
                    .alert.alert-warning
                      %i.bi.bi-lightbulb.me-2
                      = feedback.change_suggestion
                
                - if appreciations.empty? && suggestions.empty?
                  %p.text-muted No detailed feedback available yet
      - else
        .card.mb-4
          .card-body.text-center
            %h3.text-muted No feedback submitted yet
            %p.mb-4 This huddle summary will populate once participants submit feedback.
            = link_to "Submit Feedback", feedback_huddle_path(@huddle), class: "btn btn-primary"
      
      .d-flex.justify-content-between
        = link_to "← Back to Huddle", huddle_path(@huddle), class: "btn btn-outline-secondary"
        = link_to "View All My Huddles", my_huddles_path, class: "btn btn-outline-primary" 