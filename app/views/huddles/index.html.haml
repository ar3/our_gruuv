.container
  .row
    .col-12
      %h1.mb-4 Nat 20 Huddles
      %p.lead Help your team find their groove with structured feedback and continuous improvement.
      
      .d-flex.justify-content-between.align-items-center.mb-4
        %h2 Today's Huddles
        = link_to "Start New Huddle", new_huddle_path, class: "btn btn-primary"
      
      - if @huddles.any?
        .row
          - @huddles.each do |huddle|
            - if current_person && huddle.huddle_participants.find_by(person: current_person)
              = render 'huddle_card', huddle: huddle
            - else
              .col-md-6.col-lg-4.mb-3
                .card.h-100
                  .card-body.position-relative
                    .position-absolute.top-0.end-0.p-2
                      %button.btn.btn-link.btn-sm.text-muted.share-huddle-btn{data: {huddle_id: huddle.id, join_url: join_huddle_url(huddle)}, title: "Share this huddle"}
                        %i.bi.bi-link-45deg
                    %h5.card-title= huddle.display_name
                    %p.card-text
                      %strong Organization:
                      = huddle.organization.display_name
                    %p.card-text
                      %small.text-muted
                        Started: #{format_time_in_user_timezone(huddle.started_at)}
                    - if huddle.nat_20_score
                      %p.card-text
                        %strong Nat 20 Score:
                        %span.badge.bg-success= huddle.nat_20_score
                    .mt-auto
                      = link_to "Join Huddle", join_huddle_path(huddle), class: "btn btn-outline-primary btn-sm"
      - else
        .text-center.py-5
          %h3.text-muted No huddles today
          %p.mb-4 Be the first to start a Nat 20 Huddle today!
          = link_to "Start Your First Huddle", new_huddle_path, class: "btn btn-primary btn-lg"
