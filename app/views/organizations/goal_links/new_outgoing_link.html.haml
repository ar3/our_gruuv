- content_for :title, "Create New Child Goals"

- content_for :header do
  - goal_type_labels = { 'stepping_stone_activity' => 'stepping stones/activities', 'quantitative_key_result' => 'measurable outcomes', 'qualitative_key_result' => 'sentiment outcomes', 'inspirational_objective' => 'objectives' }
  - goal_type_label = goal_type_labels[@goal_type] || 'goals'
  In pursuit of "#{@goal.title}", add #{goal_type_label} that need to happen in order to achieve this goal.

- content_for :return_url do
  = @return_url || organization_goal_path(@organization, @goal)

- content_for :return_text do
  = @return_text || "Back to the #{@goal.title} goal"

- goal_type_labels = { 'stepping_stone_activity' => 'stepping stones/activities', 'quantitative_key_result' => 'measurable outcomes', 'qualitative_key_result' => 'sentiment outcomes', 'inspirational_objective' => 'objectives' }
- goal_type_singular_labels = { 'stepping_stone_activity' => 'stepping stone/activity', 'quantitative_key_result' => 'measurable outcome', 'qualitative_key_result' => 'sentiment outcome', 'inspirational_objective' => 'objective' }
- goal_type_label = goal_type_labels[@goal_type] || 'goals'
- goal_type_singular_label = goal_type_singular_labels[@goal_type] || 'goal'

.card.mb-3
  .card-header
    %h5.mb-0
      %i.bi.bi-link-45deg.me-2
      Create new #{goal_type_label}
      %small.text-muted.ms-2
        Each new goal will become a #{goal_type_singular_label} of this goal.
  .card-body
    = form_with url: organization_goal_goal_links_path(@organization, @goal), method: :post, local: true do |f|
      = hidden_field_tag :link_direction, 'outgoing'
      = hidden_field_tag :goal_type, @goal_type
      = hidden_field_tag :return_url, @return_url
      = hidden_field_tag :return_text, @return_text

      .mb-4
        %label.form-label.fw-bold
          Create New #{goal_type_label.humanize}
          %i.bi.bi-info-circle.text-muted.ms-2{
            "data-bs-toggle" => "tooltip",
            "data-bs-title" => "Create nested goals: Regular lines create goals. Lines starting with numbers, *, •, -, –, or .. create sub-goals linked to the previous goal. A goal followed by sub-goals becomes an objective."
          }
        %small.text-muted.d-block.mb-2
          Enter one goal title per line. Each will become a new #{goal_type_singular_label} goal linked to this goal.
        = text_area_tag "bulk_goal_titles", "", rows: 5, class: "form-control", placeholder: "Goal 1\nGoal 2\nObjective 3\n* Key Result 3-1\n* Key Result 3-2\n* Key Result 3-3\nObjective 4\n1. Step 4-1\n2. Step 4-2\n3. Step 4-3"
        %small.form-text.text-muted
          New goals will match the owner and privacy level of this goal.

      .mb-3
        %label.form-label
          Notes
          %small.text-muted (Optional)
        = text_area_tag "metadata_notes", "", rows: 3, class: "form-control", placeholder: "Add any notes about these links..."

      .d-flex.gap-2.mt-3
        = link_to @return_url, class: 'btn btn-outline-secondary' do
          %i.bi.bi-arrow-left.me-1
          = @return_text || 'Cancel'
        = f.submit 'Create and associate goals', class: 'btn btn-primary', id: 'create-and-associate-outgoing-btn', data: { test_id: 'create-and-associate-outgoing' }

