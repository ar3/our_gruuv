- content_for :header do
  .d-flex.align-items-center
    %h1.mb-0.me-2
      %i.bi.bi-people.me-2
      Teammates
    .d-flex.align-items-center
      - if policy(@organization).manage_employment?
        = link_to new_employee_organization_employees_path(@organization), class: "btn btn-primary ml-2" do
          %i.bi.bi-plus
      - else
        .btn.btn-primary.disabled{style: "opacity: 0.6; cursor: not-allowed;"}
          %i.bi.bi-plus
        %i.bi.bi-exclamation-triangle.text-warning.ms-2{"data-bs-toggle" => "tooltip", "data-bs-title" => "You need employment management permission to add teammates"}

.mb-4
  = content_for :go_back_link  # Single back link to dashboard

- content_for :go_back_link do
  = link_to organization_path(@organization), class: "go-back-link" do
    %i.bi.bi-arrow-left.me-2
    Back to #{@organization.display_name}

- content_for :header_action do
  - customize_params = params.except(:controller, :action, :page).permit!.to_h
  = link_to customize_view_organization_employees_path(@organization, customize_params), class: "btn btn-outline-secondary" do
    %i.bi.bi-sliders.me-2
    Customize View

/ Spotlight Section
- case @current_spotlight
- when 'manager_overview'
  = render 'organizations/employees/spotlights/manager_overview'
- when 'teammate_tenures'
  = render 'organizations/employees/spotlights/teammate_tenures'
- when 'employee_locations'
  = render 'organizations/employees/spotlights/employee_locations'
- when 'manager_distribution'
  = render 'organizations/employees/spotlights/manager_distribution'
- when 'check_ins_health'
  = render 'organizations/employees/spotlights/check_ins_health'
- else
  = render 'organizations/employees/spotlights/teammates_overview'

/ Active Filters Display
- if @has_active_filters && 1 == 2 # TODO: Make this work and when it works, show this section.
  .row.justify-content-center.mb-3
    .col-lg-12
      .d-flex.flex-wrap.gap-2.align-items-center
        %span.text-muted.me-2 Active Filters:
        - @current_filters.each do |filter_name, filter_value|
          - Array(filter_value).each do |value|
            %span.badge.bg-primary.d-flex.align-items-center.gap-1
              = filter_display_name(filter_name, value)
              = link_to "Ã—", clear_filter_url(filter_name, value), class: "text-white text-decoration-none ms-1"
        = link_to "Clear All", organization_employees_path(@organization), class: "btn btn-sm btn-outline-secondary"

/ Pagination Info
.row.justify-content-center.mb-2
  .col-lg-12
    .d-flex.justify-content-between.align-items-center
      %small.text-muted= raw pagy_info(@pagy)
      - if @filtered_and_paginated_teammates.count > 0 || (@current_view == 'check_ins_health' && @filtered_and_paginated_employee_health_data&.any?)
        %small.text-muted Showing #{@current_view.humanize} view

/ Main Content Area
.row.justify-content-center
  .col-lg-12
    - if @current_view == 'check_ins_health'
      - if @filtered_and_paginated_employee_health_data&.any?
        = render 'organizations/employees/displays/check_ins_health'
      - else
        .alert.alert-info
          %h6.mb-2
            %i.bi.bi-info-circle.me-2
            No Active Employees Found
          %p.mb-2
            This organization doesn't have any active employees yet.
      
      / Pagination
      .d-flex.justify-content-center.mt-4
        - if @pagy.pages > 1
          = raw pagy_nav(@pagy)
    - elsif @current_view == 'vertical_hierarchy'
      = render 'organizations/employees/displays/vertical_hierarchy'
    - elsif @filtered_and_paginated_teammates.any?
      - case @current_view
      - when 'check_in_status'
        = render 'organizations/employees/displays/check_in_status'
      - when 'cards'
        = render 'organizations/employees/card_view'
      - when 'list'
        = render 'organizations/employees/list_view'
      - else
        = render 'organizations/employees/table_view'
      
      / Pagination
      .d-flex.justify-content-center.mt-4
        - if @pagy.pages > 1
          = raw pagy_nav(@pagy)
    - else
      .alert.alert-info
        %h6.mb-2
          %i.bi.bi-info-circle.me-2
          No Teammates Found
        %p.mb-2 
          - if @has_active_filters
            No teammates match your current filters. Try adjusting your filter settings.
          - else
            This organization doesn't have any teammates yet. Teammates include employees, followers, and other people with access to the organization.
        - unless @has_active_filters
          = link_to "Add First Teammate", new_employee_organization_employees_path(@organization), class: "btn btn-primary btn-sm"
