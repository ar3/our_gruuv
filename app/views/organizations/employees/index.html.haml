- content_for :header do
  .d-flex.align-items-center
    %h1.mb-0.me-2
      %i.bi.bi-people.me-2
      Teammates
    .d-flex.align-items-center
      - if current_person.can_manage_employment?(@organization)
        = link_to new_employee_organization_employees_path(@organization), class: "btn btn-primary ml-2" do
          %i.bi.bi-plus
      - else
        .btn.btn-primary.disabled{style: "opacity: 0.6; cursor: not-allowed;"}
          %i.bi.bi-plus
        %i.bi.bi-exclamation-triangle.text-warning.ms-2{"data-bs-toggle" => "tooltip", "data-bs-title" => "You need employment management permission to add teammates"}

.mb-4
  = content_for :go_back_link  # Single back link to dashboard

- content_for :go_back_link do
  = link_to organization_path(@organization), class: "go-back-link" do
    %i.bi.bi-arrow-left.me-2
    Back to #{@organization.display_name}

- content_for :header_action do
  %button.btn.btn-outline-secondary{"data-bs-toggle" => "modal", "data-bs-target" => "#teammates-filter-modal", type: "button"}
    %i.bi.bi-funnel.me-2
    Filter & Sort

/ Spotlight Section
= render 'organizations/employees/spotlights/teammates_overview'

/ Main Content Area
.row.justify-content-center
  .col-lg-12
    - if @teammates.any?
      .table-responsive
        %table.table.table-hover
          %thead
            %tr
              %th Name
              %th Organization
              %th Employment Status
              %th Position
              %th Permissions
              %th Employment Dates
              %th Actions
          %tbody
            - @teammates.each do |teammate|
              %tr
                %td
                  = link_to teammate.person.display_name, teammate_organization_person_path(@organization, teammate.person), class: "text-decoration-none fw-bold"
                  %br
                  %small.text-muted= teammate.person.email
                %td
                  = teammate_organization_display(teammate)
                %td
                  = employment_status_badge(teammate)
                  %br
                  = employment_status_progress_bar(teammate)
                %td
                  = teammate_current_position(teammate)
                %td
                  = teammate_permissions_badges(teammate)
                %td
                  %small.text-muted= teammate_employment_dates(teammate)
                %td
                  .btn-group.btn-group-sm
                    = link_to teammate_organization_person_path(@organization, teammate.person), class: "btn btn-outline-primary" do
                      %i.bi.bi-eye
                    - if current_person.can_manage_employment?(@organization)
                      = link_to organization_assignment_tenure_path(@organization, teammate.person), class: "btn btn-outline-secondary" do
                        %i.bi.bi-list-task
    - else
      .alert.alert-info
        %h6.mb-2
          %i.bi.bi-info-circle.me-2
          No Teammates Found
        %p.mb-2 
          This organization doesn't have any teammates yet. Teammates include employees, followers, and other people with access to the organization.
        = link_to "Add First Teammate", new_employee_organization_employees_path(@organization), class: "btn btn-primary btn-sm"

/ Modal for Filter & Sort
.modal.fade#teammates-filter-modal{"aria-hidden" => "true", "aria-labelledby" => "teammates-filter-modal-label", tabindex: "-1"}
  .modal-dialog.modal-lg
    .modal-content
      .modal-header
        %h5.modal-title#teammates-filter-modal-label
          %i.bi.bi-funnel.me-2
          Filter & Sort Teammates (coming soon)
        %button.btn-close{"aria-label" => "Close", "data-bs-dismiss" => "modal", type: "button"}
      .modal-body
        .row
          .col-md-6
            %h6.mb-3
              %i.bi.bi-funnel.me-2
              Filters
            .form-check
              %input.form-check-input{type: "checkbox", name: "statusFilter", value: "followers", id: "filter_followers"}
              %label.form-check-label{for: "filter_followers"}
                %i.bi.bi-person-follow.me-2
                Followers
            .form-check
              %input.form-check-input{type: "checkbox", name: "statusFilter", value: "huddlers", id: "filter_huddlers"}
              %label.form-check-label{for: "filter_huddlers"}
                %i.bi.bi-people.me-2
                Huddlers
            .form-check
              %input.form-check-input{type: "checkbox", name: "statusFilter", value: "unassigned", id: "filter_unassigned"}
              %label.form-check-label{for: "filter_unassigned"}
                %i.bi.bi-person-exclamation.me-2
                Unassigned Employees
            .form-check
              %input.form-check-input{type: "checkbox", name: "statusFilter", value: "assigned", id: "filter_assigned"}
              %label.form-check-label{for: "filter_assigned"}
                %i.bi.bi-person-check.me-2
                Active Employees
            .form-check
              %input.form-check-input{type: "checkbox", name: "statusFilter", value: "terminated", id: "filter_terminated"}
              %label.form-check-label{for: "filter_terminated"}
                %i.bi.bi-person-x.me-2
                Terminated
            .mb-3
              %label.form-label Organization
              %select.form-select
                %option All Organizations
                %option= @organization.name
                - @organization.descendants.each do |descendant|
                  %option= descendant.name
          .col-md-6
            %h6.mb-3
              %i.bi.bi-sort-down.me-2
              Sort Options
            .form-check
              %input.form-check-input{checked: "checked", type: "radio", name: "sortBy", value: "name_asc"}
              %label.form-check-label
                %i.bi.bi-sort-alpha-down.me-2
                Name (A-Z)
            .form-check
              %input.form-check-input{type: "radio", name: "sortBy", value: "name_desc"}
              %label.form-check-label
                %i.bi.bi-sort-alpha-up.me-2
                Name (Z-A)
            .form-check
              %input.form-check-input{type: "radio", name: "sortBy", value: "status"}
              %label.form-check-label
                %i.bi.bi-sort-down.me-2
                Employment Status
            .form-check
              %input.form-check-input{type: "radio", name: "sortBy", value: "organization"}
              %label.form-check-label
              %i.bi.bi-building.me-2
                Organization
            .mb-3
              %label.form-label View Style
              .form-check
                %input.form-check-input{checked: "checked", type: "radio", name: "viewStyle", value: "table"}
                %label.form-check-label
                  %i.bi.bi-table.me-2
                  Table View
              .form-check
                %input.form-check-input{type: "radio", name: "viewStyle", value: "cards"}
                %label.form-check-label
                  %i.bi.bi-grid.me-2
                  Card View
              .form-check
                %input.form-check-input{type: "radio", name: "viewStyle", value: "list"}
                %label.form-check-label
                  %i.bi.bi-list.me-2
                  List View
            .mb-3
              %label.form-label Spotlight
              %select.form-select
                %option Teammates Overview
                %option Employment Status Breakdown
                %option Permission Analysis
      .modal-footer
        %button.btn.btn-secondary{"data-bs-dismiss" => "modal", type: "button"} Cancel
        %button.btn.btn-primary.disabled{type: "button"}
          %i.bi.bi-check.me-2
          Apply Filters
