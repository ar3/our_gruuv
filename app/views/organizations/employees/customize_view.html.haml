- content_for :title, "Customize View"

- content_for :header do
  Customize TeammatesView
- content_for :return_url do
  = @return_url || organization_employees_path(@organization)
- content_for :return_text do
  = @return_text || 'Back to Teammates'

= form_with url: update_view_organization_employees_path(@organization), method: :patch, local: true do |form|
  .row
    / Left column (4 cols) - Section titles
    .col-md-4
      .mb-4
        %h2 Choose Preset
    .col-md-8
      / Preset Section - Grid of Buttons
      .card.mb-4
        .card-body
          %label.form-label.fw-bold.mb-3 Choose Preset
          - presets = available_presets_with_permissions(@organization, current_company_teammate)
          .row.g-3
            - presets.each do |preset|
              .col-md-4.col-sm-6
                - if preset[:available]
                  %button.btn.btn-outline-primary.w-100.h-100.d-flex.flex-column.align-items-center.justify-content-center.p-3{type: 'submit', name: 'preset', value: preset[:value], style: 'min-height: 100px;'}
                    %i.bi.bi-check-circle.mb-2{style: "font-size: 1.5rem;"}
                    %span.fw-bold.text-center= preset[:name]
                - else
                  .d-flex.align-items-center.gap-2.w-100
                    .flex-grow-1
                      %button.btn.btn-outline-secondary.w-100.h-100.d-flex.flex-column.align-items-center.justify-content-center.p-3.disabled{type: 'button', disabled: true, style: 'min-height: 100px; opacity: 0.6; cursor: not-allowed;'}
                        %i.bi.bi-lock.mb-2{style: "font-size: 1.5rem;"}
                        %span.fw-bold.text-center= preset[:name]
                    %i.bi.bi-exclamation-triangle.text-warning{data: {bs_toggle: "tooltip", bs_title: preset[:tooltip]}, style: "font-size: 1.2rem;"}
  .row
    .col-12.text-center
      %hr/
      %h1.text-muted --OR--
      %small.text-muted Customize Your View
      %hr/
  .row
    .col-md-4
      .mb-4
        %h2 Select What Teammates You See
    
    .col-md-8
      / Filters Section
      .card.mb-4
        .card-body
          %label.form-label.fw-bold Select What Teammates You See
          
          .mb-3
            %label.form-label Employment Status
            .form-check
              = check_box_tag 'status[]', 'follower', @current_filters[:status]&.include?('follower'), class: 'form-check-input', id: 'filter_followers'
              = label_tag 'filter_followers', 'Followers', class: 'form-check-label'
            .form-check
              = check_box_tag 'status[]', 'huddler', @current_filters[:status]&.include?('huddler'), class: 'form-check-input', id: 'filter_huddlers'
              = label_tag 'filter_huddlers', 'Huddlers', class: 'form-check-label'
            .form-check
              = check_box_tag 'status[]', 'unassigned_employee', @current_filters[:status]&.include?('unassigned_employee'), class: 'form-check-input', id: 'filter_unassigned'
              = label_tag 'filter_unassigned', 'Unassigned Employees', class: 'form-check-label'
            .form-check
              = check_box_tag 'status[]', 'assigned_employee', @current_filters[:status]&.include?('assigned_employee'), class: 'form-check-input', id: 'filter_assigned'
              = label_tag 'filter_assigned', 'Active Employees', class: 'form-check-label'
            .form-check
              = check_box_tag 'status[]', 'terminated', @current_filters[:status]&.include?('terminated'), class: 'form-check-input', id: 'filter_terminated'
              = label_tag 'filter_terminated', 'Terminated', class: 'form-check-label'
          
          .mb-3
            %label.form-label Manager
            .row.g-2
              - @active_managers.each_with_index do |manager, index|
                .col-md-4.col-sm-6.col-12
                  .form-check
                    = check_box_tag 'manager_teammate_id[]', manager.id, @current_filters[:manager_teammate_id]&.include?(manager.id.to_s), class: 'form-check-input', id: "manager_#{manager.id}"
                    = label_tag "manager_#{manager.id}", manager.is_a?(CompanyTeammate) ? manager.person.last_first_display_name : manager.last_first_display_name, class: 'form-check-label'
          
          .mb-3
            %label.form-label Department
            - if Rails.env.production? || params[:preview] == 'true'
              %small.text-muted Department filtering is coming soon!
            - if @active_departments.any?
              .row.g-2
                - @active_departments.each_with_index do |department, index|
                  .col-md-4.col-sm-6.col-12
                    .form-check
                      -if Rails.env.production? || params[:preview] == 'true'
                        = check_box_tag 'department_id[]', department.id, @current_filters[:department_id]&.include?(department.id.to_s), class: 'form-check-input', id: "department_#{department.id}", disabled: true
                      - else
                        = check_box_tag 'department_id[]', department.id, @current_filters[:department_id]&.include?(department.id.to_s), class: 'form-check-input', id: "department_#{department.id}"
                      = label_tag "department_#{department.id}", department.name, class: 'form-check-label'
            - else
              %small.text-muted No departments available
          
          .mb-3
            %label.form-label Permissions
            .form-check
              = check_box_tag 'permission[]', 'employment_mgmt', @current_filters[:permission]&.include?('employment_mgmt'), class: 'form-check-input', id: 'perm_employment_mgmt'
              = label_tag 'perm_employment_mgmt', 'Employment Management', class: 'form-check-label'
            .form-check
              = check_box_tag 'permission[]', 'employment_create', @current_filters[:permission]&.include?('employment_create'), class: 'form-check-input', id: 'perm_employment_create'
              = label_tag 'perm_employment_create', 'Employment Creation', class: 'form-check-label'
            .form-check
              = check_box_tag 'permission[]', 'maap_mgmt', @current_filters[:permission]&.include?('maap_mgmt'), class: 'form-check-input', id: 'perm_maap_mgmt'
              = label_tag 'perm_maap_mgmt', 'MAAP Management', class: 'form-check-label'
            .form-check
              = check_box_tag 'permission[]', 'customize_company', @current_filters[:permission]&.include?('customize_company'), class: 'form-check-input', id: 'perm_customize_company'
              = label_tag 'perm_customize_company', 'Customize Company', class: 'form-check-label'
            .form-check
              = check_box_tag 'permission[]', 'kudos_rewards', @current_filters[:permission]&.include?('kudos_rewards'), class: 'form-check-input', id: 'perm_kudos_rewards'
              = label_tag 'perm_kudos_rewards', "#{company_label_plural('kudos_point', 'Kudos Point')} & Rewards Management", class: 'form-check-label'
  .row
    .col-md-4
      .mb-4
        %h2 Select What Order You See Them In
    
    .col-md-8
      / Sort Section
      .card.mb-4
        .card-body
          %label.form-label.fw-bold Select What Order You See Them In
          = select_tag 'sort', options_for_select([['Name (A-Z)', 'name_asc'], ['Name (Z-A)', 'name_desc'], ['Employment Status', 'status'], ['Organization', 'organization'], ['Employment Date', 'employment_date']], @current_sort), class: 'form-select', id: 'sort_select'
  .row
    .col-md-4
      .mb-4
        %h2 Select How They Appear
    
    .col-md-8
      / View Style Section
      .card.mb-4
        .card-body
          %label.form-label.fw-bold Select How They Appear
          .form-check
            = radio_button_tag 'view', 'table', @current_view == 'table', class: 'form-check-input', id: 'view_table'
            = label_tag 'view_table', 'Table View', class: 'form-check-label'
          .form-check
            = radio_button_tag 'view', 'cards', @current_view == 'cards', class: 'form-check-input', id: 'view_cards'
            = label_tag 'view_cards', 'Card View', class: 'form-check-label'
          .form-check
            = radio_button_tag 'view', 'list', @current_view == 'list', class: 'form-check-input', id: 'view_list'
            = label_tag 'view_list', 'List View', class: 'form-check-label'
          .form-check
            = radio_button_tag 'view', 'managers_view', @current_view == 'managers_view', class: 'form-check-input', id: 'view_managers_view'
            = label_tag 'view_managers_view', "Manager's View", class: 'form-check-label'
          - can_manage_employment = policy(@organization).manage_employment?
          - if can_manage_employment
            .form-check
              = radio_button_tag 'view', 'check_in_status', @current_view == 'check_in_status', class: 'form-check-input', id: 'view_check_in_status'
              = label_tag 'view_check_in_status', 'Check-in Status Style 1', class: 'form-check-label'
          - else
            .form-check
              .d-flex.align-items-center.gap-2
                = radio_button_tag 'view', 'check_in_status', @current_view == 'check_in_status', class: 'form-check-input', id: 'view_check_in_status', disabled: true
                = label_tag 'view_check_in_status', 'Check-in Status Style 1', class: 'form-check-label', style: 'opacity: 0.6; cursor: not-allowed;'
                %i.bi.bi-exclamation-triangle.text-warning{data: {bs_toggle: "tooltip", bs_title: "You need employment management permission to use this option"}, style: "font-size: 1rem;"}
          - if can_manage_employment
            .form-check
              = radio_button_tag 'view', 'check_ins_health', @current_view == 'check_ins_health', class: 'form-check-input', id: 'view_check_ins_health'
              = label_tag 'view_check_ins_health', 'Check-ins Health Style 2', class: 'form-check-label'
          - else
            .form-check
              .d-flex.align-items-center.gap-2
                = radio_button_tag 'view', 'check_ins_health', @current_view == 'check_ins_health', class: 'form-check-input', id: 'view_check_ins_health', disabled: true
                = label_tag 'view_check_ins_health', 'Check-ins Health Style 2', class: 'form-check-label', style: 'opacity: 0.6; cursor: not-allowed;'
                %i.bi.bi-exclamation-triangle.text-warning{data: {bs_toggle: "tooltip", bs_title: "You need employment management permission to use this option"}, style: "font-size: 1rem;"}
  .row
    .col-md-4
      .mb-4
        %h2 Select the Spotlight for Them
    
    .col-md-8
    
      / Spotlight Section
      .card.mb-4
        .card-body
          %label.form-label.fw-bold Select the Spotlight for Them
          .form-check
            = radio_button_tag 'spotlight', 'teammates_overview', (@current_spotlight || 'teammate_tenures') == 'teammates_overview', class: 'form-check-input', id: 'spotlight_overview'
            = label_tag 'spotlight_overview', 'Teammates Overview', class: 'form-check-label'
          .form-check
            = radio_button_tag 'spotlight', 'teammate_tenures', (@current_spotlight || 'teammate_tenures') == 'teammate_tenures', class: 'form-check-input', id: 'spotlight_tenures'
            = label_tag 'spotlight_tenures', 'Teammate Tenures', class: 'form-check-label'
          .form-check
            = radio_button_tag 'spotlight', 'employee_locations', @current_spotlight == 'employee_locations', class: 'form-check-input', id: 'spotlight_locations'
            = label_tag 'spotlight_locations', 'Employee Locations', class: 'form-check-label'
          .form-check
            = radio_button_tag 'spotlight', 'manager_distribution', @current_spotlight == 'manager_distribution', class: 'form-check-input', id: 'spotlight_manager_distribution'
            = label_tag 'spotlight_manager_distribution', 'Manager Distribution', class: 'form-check-label'
          .form-check
            = radio_button_tag 'spotlight', 'manager_lite', @current_spotlight == 'manager_lite', class: 'form-check-input', id: 'spotlight_manager_lite'
            = label_tag 'spotlight_manager_lite', 'Manager Lite', class: 'form-check-label'
          - can_manage_employment = policy(@organization).manage_employment?
          - if can_manage_employment
            .form-check
              = radio_button_tag 'spotlight', 'check_ins_health', @current_spotlight == 'check_ins_health', class: 'form-check-input', id: 'spotlight_check_ins_health_style_1'
              = label_tag 'spotlight_check_ins_health_style_1', 'Check-ins Health Style 1', class: 'form-check-label'
          - else
            .form-check
              .d-flex.align-items-center.gap-2
                = radio_button_tag 'spotlight', 'check_ins_health', @current_spotlight == 'check_ins_health', class: 'form-check-input', id: 'spotlight_check_ins_health_style_1', disabled: true
                = label_tag 'spotlight_check_ins_health_style_1', 'Check-ins Health Style 1', class: 'form-check-label', style: 'opacity: 0.6; cursor: not-allowed;'
                %i.bi.bi-exclamation-triangle.text-warning{data: {bs_toggle: "tooltip", bs_title: "You need employment management permission to use this option"}, style: "font-size: 1rem;"}
          - if can_manage_employment
            .form-check
              = radio_button_tag 'spotlight', 'check_ins_health', @current_spotlight == 'check_ins_health', class: 'form-check-input', id: 'spotlight_check_ins_health_style_2'
              = label_tag 'spotlight_check_ins_health_style_2', 'Check-ins Health Style 2', class: 'form-check-label'
          - else
            .form-check
              .d-flex.align-items-center.gap-2
                = radio_button_tag 'spotlight', 'check_ins_health', @current_spotlight == 'check_ins_health', class: 'form-check-input', id: 'spotlight_check_ins_health_style_2', disabled: true
                = label_tag 'spotlight_check_ins_health_style_2', 'Check-ins Health Style 2', class: 'form-check-label', style: 'opacity: 0.6; cursor: not-allowed;'
                %i.bi.bi-exclamation-triangle.text-warning{data: {bs_toggle: "tooltip", bs_title: "You need employment management permission to use this option"}, style: "font-size: 1rem;"}
  .row
    .col-12
      / Form Actions
      .d-flex.gap-2.mt-4.mb-4
        = form.submit 'Apply View', class: 'btn btn-primary'
        = link_to 'Cancel', @return_url || organization_employees_path(@organization), class: 'btn btn-outline-secondary'

:javascript
  // Initialize Bootstrap tooltips for disabled preset buttons
  document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });
  });

