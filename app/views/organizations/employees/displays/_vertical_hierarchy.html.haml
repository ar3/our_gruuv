- if @hierarchy_tree.empty? && (@unassigned_teammates.is_a?(Array) ? @unassigned_teammates.empty? : @unassigned_teammates.empty?)
  .alert.alert-info
    %h6.mb-2
      %i.bi.bi-info-circle.me-2
      No Teammates Found
    %p.mb-2
      - if @has_active_filters
        No teammates match your current filters. Try adjusting your filter settings.
      - else
        This organization doesn't have any teammates yet.
- else
  - if @hierarchy_tree.any?
    .tree-visualization{style: "padding: 20px;"}
      - @hierarchy_tree.each do |root_node|
        = render 'organizations/vertical_accountability_chart/employee_node', node: root_node, depth: 0, organization: @organization
  
  - unassigned_array = @unassigned_teammates.is_a?(Array) ? @unassigned_teammates : @unassigned_teammates.to_a
  - if unassigned_array.any?
    %hr.mt-5.mb-4
    .mt-4
      %h4.mb-3
        %i.bi.bi-people.me-2
        Company Teammates Without Active Positions
      .row
        - unassigned_array.each do |teammate|
          .col-md-6.col-lg-4.mb-3
            .card
              .card-body.p-2
                .d-flex.align-items-start
                  .flex-shrink-0.me-3
                    = teammate_profile_image(teammate, size: 48)
                  .flex-grow-1
                    - if policy(teammate).internal?
                      = link_to teammate.person.display_name, internal_organization_company_teammate_path(@organization, teammate), class: "text-decoration-none fw-bold"
                    - else
                      %span.fw-bold= teammate.person.display_name
                    %br
                    %small.text-muted
                      = teammate_current_title(teammate)
                    %br
                    %span.text-muted.small= teammate.person.email

:javascript
  // Handle collapse/expand icon toggle
  document.addEventListener('DOMContentLoaded', function() {
    const toggleButtons = document.querySelectorAll('.toggle-children');
    
    toggleButtons.forEach(function(button) {
      const targetId = button.getAttribute('data-bs-target');
      const target = document.querySelector(targetId);
      const icon = button.querySelector('.toggle-icon');
      
      if (target) {
        // Set initial icon state based on whether it's expanded
        if (target.classList.contains('show')) {
          icon.classList.remove('bi-chevron-up');
          icon.classList.add('bi-chevron-down');
        } else {
          icon.classList.remove('bi-chevron-down');
          icon.classList.add('bi-chevron-up');
        }
        
        // Listen for Bootstrap collapse events
        target.addEventListener('show.bs.collapse', function() {
          icon.classList.remove('bi-chevron-up');
          icon.classList.add('bi-chevron-down');
        });
        
        target.addEventListener('hide.bs.collapse', function() {
          icon.classList.remove('bi-chevron-down');
          icon.classList.add('bi-chevron-up');
        });
      }
    });
  });

