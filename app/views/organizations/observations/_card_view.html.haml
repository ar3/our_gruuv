.row
  - @observations.each do |observation|
    .col-md-6.col-lg-4.mb-4
      .card.h-100
        .card-body
          %h5.card-title
            = truncate(observation.story, length: 50)
          %p.card-text
            = truncate(observation.story, length: 200)
          %p.mb-2
            %span{title: observation.decorate.visibility_text, "data-bs-toggle" => "tooltip"}
              = observation.decorate.privacy_rings_with_label
          - if observation.primary_feeling.present?
            %p.mb-2= observation.decorate.feelings_display_html
          - if observation.observation_ratings.any?
            %p.mb-2
              %small.text-muted Ratings:
              - assignment_ratings = observation.observation_ratings.select { |r| r.rateable_type == 'Assignment' }
              - ability_ratings = observation.observation_ratings.select { |r| r.rateable_type == 'Ability' }
              - aspiration_ratings = observation.observation_ratings.select { |r| r.rateable_type == 'Aspiration' }
              - rating_texts = []
              - assignment_ratings.each do |rating|
                - rating_texts << capture { render('organizations/observations/assignment_rating', observation_rating: rating, include_assignment_name: true) }
              - ability_ratings.each do |rating|
                - rating_texts << capture { render('organizations/observations/ability_rating', observation_rating: rating, include_ability_name: true) }
              - aspiration_ratings.each do |rating|
                - rating_texts << capture { render('organizations/observations/aspiration_rating', observation_rating: rating, include_aspiration_name: true) }
              != rating_texts.join(', ')
          - else
            .alert.alert-danger.mb-2.small.py-1.px-2
              %i.bi.bi-exclamation-triangle.me-1
              nothing rated
          %p.mb-1
            %small.text-muted
              Observer: #{observation.observer.preferred_name || observation.observer.first_name}
          %p.mb-1
            %small.text-muted
              Observed:
              - if observation.observed_teammates.any?
                - names = observation.observed_teammates.map { |teammate| teammate.person.preferred_name || teammate.person.first_name }
                = names.join(', ')
              - else
                %span.text-muted No one
          %p.mb-0
            %small.text-muted= observation.observed_at.strftime('%b %d, %Y')
        .card-footer
          .btn-group.btn-group-sm.w-100
            - if observation.privacy_level == 'public_to_world'
              = link_to observation.decorate.permalink_path, class: "btn btn-outline-primary", title: "Public permalink" do
                %i.bi.bi-globe
            = link_to organization_observation_path(@organization, observation), class: "btn btn-outline-primary", title: "Show page" do
              %i.bi.bi-eye
            - if policy(observation).update?
              = link_to new_organization_observation_path(@organization, draft_id: observation.id, return_url: organization_observation_path(@organization, observation), return_text: 'Back to Observation'), class: "btn btn-outline-secondary" do
                %i.bi.bi-pencil

