- content_for :header do
  .d-flex.align-items-center
    %h1.mb-0.me-2
      %i.bi.bi-eye.me-2
      Culture of Feedback and Recognition – 360•365
    .d-flex.align-items-center
      - if policy(Observation).create?
        = link_to new_organization_observation_path(@organization, return_url: organization_observations_path(@organization), return_text: 'Back to Culture of Feedback and Recognition'), class: "btn btn-primary ml-2" do
          %i.bi.bi-plus
          New #{['Observation', 'Feedback', 'Recognition', 'Kudos', 'Celebration', 'Thank You', 'Appreciation', 'Praise', 'Acknowledgment', 'Shout Out', 'Radical Candor Feedback', 'Constructive Feedback'].sample}
      - else
        .btn.btn-primary.disabled.disabled-button
          %i.bi.bi-plus
        %i.bi.bi-exclamation-triangle.text-warning.ms-2{"data-bs-toggle" => "tooltip", "data-bs-title" => "You need to be a teammate to create observations"}

- content_for :go_back_link do
  - if @return_url.present? && @return_text.present?
    = link_to @return_url, class: "go-back-link" do
      %i.bi.bi-arrow-left.me-2
      = @return_text
  - else
    = link_to dashboard_organization_path(@organization), class: "go-back-link" do
      %i.bi.bi-arrow-left.me-2
      Back to Dashboard

- content_for :header_action do
  = link_to customize_view_organization_observations_path(@organization, params.except(:controller, :action, :page).permit!.to_h), class: "btn btn-outline-secondary" do
    %i.bi.bi-gear.me-2
    Customize

/ Spotlight Section
.row.justify-content-center.mb-4
  .col-lg-12
    .card.border-0.shadow-sm
      .card-body
        - if @current_spotlight == 'feedback_health'
          = render partial: 'organizations/observations/spotlights/feedback_health'
        - else
          .row
            .col-md-8
              / Main statistics/metrics area - varies by spotlight
              .row.text-center
                - case @current_spotlight
                - when 'my_journal'
                  .col-3
                    .h3.text-primary= @spotlight_stats[:total_observations] || 0
                    %small.text-muted Total Journal
                  .col-3
                    .h3.text-info= @spotlight_stats[:this_week] || 0
                    %small.text-muted This Week
                  .col-3
                    .h3.text-success= @spotlight_stats[:this_month] || 0
                    %small.text-muted This Month
                  .col-3
                    .h3.text-warning= @spotlight_stats[:with_ratings] || 0
                    %small.text-muted With Ratings
                - when 'team_wins'
                  .col-3
                    .h3.text-primary= @spotlight_stats[:total_public] || 0
                    %small.text-muted Total Public
                  .col-3
                    .h3.text-info= @spotlight_stats[:this_week] || 0
                    %small.text-muted This Week
                  .col-3
                    .h3.text-success= @spotlight_stats[:positive_ratings] || 0
                    %small.text-muted Positive Ratings
                  .col-3
                    .h3.text-warning= @spotlight_stats[:with_ratings] || 0
                    %small.text-muted With Ratings
                - when 'this_week'
                  .col-3
                    .h3.text-primary= @spotlight_stats[:total_this_week] || 0
                    %small.text-muted Total This Week
                  .col-3
                    .h3.text-info= @spotlight_stats[:journal_entries] || 0
                    %small.text-muted Journal Entries
                  .col-3
                    .h3.text-success= @spotlight_stats[:public_observations] || 0
                    %small.text-muted Public
                  .col-3
                    .h3.text-warning= @spotlight_stats[:with_ratings] || 0
                    %small.text-muted With Ratings
                - else
                  .col-3
                    .h3.text-primary= @spotlight_stats[:this_week] || 0
                    %small.text-muted This Week
                  .col-3
                    .h3.text-info= @spotlight_stats[:journal_entries] || 0
                    %small.text-muted Journal Entries
                  .col-3
                    .h3.text-success= @spotlight_stats[:public_observations] || 0
                    %small.text-muted Public Recognition
                  .col-3
                    .h3.text-warning= @spotlight_stats[:with_ratings] || 0
                    %small.text-muted With Ratings
            .col-md-4
              / Action alerts or status messages
              - if @observations.empty?
                .alert.alert-info.small
                  %i.bi.bi-info-circle.me-2
                  %strong Start giving feedback to your teammates
              - elsif @current_spotlight == 'overview' && @spotlight_stats[:journal_entries] > @spotlight_stats[:public_observations]
                .alert.alert-warning.small
                  %i.bi.bi-lightbulb.me-2
                  %strong Consider sharing more observations publicly
      .card-footer.bg-light
        .row.align-items-center
          .col-md-6
            %small.text-muted
              %i.bi.bi-funnel.me-1
              Filters:
              - if @current_filters.any?
                = @current_filters.map { |k, v| "#{k}: #{Array(v).join(', ')}" }.join('; ')
              - else
                All observations
              %br
              %i.bi.bi-sort-down.me-1
              Sort:
              = observation_sort_options.find { |o| o[1] == @current_sort }&.first || 'Most recent'
          .col-md-6.text-end
            %small.text-muted
              %i.bi.bi-table.me-1
              View:
              = @current_view.humanize
              %br
              %i.bi.bi-eye.me-1
              Spotlight:
              = @current_spotlight&.humanize || 'None'

/ Pagination Info
.row.justify-content-center.mb-2
  .col-lg-12
    .d-flex.justify-content-between.align-items-center
      %small.text-muted= raw pagy_info(@pagy) if @pagy
      - if @observations&.count.to_i > 0
        %small.text-muted Showing #{@current_view.humanize} view

/ Main Content Area
.row.justify-content-center
  .col-lg-12
    - if @observations&.any?
      - case @current_view
      - when 'cards'
        = render 'organizations/observations/card_view'
      - when 'list'
        = render 'organizations/observations/list_view'
      - else
        = render 'organizations/observations/table_view'
      
      / Pagination Navigation
      - if @pagy && @pagy.pages > 1
        .d-flex.justify-content-center.mt-4
          = raw pagy_nav(@pagy)
    - else
      .alert.alert-info
        %h6.mb-2
          %i.bi.bi-info-circle.me-2
          No Observations Created
        %p.mb-2 
          Start by creating your first observation to give feedback to your teammates.
          = link_to "Create First Observation", new_organization_observation_path(@organization, return_url: organization_observations_path(@organization), return_text: 'Back to Culture of Feedback and Recognition'), class: "btn btn-primary btn-sm"

