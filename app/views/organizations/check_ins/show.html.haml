- content_for :header do
  %h1.mb-0 Check-Ins for #{@person.display_name}
  %p.text-muted.mb-0= "View Mode: #{@view_mode.to_s.titleize}"
        
- content_for :header_action do
  .d-flex.align-items-center.gap-2
    -# View Toggle Buttons
    .btn-group.me-3{"role" => "group"}
      = link_to organization_person_check_ins_path(@organization, @person, view: 'table'), 
                class: "btn btn-sm #{'btn-primary' if @view_mode_param == 'table'} #{'btn-outline-primary' if @view_mode_param != 'table'}",
                "data-view" => "table",
                title: "Table View" do
        %i.bi.bi-table.me-1
        Table
      = link_to organization_person_check_ins_path(@organization, @person, view: 'card'), 
                class: "btn btn-sm #{'btn-primary' if @view_mode_param == 'card'} #{'btn-outline-primary' if @view_mode_param != 'card'}",
                "data-view" => "card",
                title: "Card View" do
        %i.bi.bi-grid.me-1
        Card
    
    = render 'people/view_switcher'

- content_for :go_back_link do
  - if @person.active_employment_tenure_for(@organization)
    = link_to organization_person_finalization_path(@organization, @person), class: "go-back-link" do
      %i.bi.bi-arrow-left.me-2
      Go to Finalization
  - else
    = link_to organization_person_path(@organization, @person), class: "go-back-link" do
      %i.bi.bi-arrow-left.me-2
      Back to Profile

-# Show pending acknowledgement banner if applicable
- if @view_mode == :employee && @person.maap_snapshots.executed.where(employee_acknowledged_at: nil).any?
  .alert.alert-warning
    %strong ⚠️ Your manager has finalized check-ins.
    = link_to 'Review and Acknowledge', organization_person_finalization_path(@organization, @person), class: 'btn btn-sm btn-warning'

-# Mobile warning for table view
- if @view_mode_param == 'table'
  .alert.alert-info.d-md-none
    %strong ℹ️ Mobile Notice:
    This view performs better on larger screens. 
    = link_to 'Switch to card view for mobile', organization_person_check_ins_path(@organization, @person, view: 'card'), class: 'btn btn-sm btn-outline-primary ms-2'

= form_with url: organization_person_check_ins_path(@organization, @person), method: :patch, scope: :check_ins do |f|
  
  -# Position Section
  = render 'shared/section_header', 
           title: 'Position/Overall', 
           icon: 'bi-briefcase', 
           description: 'Assess role performance and growth'
  
  - if @view_mode_param == 'table'
    = render 'position_check_ins_table',
             position_check_in: @position_check_in,
             form: f,
             view_mode: @view_mode
  - else
    = render 'position_check_in_card',
             position_check_in: @position_check_in,
             form: f,
             view_mode: @view_mode
  .row.mt-4
    .col-12
      = f.submit 'Save All Check-Ins', class: 'btn btn-primary btn-lg'

  -# Assignment Section
  = render 'shared/section_header', 
           title: 'Assignments/Outcomes', 
           icon: 'bi-clipboard-check', 
           description: 'Evaluate project contributions and energy',
           action_link: { url: assignment_selection_organization_person_path(@organization, @person), icon: 'bi-plus-circle', text: '', title: 'Manage assignments' }
  
  - if @view_mode_param == 'table'
    = render 'assignment_check_ins_table',
             assignment_check_ins: @assignment_check_ins,
             form: f,
             view_mode: @view_mode
  - else
    = render 'assignment_check_ins_card',
             assignment_check_ins: @assignment_check_ins,
             form: f,
             view_mode: @view_mode
  
  .row.mt-4
    .col-12
      = f.submit 'Save All Check-Ins', class: 'btn btn-primary btn-lg'
  
  -# Aspiration Section
  = render 'shared/section_header', 
           title: 'Aspirations/Values', 
           icon: 'bi-star', 
           description: 'Track progress toward personal goals'

  - if @view_mode_param == 'table'
    = render 'aspiration_check_ins_table',
             aspiration_check_ins: @aspiration_check_ins,
             form: f,
             view_mode: @view_mode
  - else
    = render 'aspiration_check_ins_card',
             aspiration_check_ins: @aspiration_check_ins,
             form: f,
             view_mode: @view_mode
  
  .row.mt-4
    .col-12
      = f.submit 'Save All Check-Ins', class: 'btn btn-primary btn-lg'

  -# Abilities Section
  = render 'shared/section_header', 
           title: 'Abilities/Skills/Knowledge', 
           icon: 'bi-briefcase', 
           description: 'View abilities relevant to your role and assignments'
  
  = render 'abilities_table',
           relevant_abilities: @relevant_abilities,
           view_mode: @view_mode,
           person: @person
    

  = render 'shared/section_header', 
           title: 'Personal Growth/Development', 
           icon: 'bi-briefcase', 
           description: '3 years, 2 quarters, 1 month'

  .row.mt-4
    .col-12
      .alert.alert-warning.alert-dismissible.fade.show{role: "alert"}
        .d-flex.align-items-center
          %i.bi.bi-heart.me-2
          %strong.me-2 Considering adding general goals to check-ins
          %span We'd love to build with you... ! Let's get started. 
          = link_to "Tell us what you think", new_interest_submission_path(source_page: nil, return_url: request.url), class: "alert-link ms-2"
        %button.btn-close{type: "button", "data-bs-dismiss": "alert", "aria-label": "Close"}

    .col-4 
      .card
        .card-header
          %h5.mb-0 Current Goals (Now - up to 3 months)
        .card-body
          - if @now_goals.any?
            %ul
              - @now_goals.each do |goal|
                %li
                  = link_to goal.title, organization_goal_path(@organization, goal), class: "text-decoration-none"
          - else
            .text-center.py-3
              %p.text-muted.mb-3 No current goals yet
              = link_to new_organization_goal_path(@organization), class: "btn btn-primary btn-sm" do
                %i.bi.bi-plus-circle.me-1
                Create Your First Goal
    .col-4 
      .card
        .card-header
          %h5.mb-0 Next Goals (3-9 months)
        .card-body
          - if @next_goals.any?
            %ul
              - @next_goals.each do |goal|
                %li
                  = link_to goal.title, organization_goal_path(@organization, goal), class: "text-decoration-none"
          - else
            .text-center.py-3
              %p.text-muted.mb-3 No next goals yet
              = link_to new_organization_goal_path(@organization), class: "btn btn-primary btn-sm" do
                %i.bi.bi-plus-circle.me-1
                Create Your First Goal
    .col-4 
      .card
        .card-header
          %h5.mb-0 Later Goals (9+ months)
        .card-body
          - if @later_goals.any?
            %ul
              - @later_goals.each do |goal|
                %li
                  = link_to goal.title, organization_goal_path(@organization, goal), class: "text-decoration-none"
          - else
            .text-center.py-3
              %p.text-muted.mb-3 No later goals yet
              = link_to new_organization_goal_path(@organization), class: "btn btn-primary btn-sm" do
                %i.bi.bi-plus-circle.me-1
                Create Your First Goal

  .row.mt-3
    .col-12.text-center
      %p.text-muted
        For more details, 
        = link_to "visit the goals check-in page", organization_goals_path(@organization, owner_id: "Teammate_#{@teammate.id}", view: 'check-in'), class: "text-decoration-none"

  = render 'shared/section_header', 
           title: '1:1 Todos', 
           icon: 'bi-briefcase', 
           description: 'Connect to Asana for 1:1 todos?'

  = render 'shared/section_header', 
           title: '1:1 Topics/Issues/Opportunities', 
           icon: 'bi-briefcase', 
           description: 'Connect to Asana for 1:1 oppties?'

-# Dream Goals Section