-# Aspiration Check-In Table View - Ready for Finalization State
.alert.alert-success.mb-3
  %i.bi.bi-check-circle.me-2
  %strong All aspiration assessments are complete! Ready for finalization.

.table-responsive
  %table.table.table-striped
    %thead
      %tr
        %th Aspiration
        %th Employee Rating
        %th Employee Notes
        %th Manager Rating
        %th Manager Notes
        %th Actions
    %tbody
      - check_ins.each do |check_in|
        - if check_in.ready_for_finalization?
          %tr
            %td= check_in.aspiration.name
            %td= aspiration_rating_display(check_in.employee_rating)
            %td= simple_format(check_in.employee_private_notes)
            %td
              - if view_mode == :manager
                = form.fields_for :aspiration_check_ins, check_in, index: check_in.id do |af|
                  = af.select :manager_rating, options_for_select([
                    ['Select...', ''],
                    ['Working to Meet', 'working_to_meet'],
                    ['Meeting', 'meeting'],
                    ['Exceeding', 'exceeding']
                  ], check_in.manager_rating), {}, class: 'form-control form-control-sm'
              - else
                = aspiration_rating_display(check_in.manager_rating)
            %td
              - if view_mode == :manager
                = form.fields_for :aspiration_check_ins, check_in, index: check_in.id do |af|
                  = af.text_area :manager_private_notes, class: 'form-control form-control-sm', rows: 2
              - else
                = simple_format(check_in.manager_private_notes)
            %td
              - confirm_message = view_mode == :manager ? 'Are you ready to finalize this check-in? This will create the official rating.' : 'Your manager will review both assessments and set the official rating.'
              = link_to "Go to Finalization", organization_person_finalization_path(@organization, @person), 
                        class: 'btn btn-success btn-sm',
                        data: { confirm: confirm_message }

- if view_mode == :manager
  .form-group.mt-3
    %label Status
    - check_ins.each do |check_in|
      - if check_in.ready_for_finalization?
        = form.fields_for :aspiration_check_ins, check_in, index: check_in.id do |af|
          .form-check
            = af.radio_button :status, 'complete', checked: true
            = af.label :status_complete, 'Ready for Finalization', class: 'form-check-label'
          .form-check
            = af.radio_button :status, 'draft'
            = af.label :status_draft, 'Make Changes', class: 'form-check-label'
        
        .small.text-muted.mt-1
          Select "Make Changes" to edit your assessment and notes

.small.text-muted.mt-2.text-center
  - if view_mode == :manager
    This will allow you to set the official rating and create a MAAP snapshot.
  - else
    Your manager will review both assessments and set the official rating.
