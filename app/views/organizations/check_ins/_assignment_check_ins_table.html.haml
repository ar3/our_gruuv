-# Assignment Check-Ins Table View with Interactive Forms
- if assignment_check_ins&.any?
  .table-responsive
    %table.table.table-striped
      %thead
        %tr
          %th Assignment
          %th{style: "display: none;"} ID
          - if view_mode == :employee
            %th Employee Rating
            %th Energy %
            %th Alignment
            %th Employee Notes
            %th Manager Status
            %th Status
          - elsif view_mode == :manager
            %th Manager Rating
            %th Manager Notes
            %th Employee Status
            %th Status
          - else
            %th Employee Rating
            %th Energy %
            %th Alignment
            %th Employee Notes
            %th Manager Rating
            %th Manager Notes
            %th Status
      %tbody
        - assignment_check_ins.each do |check_in|
          -# Determine which partial to render based on CheckInBehavior methods
          - display_mode = check_in.viewer_display_mode(view_mode)
          - partial_name = "assignment_check_ins_table_#{view_mode}_#{display_mode}"
          
          = form.fields_for :assignment_check_ins, check_in, index: check_in.id do |af|
            %tr{data: {check_in_id: check_in.id}}
              %td
                = button_tag type: "submit", 
                             name: "redirect_to", 
                             value: person_assignment_path(@person, check_in.assignment),
                             "data-bs-toggle" => "popover", 
                             "data-bs-trigger" => "hover", 
                             "data-bs-placement" => "right", 
                             "data-bs-html" => "true", 
                             "data-bs-content" => latest_assignment_check_in_popover_content(check_in.teammate, check_in.assignment),
                             class: "btn btn-link text-decoration-none p-0 border-0 bg-transparent text-start" do
                  = check_in.assignment.title
                  %i.bi.bi-clock-history.ms-1.text-muted
              = render partial_name, check_in: check_in, form: af, view_mode: view_mode
    -# Observation modals for each assignment
    - assignment_check_ins.each do |check_in|
      - since_date = check_in.previous_finalized_check_in&.official_check_in_completed_at || 1.year.ago
      - teammate = @person.teammates.find_by(organization: @organization)
      - if teammate
        = render 'organizations/observations/list_modal',
                 modal_id: "observationsModal_assignment_#{check_in.assignment_id}",
                 modal_title: "Observations for #{check_in.assignment.title}",
                 rateable_type: 'Assignment',
                 rateable_id: check_in.assignment_id,
                 observee_ids: [teammate.id],
                 start_date: since_date,
                 end_date: nil
- else
  .alert.alert-info
    %i.bi.bi-info-circle.me-2
    No assignments available to do a check-in on
    .mt-2
      = link_to assignment_selection_organization_person_path(@organization, @person), class: "btn btn-outline-primary btn-sm" do
        %i.bi.bi-plus-circle.me-1
        Select Assignments
