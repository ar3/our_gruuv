- content_for :header do
  %h1.mb-0 Check-In Management
  %p.text-muted.mb-0= "Managing check-ins for #{@person.display_name}"
        
- content_for :header_action do
  = link_to teammate_organization_person_path(@person.current_organization_or_default, @person), class: "btn btn-outline-secondary" do
    %i.bi.bi-arrow-left.me-2
    Back to Teammate View

- content_for :go_back_link do
  = link_to organization_employees_path(@person.current_organization_or_default), class: "go-back-link" do
    %i.bi.bi-arrow-left.me-2
    ="Back to Teammates in #{@person.current_organization_or_default.display_name}"

.row
  .col-12
    .card
      .card-header
        %h5.mb-0
          %i.bi.bi-chat-square-text.me-2
          Check-Ins Ready for Finalization
          %span.badge.bg-warning.ms-2= @ready_for_finalization.count
      .card-body
        - if @ready_for_finalization.any?
          .table-responsive
            %table.table.table-hover
              %thead
                %tr
                  %th Assignment
                  %th Employee Rating
                  %th Manager Rating
                  %th Energy %
                  %th Started
                  %th Actions
              %tbody
                - @ready_for_finalization.each do |check_in|
                  %tr
                    %td= check_in.assignment.title
                    %td
                      %span.badge{class: "bg-#{check_in.employee_rating == 'exceeding' ? 'success' : check_in.employee_rating == 'meeting' ? 'primary' : 'secondary'}"}
                        = check_in.employee_rating&.humanize
                    %td
                      %span.badge{class: "bg-#{check_in.manager_rating == 'exceeding' ? 'success' : check_in.manager_rating == 'meeting' ? 'primary' : 'secondary'}"}
                        = check_in.manager_rating&.humanize
                    %td= "#{check_in.actual_energy_percentage}%"
                    %td= check_in.check_in_started_on.strftime('%b %d, %Y')
                    %td
                      = form_with url: finalize_check_in_organization_person_path(@person.current_organization_or_default, @person), method: :patch, local: true do |f|
                        = f.hidden_field :check_in_id, value: check_in.id
                        .mb-2
                          = f.label :final_rating, "Final Rating", class: "form-label"
                          - rating_options = [['Meeting Expectations', 'meeting'], ['Exceeding Expectations', 'exceeding'], ['Below Expectations', 'below']]
                          = f.select :final_rating, 
                            options_for_select(rating_options, check_in.manager_rating), 
                            { prompt: 'Select final rating' }, 
                            { class: "form-select", required: true }
                        .mb-2
                          = f.label :shared_notes, "Shared Notes", class: "form-label"
                          = f.text_area :shared_notes, 
                            value: check_in.shared_notes, 
                            class: "form-control", 
                            rows: 3,
                            placeholder: "Notes to share with the employee..."
                        = f.submit "Finalize Check-In", class: "btn btn-primary"
        - else
          .text-center.py-4
            %i.bi.bi-check-circle.text-success{style: "font-size: 3rem;"}
            %h5.mt-3 No Check-Ins Ready for Finalization
            %p.text-muted All check-ins have been completed or are still in progress.
