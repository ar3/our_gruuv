- if @form && @form.errors.any?
  .alert.alert-danger
    %h5= "#{pluralize(@form.errors.count, "error")} prohibited this position from being saved:"
    %ul.mb-0
      - @form.errors.full_messages.each do |message|
        %li= message

.row
  .col-md-6
    .mb-3
      = form.label :position_type_id, "Position Type", class: "form-label"
      - position_type = @position_type || @position.position_type
      - if position_type
        = form.hidden_field :position_type_id, value: position_type.id
        %input.form-control{type: "text", value: position_type.display_name_with_major_level, readonly: true, disabled: true}
        %small.form-text.text-muted Position type cannot be changed
      - else
        = form.hidden_field :position_type_id, value: (@position.position_type_id || params[:position_type_id])
        %input.form-control{type: "text", value: "Unknown", readonly: true, disabled: true}
        %small.form-text.text-muted Position type is required
  
  .col-md-6
    .mb-3
      = form.label :position_level_id, "Position Level", class: "form-label"
      = form.select :position_level_id, 
        options_from_collection_for_select(@position_levels, :id, :level, @position.position_level_id), 
        { prompt: 'Select a position level' }, 
        { class: "form-select", required: true, id: "position_level_select" }
      %small.form-text.text-muted Choose the level within the selected position type

.row
  .col-md-12
    - position_type = @position_type || @position.position_type
    - if position_type&.position_summary.present?
      .mb-3
        .markdown-content--bordered
          = simple_format(position_type.position_summary)
        %small.form-text.text-muted.mt-2 This is the base summary from the position type. Your position-specific summary below will be appended to this.
    
    .mb-3
      = form.label :position_summary, "Position Summary", class: "form-label"
      = form.text_area :position_summary, class: "form-control", rows: 4,
        placeholder: "Optional description of this position's responsibilities and expectations..."
      %small.form-text.text-muted A brief description of what this position entails. This will be appended to the position type summary above.

- level_1_template = "• Living Values. Above the bar on all Values for 2+ quarters in the last 4 quarters \n\n• Meeting Required Assignments: Has met expectations of 80% of Required Assignments for 2 quarters in a row\n\n• Demonstrated Abilities: \n\nManager says, \"I want to entrust this person with more responsibility, because they have demonstrated the Abilities needed for the Assignments they are taking on\"\n\n• Achievement\n\nWTWT. If your team is meeting expectations for 2+ quarters in a row that directly contributes to every member of that team "
- level_2_template = "• Living Values. Above the bar on all Values for 2+ quarters in a row\n\n• Meeting Required Assignments: Has met expectations of 100% of Required Assignments for 2 quarters in a row\n\n• Demonstrated Abilities: \n\nManager says, \"I want to entrust this person with more responsibility, because they have demonstrated the Abilities needed for the Assignments they are taking on, and are above the expected milestone for 33% of the Abilities.\" \n\n• Achievement\n\nWTWT. If your team is exceeding expectations for 2+ quarters in a row that directly contributes to every member of that team "
- level_3_template = "• Living Values. Above the bar on all Values for 2+ quarters in a row\n\n• Meeting Required Assignments: Has met expectations of 100% of Required Assignments, and exceeding expectations for 50% of those, for 2 quarters in a row\n\n• Additional Assignment \n\nHas a \"Unique-to-You Assignment\" and has met expectations on it for 2 of the last 4 quarters. \n\n• Demonstrated Abilities: \n\nManager says, \"I want to entrust this person with more responsibility, because they have demonstrated the Abilities needed for the Assignments they are taking on, and are above the expected milestone for 33% of the Abilities.\" \n\n• Achievement\n\nWTWT. If your team is exceeding expectations for 2+ quarters in a row that directly contributes to every member of that team "
- eligibility_template = (@position.persisted? && @position.position_level) ? (minor_level = @position.position_level.level.split('.').last.to_i; case minor_level; when 1; level_1_template; when 2; level_2_template; when 3; level_3_template; else; level_1_template; end) : level_1_template

.row
  .col-md-12
    .mb-3
      .d-flex.justify-content-between.align-items-center.mb-2
        = form.label :eligibility_requirements_summary, "Eligibility Requirements Summary", class: "form-label mb-0"
        - if @position.persisted?
          %button.btn.btn-sm.btn-outline-secondary{type: "button", id: "use_template_btn"}
            Use Template
      = form.text_area :eligibility_requirements_summary, class: "form-control", rows: 8,
        placeholder: eligibility_template, id: "eligibility_requirements_summary_textarea"
      %small.form-text.text-muted Requirements for eligibility at this position level

.row
  .col-md-6
    .mb-3
      = form.label :published_source_url, "Published External Reference", class: "form-label"
      = form.url_field :published_source_url, class: "form-control", 
        value: @position.published_url,
        placeholder: "https://docs.google.com/document/d/..."
      %small.form-text.text-muted URL to the published version of this position
  
  .col-md-6
    .mb-3
      = form.label :draft_source_url, "Draft External Reference", class: "form-label"
      = form.url_field :draft_source_url, class: "form-control", 
        value: @position.draft_url,
        placeholder: "https://docs.google.com/document/d/..."
      %small.form-text.text-muted URL to the draft version of this position


:javascript
  document.addEventListener('DOMContentLoaded', function() {
    const useTemplateBtn = document.getElementById('use_template_btn');
    const eligibilityTextarea = document.getElementById('eligibility_requirements_summary_textarea');
    
    if (useTemplateBtn && eligibilityTextarea) {
      useTemplateBtn.addEventListener('click', function() {
        eligibilityTextarea.value = eligibilityTextarea.placeholder;
      });
    }
  }); 