- content_for :go_back_link do
  = link_to organization_path(@organization), class: "go-back-link" do
    %i.bi.bi-arrow-left.me-2
    Back to #{@organization.display_name}

- content_for :header do
  .d-flex.justify-content-between.align-items-center
    %h1.mb-0 
      %i.bi.bi-briefcase.me-2
      Positions

- content_for :header_action do
  .d-flex.gap-2
    = link_to new_position_type_path, class: "btn btn-primary" do
      %i.bi.bi-plus.me-2
      New Position Type
    - customize_params = params.except(:controller, :action, :page).permit!.to_h
    = link_to customize_view_organization_positions_path(@organization, customize_params), class: "btn btn-outline-secondary" do
      %i.bi.bi-sliders.me-2
      Customize View
.row.justify-content-center
  .col-lg-12
    - if @position_types.any?
      - @position_types.each do |position_type|
        .card.mb-3
          .card-header.d-flex.justify-content-between.align-items-center
            .d-flex.align-items-center
              %a.text-decoration-none.text-dark.fw-bold{"data-bs-toggle" => "collapse", "data-bs-target" => "#positionType#{position_type.id}", "aria-expanded" => "false", "aria-controls" => "positionType#{position_type.id}", style: "cursor: pointer;"}
                %span.not-collapsed{id: "positionTypeExpandIcon#{position_type.id}"}
                  %i.bi.bi-chevron-down.me-2
                %span.collapsed{id: "positionTypeCollapseIcon#{position_type.id}"}
                  %i.bi.bi-chevron-right.me-2
                = position_type.external_title
              %span.badge.bg-secondary.ms-2= "#{position_type.positions.count} position#{'s' if position_type.positions.count != 1}"
            .d-flex.align-items-center.gap-2
              = link_to position_type_path(position_type), class: "btn btn-sm btn-outline-secondary", title: "View Position Type" do
                %i.bi.bi-eye
              .text-muted
                %small= position_type.position_major_level.set_name
          
          .collapse{"id" => "positionType#{position_type.id}"}
            .card-body.p-0
              - if position_type.positions.any?
                .table-responsive
                  %table.table.table-hover.mb-0
                    %thead.table-light
                      %tr
                        %th Position
                        %th Level
                        %th Version
                        %th Assignments
                        %th Actions
                    %tbody
                      - position_type.positions.includes(:position_level).order('position_levels.level').each do |position|
                        %tr
                          %td
                            = link_to organization_position_path(@organization, position), class: "text-decoration-none fw-bold" do
                              = position.display_name
                            - if position.position_summary.present?
                              %br
                              %small.text-muted= truncate(position.position_summary, length: 100)
                          %td
                            %span.badge.bg-info= position.position_level.level
                          %td= position.semantic_version
                          %td
                            - if position.required_assignments_count > 0 || position.suggested_assignments_count > 0
                              %span.badge.bg-primary.me-1
                                = position.required_assignments_count
                              %small.text-muted required
                              - if position.suggested_assignments_count > 0
                                %br
                                %span.badge.bg-secondary.me-1
                                  = position.suggested_assignments_count
                                %small.text-muted suggested
                            - else
                              %span.text-muted
                                %i.bi.bi-exclamation-triangle.me-1
                                None
                          %td
                            .btn-group.btn-group-sm
                              = link_to organization_position_path(@organization, position), class: "btn btn-outline-primary", title: "View" do
                                %i.bi.bi-eye
                              = link_to job_description_organization_position_path(@organization, position), class: "btn btn-outline-info", title: "Job Description" do
                                %i.bi.bi-file-text
                              = link_to edit_organization_position_path(@organization, position), class: "btn btn-outline-secondary", title: "Edit" do
                                %i.bi.bi-pencil
                              = link_to organization_position_path(@organization, position), method: :delete, class: "btn btn-outline-danger", title: "Delete", data: { confirm: "Are you sure?" } do
                                %i.bi.bi-trash
              - else
                .p-3.text-center.text-muted
                  %i.bi.bi-info-circle.me-2
                  No positions created for this type yet.
    - else
      .alert.alert-info
        %h6.mb-2
          %i.bi.bi-info-circle.me-2
          No Position Types Created
        %p.mb-2 
          Create your first position type to define roles and responsibilities for your team.

