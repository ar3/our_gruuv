- content_for :go_back_link do
  = link_to organization_path(@organization), class: "go-back-link" do
    %i.bi.bi-arrow-left.me-2
    Back to #{@organization.display_name}

- content_for :header do
  .d-flex.justify-content-between.align-items-center
    %h1.mb-0 
      %i.bi.bi-briefcase.me-2
      Positions
      = link_to new_organization_position_path(@organization), class: "btn btn-primary" do
        %i.bi.bi-plus

- content_for :header_action do
  %button.btn.btn-outline-secondary{"data-bs-toggle" => "modal", "data-bs-target" => "#positionsFilterModal", type: "button"}
    %i.bi.bi-funnel.me-2
    Filter & Sort
.row.justify-content-center
  .col-lg-12
    - if @position_types.any?
      - @position_types.each do |position_type|
        .card.mb-3
          .card-header.d-flex.justify-content-between.align-items-center{"data-bs-toggle" => "collapse", "data-bs-target" => "#positionType#{position_type.id}", "aria-expanded" => "false", "aria-controls" => "positionType#{position_type.id}", style: "cursor: pointer;"}
            .d-flex.align-items-center
              %span.not-collapsed{id: "positionTypeExpandIcon#{position_type.id}"}
                %i.bi.bi-chevron-down.me-2
              %span.collapsed{id: "positionTypeCollapseIcon#{position_type.id}"}
                %i.bi.bi-chevron-right.me-2
              = link_to position_type_path(position_type), class: "text-decoration-none text-dark fw-bold" do
                = position_type.external_title
              %span.badge.bg-secondary.ms-2= "#{position_type.positions.count} position#{'s' if position_type.positions.count != 1}"
            .text-muted
              %small= position_type.position_major_level.set_name
          
          .collapse{"id" => "positionType#{position_type.id}"}
            .card-body.p-0
              - if position_type.positions.any?
                .table-responsive
                  %table.table.table-hover.mb-0
                    %thead.table-light
                      %tr
                        %th Position
                        %th Level
                        %th Assignments
                        %th Actions
                    %tbody
                      - position_type.positions.includes(:position_level).order('position_levels.level').each do |position|
                        %tr
                          %td
                            = link_to organization_position_path(@organization, position), class: "text-decoration-none fw-bold" do
                              = position.display_name
                            - if position.position_summary.present?
                              %br
                              %small.text-muted= truncate(position.position_summary, length: 100)
                          %td
                            %span.badge.bg-info= position.position_level.level
                          %td
                            - if position.required_assignments_count > 0 || position.suggested_assignments_count > 0
                              %span.badge.bg-primary.me-1
                                = position.required_assignments_count
                              %small.text-muted required
                              - if position.suggested_assignments_count > 0
                                %br
                                %span.badge.bg-secondary.me-1
                                  = position.suggested_assignments_count
                                %small.text-muted suggested
                            - else
                              %span.text-muted
                                %i.bi.bi-exclamation-triangle.me-1
                                None
                          %td
                            .btn-group.btn-group-sm
                              = link_to organization_position_path(@organization, position), class: "btn btn-outline-primary", title: "View" do
                                %i.bi.bi-eye
                              = link_to job_description_organization_position_path(@organization, position), class: "btn btn-outline-info", title: "Job Description" do
                                %i.bi.bi-file-text
                              = link_to edit_organization_position_path(@organization, position), class: "btn btn-outline-secondary", title: "Edit" do
                                %i.bi.bi-pencil
                              = link_to organization_position_path(@organization, position), method: :delete, class: "btn btn-outline-danger", title: "Delete", data: { confirm: "Are you sure?" } do
                                %i.bi.bi-trash
              - else
                .p-3.text-center.text-muted
                  %i.bi.bi-info-circle.me-2
                  No positions created for this type yet.
    - else
      .alert.alert-info
        %h6.mb-2
          %i.bi.bi-info-circle.me-2
          No Position Types Created
        %p.mb-2 
          Create your first position type to define roles and responsibilities for your team.
        = link_to "Create First Position", new_organization_position_path(@organization), class: "btn btn-primary btn-sm"

/ Modal for Filter & Sort
#positionsFilterModal.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "positionsFilterModalLabel", tabindex: "-1"}
  .modal-dialog.modal-lg
    .modal-content
      .modal-header
        %h5.modal-title#positionsFilterModalLabel
          %i.bi.bi-funnel.me-2
          Filter & Sort Positions (coming soon)
        %button.btn-close{"aria-label" => "Close", "data-bs-dismiss" => "modal", type: "button"}
      .modal-body
        .row
          .col-md-6
            %h6.mb-3
              %i.bi.bi-funnel.me-2
              Filters
            %p.text-muted Position type and level filters will be available soon.
          .col-md-6
            %h6.mb-3
              %i.bi.bi-sort-down.me-2
              Sort Options
            %p.text-muted Sorting by name, level, and assignment count will be available soon.
            .mb-3
              %label.form-label View Style
              .form-check
                %input.form-check-input{checked: "checked", type: "radio", name: "viewStyle", value: "table"}
                %label.form-check-label
                  %i.bi.bi-table.me-2
                  Table View
              .form-check
                %input.form-check-input{type: "radio", name: "viewStyle", value: "cards"}
                %label.form-check-label
                  %i.bi.bi-grid.me-2
                  Card View
              .form-check
                %input.form-check-input{type: "radio", name: "viewStyle", value: "list"}
                %label.form-check-label
                  %i.bi.bi-list.me-2
                  List View
            .mb-3
              %label.form-label Spotlight
              %select.form-select
                %option No Spotlight
                %option High Assignment Count
                %option Recently Created
      .modal-footer
        %button.btn.btn-secondary{"data-bs-dismiss" => "modal", type: "button"} Cancel
        %button.btn.btn-primary.disabled{type: "button"}
          %i.bi.bi-check.me-2
          Apply Filters

