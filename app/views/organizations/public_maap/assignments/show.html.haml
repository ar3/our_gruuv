- content_for :title, "Public MAAP - #{@assignment.title}"

- content_for :header do
  %h1.mb-0= @assignment.title

- content_for :header_action do
  - if current_person
    = link_to organization_assignment_path(@organization, @assignment), class: "btn btn-outline-primary btn-sm" do
      %i.bi.bi-lock.me-2
      View Authenticated Version

- content_for :go_back_link do
  = link_to organization_public_maap_assignments_path(@organization), class: "text-muted text-decoration-none" do
    %i.bi.bi-arrow-left.me-2
    Back to Assignments

.row
  .col-md-8
    - if @assignment.department.present?
      .mb-4
        %h3.mb-3 Department
        - if policy(@organization).show?
          = link_to @organization.name, organization_path(@organization), class: "text-decoration-none"
        - else
          %span= @organization.name
        - if @assignment.department.present?
          %span.text-muted.mx-1
            %i.bi.bi-chevron-right
          - if policy(@assignment.department).show?
            = link_to @assignment.department.name, organization_department_path(@organization, @assignment.department), class: "text-decoration-none"
          - else
            %span= @assignment.department.name
    
    - if @assignment.tagline.present?
      .mb-4
        %h3.mb-3 Tagline
        .markdown-content.markdown-content--bordered
          %p.mb-0= @assignment.tagline
    
    - if @assignment.assignment_outcomes.any?
      .mb-4
        %h3.mb-3 Outcomes
        - @assignment.assignment_outcomes.ordered.each do |outcome|
          .mb-3
            .markdown-content.markdown-content--bordered
              .d-flex.justify-content-between.align-items-start
                .flex-grow-1
                  .markdown-content
                    = render_markdown(outcome.description)
                %span.badge{class: outcome.outcome_type == 'sentiment' ? 'bg-warning' : 'bg-info'}
                  = outcome.outcome_type.titleize
    
    - if @assignment.required_activities.present?
      .mb-4
        %h3.mb-3 Required Activities
        .markdown-content.markdown-content--bordered
          = render_markdown(@assignment.required_activities)
    
    - if @assignment.handbook.present?
      .mb-4
        %h3.mb-3 Handbook
        .markdown-content.markdown-content--bordered
          = render_markdown(@assignment.handbook)

    - if @observations.any?
      .mb-4
        %h3.mb-3
          %i.bi.bi-star.me-2
          Public Observations
        - @observations.each do |observation|
          .mb-3
            .markdown-content.markdown-content--bordered
              %p.mb-2= observation.decorate.story_html.html_safe
              .d-flex.justify-content-between.align-items-center
                .small.text-muted
                  From: #{observation.observer.casual_name}
                  - if observation.observed_teammates.any?
                    |  â€¢ Recognizing: 
                    - names = observation.observed_teammates.map { |t| t.person.preferred_name || t.person.first_name }
                    = names.join(', ')
                = link_to "View Observation", organization_kudo_path(observation.company, date: format_date_in_user_timezone(observation.observed_at, format: '%Y-%m-%d'), id: observation.id), class: "btn btn-sm btn-outline-primary"


