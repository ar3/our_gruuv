- content_for :go_back_link do
  = link_to organization_prompt_path(@organization, @prompt), class: "go-back-link" do
    %i.bi.bi-arrow-left.me-2
    Back to Prompt

- content_for :header do
  .d-flex.align-items-center.justify-content-between
    %h1.mb-0.me-2
      %i.bi.bi-file-text.me-2
      Edit Prompt: #{@prompt_template.title}
    .dropdown
      %button.btn.btn-outline-secondary.btn-sm.dropdown-toggle{"data-bs-toggle" => "dropdown", "aria-expanded" => "false", type: "button", id: "view-toggle-dropdown"}
        %i.bi.bi-layout-text-window-reverse.me-2
        = @view_style == 'split' ? 'Split View' : 'Vertical View'
      %ul.dropdown-menu
        %li
          - if @view_style == 'vertical'
            .dropdown-item.text-muted
              %i.bi.bi-list-ul.me-2
              Vertical View (Active)
              %i.bi.bi-check-circle.text-success.ms-2
          - else
            %a.dropdown-item.view-switch-link{"data-view" => "vertical", href: "#"}
              %i.bi.bi-list-ul.me-2
              Vertical View
        %li
          - if @view_style == 'split'
            .dropdown-item.text-muted
              %i.bi.bi-columns.me-2
              Split View (Active)
              %i.bi.bi-check-circle.text-success.ms-2
          - else
            %a.dropdown-item.view-switch-link{"data-view" => "split", href: "#"}
              %i.bi.bi-columns.me-2
              Split View

.card
  .card-header
    %h5.mb-0
      %i.bi.bi-question-circle.me-2
      Answer Questions
  .card-body
    = form_with url: organization_prompt_path(@organization, @prompt), method: :patch, local: true, id: "prompt-edit-form" do |form|
      - if @prompt.errors.any?
        .alert.alert-danger
          %h4= "#{pluralize(@prompt.errors.count, "error")} prohibited this prompt from being saved:"
          %ul.mb-0
            - @prompt.errors.full_messages.each do |message|
              %li= message
      
      - if @view_style == 'split'
        / Split View: 3x9 column layout
        - @prompt_questions.each do |question|
          .row.mb-4
            .col-sm-3.col-12.mb-3.mb-sm-0
              = form.label "prompt_answers[#{question.id}][text]", question.label, class: 'form-label fw-bold'
              - if question.helper_text.present?
                %small.text-muted.d-block.mt-1= question.helper_text
            .col-sm-9.col-12
              = form.text_area "prompt_answers[#{question.id}][text]", 
                              value: @prompt_answers[question.id]&.text,
                              class: 'form-control', 
                              rows: 4,
                              placeholder: question.placeholder_text.presence || 'Enter your answer...'
      - else
        / Vertical View: fully vertical form (original)
        - @prompt_questions.each do |question|
          .mb-4
            = form.label "prompt_answers[#{question.id}][text]", question.label, class: 'form-label fw-bold' do
              = question.label
              - if question.helper_text.present?
                %small.text-muted.d-block.mt-1= question.helper_text
            = form.text_area "prompt_answers[#{question.id}][text]", 
                            value: @prompt_answers[question.id]&.text,
                            class: 'form-control', 
                            rows: 4,
                            placeholder: question.placeholder_text.presence || 'Enter your answer...'
      
      .d-flex.justify-content-between.mt-4
        = link_to 'Cancel', organization_prompt_path(@organization, @prompt), class: 'btn btn-secondary'
        .d-flex.gap-2
          = form.submit 'Save Answers', class: 'btn btn-primary'
          - if policy(@prompt).close?
            = link_to close_organization_prompt_path(@organization, @prompt), method: :patch, class: 'btn btn-outline-secondary', data: { confirm: "Are you sure you want to close this prompt? You won't be able to edit it after closing." } do
              Close Prompt

:javascript
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('prompt-edit-form');
    const viewSwitchLinks = document.querySelectorAll('.view-switch-link');
    
    viewSwitchLinks.forEach(function(link) {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        
        const targetView = this.getAttribute('data-view');
        
        // Add hidden field for target view
        let hiddenField = document.getElementById('switch_to_view');
        if (!hiddenField) {
          hiddenField = document.createElement('input');
          hiddenField.type = 'hidden';
          hiddenField.name = 'switch_to_view';
          hiddenField.id = 'switch_to_view';
          form.appendChild(hiddenField);
        }
        hiddenField.value = targetView;
        
        // Submit the form
        form.submit();
      });
    });
  });

