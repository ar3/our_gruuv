- goal = local_assigns[:goal]
- indent_level = local_assigns.fetch(:indent_level, 0)
- all_descendant_goal_ids = local_assigns[:all_descendant_goal_ids]
- linked_goal_check_ins = local_assigns[:linked_goal_check_ins] || {}

- most_recent_check_in = linked_goal_check_ins[goal.id]
- indent_px = indent_level * 30
- status_icon = goal_status_icon(goal)
- is_struck_through = goal_should_be_struck_through?(goal)

%li.mb-2{style: indent_level > 0 ? "margin-left: #{indent_px}px;" : ""}
  - if indent_level > 0
    %i.bi.bi-arrow-90deg-down.rotate-270{style: "margin-right: 0.5rem;"}
  %i.bi{class: status_icon, style: "margin-right: 0.5rem;"}
  %strong{class: is_struck_through ? 'text-decoration-line-through' : ''}= goal.title
  - if goal.calculated_target_date.present?
    %span.text-muted.ms-1
      by #{goal.calculated_target_date.strftime('%b %d, %Y')}
  - if most_recent_check_in.present?
    %small.text-muted.d-block.mt-1
      = render 'organizations/goals/goal_check_in_sentence', check_in: most_recent_check_in, goal: goal
  %br
  - # Render children recursively
  - child_goals = goal.outgoing_links.includes(:child).map(&:child).compact.select { |g| all_descendant_goal_ids.include?(g.id) }
  - if child_goals.any?
    %ul.list-unstyled.mt-2
      - child_goals.each do |child_goal|
        = render 'organizations/prompts/goal_hierarchy_item', goal: child_goal, indent_level: indent_level + 1, all_descendant_goal_ids: all_descendant_goal_ids, linked_goal_check_ins: linked_goal_check_ins
