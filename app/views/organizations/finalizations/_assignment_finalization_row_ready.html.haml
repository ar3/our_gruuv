-# Assignment Finalization Row - Ready to Finalize
%tr
  %td
    %strong= check_in.assignment.title
  %td
    %div
      = assignment_rating_display(check_in.employee_rating)
    - if check_in.actual_energy_percentage.present?
      %small.text-muted Energy: #{check_in.actual_energy_percentage}%
    %small.text-muted= simple_format(check_in.employee_private_notes)
  %td
    %div
      = assignment_rating_display(check_in.manager_rating)
    %small.text-muted= simple_format(check_in.manager_private_notes)
  %td
    - if view_mode == :employee
      %small.text-muted Waiting for manager to set
    - else
      = form.text_area "assignment_check_ins[#{check_in.id}][shared_notes]", class: "form-control form-control-sm", rows: 2, placeholder: "Shared summary and action items..."
  %td
    %div.mb-2
      - if view_mode == :employee
        %small.text-muted Waiting for manager to set
      - else
        = form.select "assignment_check_ins[#{check_in.id}][official_rating]", assignment_rating_options, { selected: check_in.manager_rating || check_in.employee_rating, prompt: 'Select rating...' }, { class: "form-select form-select-sm", required: true }
    %div.mb-2
      - if view_mode == :employee
        %small.text-muted Waiting for manager to set
      - else
        - default_energy = check_in.actual_energy_percentage || check_in.assignment_tenure&.anticipated_energy_percentage || 0
        = form.select "assignment_check_ins[#{check_in.id}][anticipated_energy_percentage]", options_for_select((0..20).map { |i| ["#{i * 5}%", i * 5] }, default_energy), {}, { class: "form-select form-select-sm", required: true }
  %td.text-center
    - if view_mode == :employee
      = form.check_box "assignment_check_ins[#{check_in.id}][finalize]", { class: "form-check-input", disabled: true }, "1", "0"
      %br
      %small.text-muted (Manager only)
    - else
      = form.check_box "assignment_check_ins[#{check_in.id}][finalize]", { class: "form-check-input" }, "1", "0"
