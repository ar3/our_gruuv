- content_for :header do
  %h1.mb-0 Finalize Check-Ins for #{@person.display_name}
  - if @position_check_in&.officially_completed?
    - if @assignment_check_ins&.any?
      %p.text-muted.mb-0 Review finalized position check-in and ready assignment check-ins
    - else
      %p.text-muted.mb-0 Review finalized check-ins
  - elsif current_person == @person
    %p.text-muted.mb-0 Review your check-ins that are ready for finalization
  - else
    %p.text-muted.mb-0 Review ready check-ins and finalize selected ones
        
- content_for :header_action do
  = render 'people/view_switcher'

- content_for :go_back_link do
  = link_to organization_person_check_ins_path(@organization, @person), class: "go-back-link" do
    %i.bi.bi-arrow-left.me-2
    Back to Check-Ins
  
- if @position_check_in&.officially_completed?
  = render 'position_finalization_section'
  
  = render 'assignment_finalization_section'

- elsif current_person == @person
  = render 'position_finalization_section'
  
  = render 'assignment_finalization_section'

- else
  -# Manager Finalization View
  = form_with url: organization_person_finalization_path(@organization, @person), method: :post do |f|
    = render 'position_finalization_section', form: f
    
    = render 'assignment_finalization_section'
    
    = render 'aspiration_finalization_section', form: f
    
    -# Only show the finalization button if there are check-ins to finalize
    - if @position_check_in || @assignment_check_ins&.any? || @aspiration_check_ins&.any?
      .row.mt-4
        .col-12
          .alert.alert-warning
            %strong ⚠️ This will:
            %ul
              %li Create MAAP snapshot with complete ratings
              %li Close selected tenures and open new ones
              %li Make all notes visible to #{@person.first_name}
              %li Send notification to #{@person.first_name}
          
          = f.submit 'Finalize Selected Check-Ins', class: 'btn btn-success btn-lg',
                     data: { confirm: 'Are you sure you want to finalize these check-ins?' }
    - else
      .row.mt-4
        .col-12
          .alert.alert-info
            %i.bi.bi-info-circle.me-2
            %strong No check-ins are ready for finalization at this time.