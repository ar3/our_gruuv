- content_for :header do
  %h1.mb-0 Finalize Check-Ins for #{@person.display_name}
        
- content_for :header_action do
  = render 'people/view_switcher'

- content_for :go_back_link do
  = link_to organization_person_check_ins_path(@organization, @person), class: "go-back-link" do
    %i.bi.bi-arrow-left.me-2
    Back to Check-Ins

- if current_person == @person
  -# Employee View (Read-only acknowledgment)
  = render 'organizations/finalizations/employee_acknowledgment_view'

- else
  -# Manager Finalization View
  = form_with url: organization_person_finalization_path(@organization, @person), method: :post do |f|
    
    -# Position Section
    = render 'organizations/check_ins/section_header', 
             title: 'Position/Overall', 
             icon: 'bi-briefcase', 
             description: 'Set official position rating'
    
    = render 'organizations/finalizations/position_finalization_table', form: f
    
    -# Assignment Section
    = render 'organizations/check_ins/section_header', 
             title: 'Assignments/Outcomes', 
             icon: 'bi-clipboard-check', 
             description: 'Finalize individual assignment ratings and energy'
    
    = render 'organizations/finalizations/assignment_finalization_table', form: f
    
    -# Aspiration Section
    = render 'organizations/check_ins/section_header', 
             title: 'Aspirations/Values', 
             icon: 'bi-star', 
             description: 'Set official aspiration ratings'
    
    = render 'organizations/finalizations/aspiration_finalization_table', form: f
    
    -# Only show the finalization button if there are check-ins to finalize
    - if @ready_position_check_in || @ready_assignment_check_ins&.any? || @ready_aspiration_check_ins&.any?
      .row.mt-4
        .col-12
          .alert.alert-warning
            %strong ⚠️ This will:
            %ul
              %li Create MAAP snapshot with complete ratings
              %li Close selected tenures and open new ones
              %li Make all notes visible to #{@person.first_name}
              %li Send notification to #{@person.first_name}
          
          = f.submit 'Finalize Selected Check-Ins', class: 'btn btn-success btn-lg',
                     data: { confirm: 'Are you sure you want to finalize these check-ins?' }
    - else
      .row.mt-4
        .col-12
          .alert.alert-info
            %i.bi.bi-info-circle.me-2
            %strong No check-ins are ready for finalization at this time.