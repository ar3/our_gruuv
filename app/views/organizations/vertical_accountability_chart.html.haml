- content_for :header do
  %h1.mb-0 Vertical Accountability Chart
  
- content_for :go_back_link do
  = link_to organization_path(@organization), class: "text-muted text-decoration-none" do
    %i.bi.bi-arrow-left.me-2
    Back to Organization

.container-fluid.py-4
  .row
    .col-12
      - if @hierarchy_tree.empty?
        .alert.alert-info
          %h5.mb-3
            %i.bi.bi-info-circle.me-2
            No Employees Found
          %p No active employees found in this organization to display in the accountability chart.
      - else
        .tree-visualization{style: "padding: 20px;"}
          - @hierarchy_tree.each do |root_node|
            = render 'organizations/vertical_accountability_chart/employee_node', node: root_node, depth: 0, organization: @organization
        
        - if @unassigned_teammates.any?
          %hr.mt-5.mb-4
          .mt-4
            %h4.mb-3
              %i.bi.bi-people.me-2
              Company Teammates Without Active Positions
            .row
              - @unassigned_teammates.each do |teammate|
                .col-md-6.col-lg-4.mb-3
                  .card
                    .card-body.p-2
                      .d-flex.align-items-start
                        .flex-shrink-0.me-3
                          = teammate_profile_image(teammate, size: 48)
                        .flex-grow-1
                          - if policy(teammate).show?
                            = link_to teammate.person.display_name, internal_organization_company_teammate_path(@organization, teammate), class: "text-decoration-none fw-bold"
                          - else
                            %span.fw-bold= teammate.person.display_name
                          %br
                          %span.text-muted.small= teammate.person.email

:javascript
  // Handle collapse/expand icon toggle
  document.addEventListener('DOMContentLoaded', function() {
    const toggleButtons = document.querySelectorAll('.toggle-children');
    
    toggleButtons.forEach(function(button) {
      const targetId = button.getAttribute('data-bs-target');
      const target = document.querySelector(targetId);
      const icon = button.querySelector('.toggle-icon');
      
      if (target) {
        // Set initial icon state based on whether it's expanded
        if (target.classList.contains('show')) {
          icon.classList.remove('bi-chevron-up');
          icon.classList.add('bi-chevron-down');
        } else {
          icon.classList.remove('bi-chevron-down');
          icon.classList.add('bi-chevron-up');
        }
        
        // Listen for Bootstrap collapse events
        target.addEventListener('show.bs.collapse', function() {
          icon.classList.remove('bi-chevron-up');
          icon.classList.add('bi-chevron-down');
        });
        
        target.addEventListener('hide.bs.collapse', function() {
          icon.classList.remove('bi-chevron-down');
          icon.classList.add('bi-chevron-up');
        });
      }
    });
  });

