- content_for :title, "Edit Company Channel Settings"

- content_for :header do
  %h1.mb-0
    %i.bi.bi-hash.me-2
    Edit Company-Only Channel Settings

- content_for :go_back_link do
  = link_to channels_organization_slack_path(@organization), class: "text-muted text-decoration-none" do
    %i.bi.bi-arrow-left.me-2
    Back to Channel & Group Associations

- can_manage_slack = policy(@organization).manage_employment?

.row.justify-content-center
  .col-lg-8
    - unless can_manage_slack
      .alert.alert-warning.mb-4
        %strong
          %i.bi.bi-exclamation-triangle.me-2
          You cannot modify channel or group associations on this page.
        %p.mb-1.mt-2
          Only teammates with permission to manage employment can change these settings. If you see something that should be changed, contact one of them:
        - if @teammates_with_manage_employment.present?
          %ul.mb-0.mt-1
            - @teammates_with_manage_employment.each do |name|
              %li= name
        - else
          %p.mb-0.small
            %em No teammates with this permission in this organization.

    .card
      .card-header.d-flex.justify-content-between.align-items-center
        %h5.mb-0
          %i.bi.bi-building.me-2
          = @target_organization.name
        %span.badge.bg-primary
          Company
      .card-body
        = form_with model: @target_organization,
                    url: company_channel_organization_slack_path(@organization, target_organization_id: @target_organization.id),
                    method: :patch,
                    local: true,
                    scope: :organization do |form|
          .mb-3
            %label.form-label Organization
            %p.mb-0
              %strong= @target_organization.name
              %br
              %small.text-muted Company

          .mb-4
            = form.label :huddle_review_channel_id, "Huddle Review Channel", class: "form-label"
            - org = @target_organization
            = form.select :huddle_review_channel_id,
                          options_from_collection_for_select(@slack_channels, :third_party_id, :display_name, org.huddle_review_notification_channel_id),
                          { prompt: 'Select channel', include_blank: 'None' },
                          { class: 'form-select', disabled: !can_manage_slack }
            %small.form-text.text-muted
              Channel where weekly huddle review summaries will be posted

          .mb-4
            = form.label :maap_object_comment_channel_id, "Comment Channel", class: "form-label"
            = form.select :maap_object_comment_channel_id,
                          options_from_collection_for_select(@slack_channels, :third_party_id, :display_name, org.maap_object_comment_channel_id),
                          { prompt: 'Select channel', include_blank: 'None' },
                          { class: 'form-select', disabled: !can_manage_slack }
            %small.form-text.text-muted
              Channel where notifications for new root-level comments on assignments, abilities, and aspirations will be posted

          .mb-4
            = form.label :kudos_channel_id, "Kudos Channel", class: "form-label"
            = form.select :kudos_channel_id,
                          options_from_collection_for_select(@slack_channels, :third_party_id, :display_name, org.kudos_channel_id),
                          { prompt: 'Select channel', include_blank: 'None' },
                          { class: 'form-select', disabled: !can_manage_slack }
            %small.form-text.text-muted
              Channel where kudos messages will be posted

          .d-flex.justify-content-between.mt-4
            = link_to 'Cancel', channels_organization_slack_path(@organization), class: 'btn btn-outline-secondary'
            - if can_manage_slack
              = form.submit 'Save Settings', class: 'btn btn-primary'
            - else
              %button.btn.btn-primary{type: "button", disabled: true} Save Settings

