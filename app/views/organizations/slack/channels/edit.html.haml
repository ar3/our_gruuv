- content_for :title, "Edit Channel Settings"

- content_for :header do
  %h1.mb-0
    %i.bi.bi-hash.me-2
    Edit Channel Settings

- content_for :go_back_link do
  = link_to channels_organization_slack_path(@organization), class: "text-muted text-decoration-none" do
    %i.bi.bi-arrow-left.me-2
    Back to Channel & Group Associations

.row.justify-content-center
  .col-lg-8
    .card
      .card-header.d-flex.justify-content-between.align-items-center
        %h5.mb-0
          %i.bi.bi-people.me-2
          = @target_organization.name
        %span.badge.bg-secondary
          Organization
      .card-body
        = form_with model: @target_organization,
                    url: channel_organization_slack_path(@organization, target_organization_id: @target_organization.id),
                    method: :patch,
                    local: true,
                    scope: :organization do |form|
          .mb-3
            %label.form-label Organization
            %p.mb-0
              %strong= @target_organization.name
              %br
              %small.text-muted Organization

          .mb-4
            = form.label :kudos_channel_id, "Kudos Channel", class: "form-label"
            = form.select :kudos_channel_id,
                          options_from_collection_for_select(@slack_channels, :third_party_id, :display_name, @target_organization.kudos_channel_id),
                          { prompt: 'Select channel', include_blank: 'None' },
                          { class: 'form-select' }
            %small.form-text.text-muted
              Channel where kudos messages will be posted

          .mb-4
            = form.label :slack_group_id, "Slack Group", class: "form-label"
            = form.select :slack_group_id,
                          options_from_collection_for_select(@slack_groups, :third_party_id, :display_name, @target_organization.slack_group_id),
                          { prompt: 'Select group', include_blank: 'None' },
                          { class: 'form-select' }
            %small.form-text.text-muted
              Default Slack group for routing notifications

          - if @teams.present?
            %hr.my-4
            %h6.mb-3
              %i.bi.bi-people-fill.me-2
              Team Huddle Channels
            %p.text-muted.small
              Select which Slack channel should receive huddle notifications for each team.

            - @teams.each do |team|
              .mb-3
                = form.label "team_huddle_channels_#{team.id}", team.name, class: "form-label"
                = form.select "team_huddle_channels[#{team.id}]",
                              options_from_collection_for_select(@slack_channels, :third_party_id, :display_name, team.huddle_channel_id),
                              { prompt: 'Select channel', include_blank: 'None' },
                              { class: 'form-select', id: "team_huddle_channels_#{team.id}" }
                %small.form-text.text-muted
                  Huddle notifications for #{team.name} will be posted to this channel

          .d-flex.justify-content-between.mt-4
            = link_to 'Cancel', channels_organization_slack_path(@organization), class: 'btn btn-outline-secondary'
            = form.submit 'Save Settings', class: 'btn btn-primary'


