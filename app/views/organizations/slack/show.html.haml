- content_for :title, "Slack Configuration"

- content_for :header do
  %h1.mb-0{id: "slack-title"}
    %i.bi.bi-slack.me-2
    Slack Configuration

- content_for :go_back_link do
  = link_to organization_path(@organization), class: "text-muted text-decoration-none" do
    %i.bi.bi-arrow-left.me-2
    Back to Organization

.row.justify-content-center
  .col-lg-10
    / Section 1: Slack Setup/Configuration
    .card.mb-4
      .card-header
        %h5.mb-0
          %i.bi.bi-slack.me-2
          Slack Setup & Configuration
      .card-body
        = slack_configuration_status(@organization)
        
        - if @slack_config&.configured?
          / Bot Configuration Form (always visible, no edit button)
          .row.mt-3
            .col-12
              %h6.mb-3 Bot Configuration
              = form_with model: @slack_config, url: update_configuration_organization_slack_path(@organization), method: :patch, local: true do |form|
                .row
                  .col-md-4
                    = form.label :default_channel, "Default Channel", class: "form-label"
                    = form.text_field :default_channel, class: "form-control", placeholder: "#bot-test", value: @slack_config.default_channel_or_general
                  .col-md-4
                    = form.label :bot_username, "Bot Username", class: "form-label"
                    = form.text_field :bot_username, class: "form-control", placeholder: "OG", value: @slack_config.bot_username_or_default
                  .col-md-4
                    = form.label :bot_emoji, "Bot Emoji", class: "form-label"
                    = form.text_field :bot_emoji, class: "form-control", placeholder: ":sparkles:", value: @slack_config.bot_emoji_or_default
                .row.mt-3
                  .col-12
                    = form.submit "Update Configuration", class: "btn btn-primary btn-sm"
          
          / Test Buttons
          .row.mt-4{"data-controller" => "slack-test", "data-slack-test-organization-id-value" => @organization.id}
            .col-md-6
              %h6 Test Connection
              %button.btn.btn-outline-primary.btn-sm{data: {action: "click->slack-test#testConnection"}}
                %i.bi.bi-wifi.me-1
                Test Connection
              #connectionResult.mt-2
            
            .col-md-6
              %h6 List Channels
              %button.btn.btn-outline-secondary.btn-sm{data: {action: "click->slack-test#listChannels"}}
                %i.bi.bi-list.me-1
                List Channels
              #channelsResult.mt-2
          
          .row.mt-3{"data-controller" => "slack-test", "data-slack-test-organization-id-value" => @organization.id}
            .col-12
              %h6 Send Test Message
              .input-group
                %input.form-control#testMessage{type: "text", placeholder: "Enter test message...", value: "ðŸ§ª Test message from OurGruuv!", data: {slack_test_target: "messageInput"}}
                %button.btn.btn-outline-success{data: {action: "click->slack-test#sendTestMessage"}}
                  %i.bi.bi-send.me-1
                  Send
              #messageResult.mt-2
          
          / Uninstall Button
          .row.mt-4
            .col-12
              = button_to oauth_uninstall_organization_slack_path(@organization), method: :delete, class: "btn btn-outline-danger", data: { confirm: "Are you sure you want to uninstall Slack from #{@organization.display_name}?" } do
                %i.bi.bi-trash.me-2
                Uninstall Slack
        - else
          = link_to oauth_authorize_organization_slack_path(@organization), class: "btn btn-primary mt-3" do
            %i.bi.bi-slack.me-2
            Install Slack for #{@organization.display_name}
    
    / Section 2: Teammate Associations Summary
    - if @slack_config&.configured?
      = teammate_association_stats(@organization, @total_slack_users, @total_teammates, @linked_teammates)
      
      / Refresh Slack Profiles Button
      .card.mb-4
        .card-body
          = button_to refresh_slack_profiles_organization_path(@organization), method: :post, class: "btn btn-outline-primary", data: { confirm: "This will match Slack profiles to teammates by email. Existing associations will not be changed. Continue?" } do
            %i.bi.bi-arrow-clockwise.me-2
            Refresh Slack Profiles
    
    / Section 3: Channel & Group Associations Summary
    - if @slack_config&.configured?
      = channel_association_stats(@organization, @total_channels, @total_groups, @total_departments, @total_teams)
