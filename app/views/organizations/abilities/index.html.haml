- content_for :title, "Abilities"

- content_for :go_back_link do
  = link_to organization_path(@organization), class: "go-back-link" do
    %i.bi.bi-arrow-left.me-2
    Back to #{@organization.display_name}

- content_for :header do
  .d-flex.align-items-center
    %h1.mb-0.me-2.mr-2
      %i.bi.bi-lightning.me-2
      Abilities
    .d-flex.align-items-center
      - if policy(Ability).create?
        = link_to new_organization_ability_path(@organization), class: "btn btn-primary ml-2" do
          %i.bi.bi-plus
      - else
        .btn.btn-primary.disabled
          %i.bi.bi-plus
        %i.bi.bi-exclamation-triangle.text-warning.ms-2{"data-bs-toggle" => "tooltip", "data-bs-title" => "You need ability management permissions for this organization to create abilities"}

- content_for :header_action do
  - customize_params = params.except(:controller, :action, :page).permit!.to_h
  = link_to customize_view_organization_abilities_path(@organization, customize_params), class: "btn btn-outline-secondary" do
    %i.bi.bi-sliders.me-2
    Customize View

/ Spotlight Section
.row.justify-content-center.mb-4
  .col-lg-12
    .card.border-0.shadow-sm
      .card-body
        .row
          .col-md-8
            .row.text-center
              .col-3
                .h3.text-primary= @abilities.count
                %small.text-muted Total Abilities
              .col-3
                .h3.text-success= @abilities.count { |a| a.teammate_milestones.exists? }
                %small.text-muted With Milestones
              .col-3
                .h3.text-info= @abilities.count { |a| a.created_at >= 30.days.ago }
                %small.text-muted Recent (30 days)
              .col-3
                .h3.text-warning= @abilities.joins(:teammate_milestones).distinct.count
                %small.text-muted Active Abilities
            .row.mt-3
              .col-12
                %h6.text-muted.mb-2 Top Abilities by Milestones
                .row
                  - @abilities.sort_by { |a| -a.teammate_milestones.count }.first(3).each do |ability|
                    .col-4
                      .d-flex.align-items-center
                        %span.badge.bg-primary.me-2= ability.teammate_milestones.count
                        %small= ability.name
          .col-md-4
            .text-center
              - if @abilities.any?
                .alert.alert-success.small
                  %i.bi.bi-lightning.me-2
                  %strong #{pluralize(@abilities.count, 'ability')} defined!
              - else
                .alert.alert-info.small
                  %i.bi.bi-info-circle.me-2
                  %strong No abilities yet - create your first!
      .card-footer.bg-light
        .row.align-items-center
          .col-md-6
            %small.text-muted
              %i.bi.bi-funnel.me-1
              Filters: All Abilities
              %br
              %i.bi.bi-sort-down.me-1
              Sort: Most Recent
          .col-md-6.text-end
            %small.text-muted
              %i.bi.bi-table.me-1
              View: Table
              %br
              %i.bi.bi-eye.me-1
              Spotlight: Ability Overview

.row.justify-content-center
  .col-lg-12
    - if @abilities.any?
      .table-responsive
        %table.table.table-hover
          %thead
            %tr
              %th Name
              %th Description
              %th Version
              %th Milestones
              %th Actions
          %tbody
            - @abilities.each do |ability|
              %tr
                %td
                  = link_to organization_ability_path(@organization, ability), class: "text-decoration-none" do
                    %strong= ability.name
                %td= truncate(ability.description, length: 100)
                %td= ability.semantic_version
                %td
                  %span.badge.bg-primary= ability.teammate_milestones.count
                %td
                  .btn-group.btn-group-sm
                    = link_to organization_ability_path(@organization, ability), class: "btn btn-outline-primary", title: "View" do
                      %i.bi.bi-eye
                    = link_to edit_organization_ability_path(@organization, ability), class: "btn btn-outline-secondary", title: "Edit" do
                      %i.bi.bi-pencil
                    = link_to organization_ability_path(@organization, ability), method: :delete, class: "btn btn-outline-danger", title: "Delete", data: { confirm: "Are you sure?" } do
                      %i.bi.bi-trash
    - else
      .alert.alert-info
        %h6.mb-2
          %i.bi.bi-info-circle.me-2
          No Abilities Created
        %p.mb-2 
          Create your first ability to define competencies and skills for your team.
        - if policy(Ability).create?
          = link_to "Create First Ability", new_organization_ability_path(@organization), class: "btn btn-primary btn-sm"
        - else
          .d-flex.align-items-center
            .btn.btn-primary.btn-sm.disabled{style: "opacity: 0.6; cursor: not-allowed;"}
              Create First Ability
            %i.bi.bi-exclamation-triangle.text-warning.ms-2{"data-bs-toggle" => "tooltip", "data-bs-title" => "You need ability management permissions for this organization to create abilities"}
