- hierarchy = Goals::HierarchyQuery.new(goals: @goals).call
- root_goals = hierarchy[:root_goals]
- parent_child_map = hierarchy[:parent_child_map]

- if @goals.empty?
  .alert.alert-info
    %h6.mb-2
      %i.bi.bi-info-circle.me-2
      No goals to display
- else
  
  .list-group
    - most_recent_check_ins_by_goal = @most_recent_check_ins_by_goal || {}
    - if root_goals.empty?
      - @goals.each do |goal|
        - most_recent_check_in = most_recent_check_ins_by_goal[goal.id]
        .list-group-item{class: goal_warning_class(goal)}
          .d-flex.w-100.justify-content-between.align-items-start
            .flex-grow-1
              %h5.mb-1
                = link_to goal.title, organization_goal_path(@organization, goal), class: "text-decoration-none"
                %span.ms-2.badge{class: goal_category_badge_class(goal)}
                  = goal_category_label(goal)
                - if goal.should_show_warning?
                  %i.bi.bi-exclamation-triangle.text-warning.ms-1{"data-bs-toggle" => "tooltip", "data-bs-title" => goal_warning_message(goal)}
              %p.mb-1
                %span.badge.me-2{class: timeframe_badge_class(goal.timeframe), "data-bs-toggle" => "tooltip", "data-bs-title" => timeframe_tooltip_text(goal)}
                  = goal.timeframe.to_s.humanize
                %span.badge.me-2{class: status_badge_class(goal.status)}
                  = goal.status.to_s.humanize
                %span.text-muted.small.ms-2{"data-bs-toggle" => "tooltip", "data-bs-title" => goal_privacy_tooltip_text(goal)}
                  = goal_visibility_display(goal)
                %span.text-muted.small.ms-2
                  = "| Owned by: #{goal_owner_display_name(goal)}"
                - if goal.prompt_goals.any?
                  = link_to "| #{goal_prompt_association_display(goal)}", edit_organization_prompt_path(@organization, goal.prompt_goals.first.prompt), target: '_blank', rel: 'noopener', class: 'text-muted small ms-2 text-decoration-none'
              - if most_recent_check_in.present?
                %p.mb-1.small.text-muted
                  = render 'organizations/goals/goal_check_in_sentence', check_in: most_recent_check_in, goal: goal
            .ms-3
              - if goal.started_at.nil? && policy(goal).update?
                = button_to start_organization_goal_path(@organization, goal), method: :patch, class: "btn btn-primary btn-sm me-2", form: { style: "display: inline-block;" } do
                  %i.bi.bi-play-circle.me-1
                  Start
              = link_to organization_goal_path(@organization, goal), class: "btn btn-outline-primary btn-sm" do
                %i.bi.bi-eye
    - else
      - root_goals.each do |root_goal|
        != render_hierarchical_indented_goal(root_goal, 0, parent_child_map, @organization, most_recent_check_ins_by_goal)

