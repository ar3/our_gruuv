- content_for :title, "Changes Confirmed - #{@person.display_name}"

- content_for :header do
  .d-flex.justify-content-between.align-items-center
    .header-info
      %h1.mb-0 Changes Confirmed
      %p.text-muted.mb-0 Your assignment updates have been saved successfully

- content_for :go_back_link do
  = link_to organization_assignment_tenure_path(@organization, @person), class: "text-muted text-decoration-none" do
    %i.bi.bi-arrow-left.me-1
    Back to Assignment Management

- content_for :top_actions do
  = link_to organization_assignment_tenure_path(@organization, @person), class: "btn btn-primary" do
    %i.bi.bi-check.me-2
    Continue Managing Assignments

.row.justify-content-center
  .col-lg-10
    .card.mb-4
      .card-header.bg-success.text-white
        %h5.mb-0
          %i.bi.bi-check-circle.me-2
          Assignment Updates Confirmed
      .card-body
        .alert.alert-success
          %h6.mb-2
            %i.bi.bi-info-circle.me-2
            Changes Successfully Applied
          %p.mb-0 All your assignment and check-in updates have been saved to #{@person.display_name}'s profile.

    .card.mb-4
      .card-header
        %h5.mb-0
          %i.bi.bi-clipboard-check.me-2
          Updated Assignments
      .card-body
        - if @assignment_data.any?
          .table-responsive
            %table.table.table-hover
              %thead.table-light
                %tr
                  %th Assignment
                  %th Anticipated Energy
                  %th Check-in Status
                  %th Last Updated
              %tbody
                - @assignment_data.each do |data|
                  - assignment = data[:assignment]
                  - tenure = data[:tenure]
                  - check_in = data[:open_check_in]
                  %tr
                    %td
                      %strong= assignment.title
                      %br
                      %small.text-muted= assignment.company.display_name
                    %td
                      - if tenure&.anticipated_energy_percentage
                        %span.badge.bg-primary= "#{tenure.anticipated_energy_percentage}%"
                      - else
                        %span.text-muted Not set
                    %td
                      - if check_in
                        - if check_in.officially_completed?
                          %span.badge.bg-success Completed
                        - elsif check_in.ready_for_finalization?
                          %span.badge.bg-warning Ready for Finalization
                        - elsif check_in.employee_completed? || check_in.manager_completed?
                          %span.badge.bg-info In Progress
                        - else
                          %span.badge.bg-secondary Open
                      - else
                        %span.text-muted No active check-in
                    %td
                      %small.text-muted= Time.current.strftime('%B %d, %Y at %I:%M %p')
        - else
          .text-center.py-4
            %p.text-muted No assignments found.

    .card.mb-4
      .card-header
        %h5.mb-0
          %i.bi.bi-lightning.me-2
          Energy Allocation Summary
      .card-body
        .row
          .col-md-6
            %h6 Total Anticipated Energy
            - total_energy = @assignment_data.sum { |data| data[:tenure]&.anticipated_energy_percentage || 0 }
            .energy-summary
              - if total_energy == 100
                .alert.alert-success
                  %i.bi.bi-check-circle.me-2
                  Perfect! #{total_energy}% total energy allocation
              - elsif total_energy > 100
                .alert.alert-danger
                  %i.bi.bi-exclamation-triangle.me-2
                  Over-allocated! #{total_energy}% total energy allocation
              - elsif total_energy < 100
                .alert.alert-warning
                  %i.bi.bi-info-circle.me-2
                  Under-allocated! #{total_energy}% total energy allocation
              - else
                .alert.alert-info
                  %i.bi.bi-info-circle.me-2
                  No energy allocation set
          .col-md-6
            %h6 Assignment Count
            .assignment-count
              %p.mb-0
                %strong= @assignment_data.count
                %span.text-muted  active assignment#{'s' if @assignment_data.count != 1}

    .row.mt-4
      .col-12.text-center
        = link_to organization_assignment_tenure_path(@organization, @person), class: "btn btn-primary btn-lg me-3" do
          %i.bi.bi-clipboard-check.me-2
          Continue Managing Assignments
        = link_to choose_assignments_organization_assignment_tenure_path(@organization, @person), class: "btn btn-outline-secondary btn-lg" do
          %i.bi.bi-plus.me-2
          Add More Assignments
