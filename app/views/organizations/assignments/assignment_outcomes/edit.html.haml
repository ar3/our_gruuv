- content_for :title, "Edit Outcome"

- content_for :header do
  Edit Outcome

- content_for :return_url do
  = @return_url || organization_assignments_path(@organization)

- content_for :return_text do
  = @return_text || 'Back to Assignments'

= form_with model: [@organization, @assignment, @assignment_outcome], url: organization_assignment_assignment_outcome_path(@organization, @assignment, @assignment_outcome), local: true do |form|
  .row
    .col-md-8
      .card.mb-4
        .card-header
          %h5.mb-0
            %i.bi.bi-bullseye.me-2
            Outcome Details
        .card-body
          - if @assignment_outcome.errors.any?
            .alert.alert-danger
              %h6= "#{pluralize(@assignment_outcome.errors.count, 'error')} prohibited this outcome from being saved:"
              %ul.mb-0
                - @assignment_outcome.errors.full_messages.each do |message|
                  %li= message
          
          .mb-3
            = form.label :description, class: 'form-label' do
              Description
              %span.text-danger *
            = form.text_area :description, class: 'form-control', rows: 3, required: true
          
          .mb-3
            = form.label :outcome_type, class: 'form-label' do
              Type
              %span.text-danger *
            = form.select :outcome_type, options_for_select([['Quantitative', 'quantitative'], ['Sentiment', 'sentiment']], @assignment_outcome.outcome_type), {}, { class: 'form-select', required: true }
          
          .mb-3
            = form.label :progress_report_url, 'Progress Report URL', class: 'form-label'
            = form.url_field :progress_report_url, class: 'form-control', placeholder: 'https://example.com/report'
            %small.form-text.text-muted Where can we find the data for this outcome?
          
          .mb-3
            = form.label :management_relationship_filter, 'Who to Ask: Management Relationship', class: 'form-label'
            = form.select :management_relationship_filter, options_for_select([['Doesn\'t matter', ''], ['Actively a direct employee of the Assignment holder', 'direct_employee'], ['Actively the direct manager of the Assignment holder', 'direct_manager'], ['No managerial relationship with assignment holder', 'no_relationship']], @assignment_outcome.management_relationship_filter), {}, { class: 'form-select' }
            %small.form-text.text-muted Filter who should be asked based on management relationship
          
          .mb-3
            = form.label :team_relationship_filter, 'Who to Ask: Team Relationship', class: 'form-label'
            = form.select :team_relationship_filter, options_for_select([['Doesn\'t matter', ''], ['On the same team as the Assignment holder', 'same_team'], ['Not on the same team as the Assignment holder', 'different_team']], @assignment_outcome.team_relationship_filter), {}, { class: 'form-select' }
            %small.form-text.text-muted Filter who should be asked based on team relationship
          
          .mb-3
            = form.label :consumer_assignment_filter, 'Who to Ask: Consumer Assignment Relationship', class: 'form-label'
            = form.select :consumer_assignment_filter, options_for_select([['Doesn\'t matter', ''], ['Teammate is currently an active ConsumerAssignment holder to this SupplierAssignment', 'active_consumer'], ['Teammate is not currently an active ConsumerAssignment holder to this SupplierAssignment', 'not_consumer']], @assignment_outcome.consumer_assignment_filter), {}, { class: 'form-select' }
            %small.form-text.text-muted Filter who should be asked based on consumer assignment relationship
          
          .d-flex.align-items-center.gap-2.mt-4
            - can_update = policy(@assignment_outcome).update?
            - if can_update
              = form.submit 'Save Outcome', class: 'btn btn-primary'
            - else
              .d-flex.align-items-center.gap-2.w-100
                .flex-grow-1
                  = form.submit 'Save Outcome', class: 'btn btn-primary', disabled: true, style: 'opacity: 0.6; cursor: not-allowed;'
                %i.bi.bi-exclamation-triangle.text-warning{data: {bs_toggle: 'tooltip', bs_title: 'Requires MAAP management permission'}}
            = link_to 'Cancel', @return_url || organization_assignments_path(@organization), class: 'btn btn-outline-secondary'
      