- content_for :go_back_link do
  = link_to organization_path(@organization), class: "go-back-link" do
    %i.bi.bi-arrow-left.me-2
    Back to #{@organization.display_name}

- content_for :header do
  .d-flex.justify-content-between.align-items-center
    %h1.mb-0 
      %i.bi.bi-briefcase.me-2
      Assignments
      = link_to new_organization_assignment_path(@organization), class: "btn btn-primary" do
        %i.bi.bi-plus

- content_for :header_action do
  %button.btn.btn-outline-secondary{"data-bs-toggle" => "modal", "data-bs-target" => "#assignmentFilterModal", type: "button"}
    %i.bi.bi-funnel.me-2
    Filter & Sort

.row.justify-content-center
  .col-lg-12
    - if @assignments.any?
      .table-responsive
        %table.table.table-hover
          %thead
            %tr
              %th Assignment
              %th Company
              %th Outcomes
              %th Abilities
              %th External References
              %th Actions
          %tbody
            - @assignments.each do |assignment|
              %tr
                %td
                  %strong= assignment.title
                  %br
                  %small.text-muted= assignment.tagline
                %td
                  %i.bi.bi-building.me-1
                  = assignment.company_name
                %td
                  - if assignment.assignment_outcomes.any?
                    %span.badge.bg-info.me-1
                      = assignment.assignment_outcomes.count
                    - outcome_types = assignment.assignment_outcomes.group(:outcome_type).count
                    - outcome_types.each do |type, count|
                      %span.badge.me-1{class: type == 'sentiment' ? 'bg-warning' : 'bg-secondary'}
                        = "#{type.titleize}: #{count}"
                  - else
                    %span.text-muted
                      %i.bi.bi-exclamation-triangle.me-1
                      None
                %td
                  - if assignment.abilities.any?
                    %span.badge.bg-primary.me-1
                      = assignment.abilities.count
                    - assignment.abilities.limit(3).each do |ability|
                      %span.badge.bg-light.text-dark.me-1
                        = ability.name
                    - if assignment.abilities.count > 3
                      %span.text-muted +#{assignment.abilities.count - 3} more
                  - else
                    %span.text-muted
                      %i.bi.bi-exclamation-triangle.me-1
                      None
                %td
                  - if assignment.published_url.present? || assignment.draft_url.present?
                    %span.badge.bg-success.me-1
                      %i.bi.bi-link-45deg.me-1
                      Available
                  - else
                    %span.text-muted
                      %i.bi.bi-dash.me-1
                      None
                %td
                  .btn-group.btn-group-sm
                    = link_to organization_assignment_path(@organization, assignment), class: "btn btn-outline-primary", title: "View" do
                      %i.bi.bi-eye
                    = link_to edit_organization_assignment_path(@organization, assignment), class: "btn btn-outline-secondary", title: "Edit" do
                      %i.bi.bi-pencil
                    = link_to organization_assignment_path(@organization, assignment), method: :delete, class: "btn btn-outline-danger", title: "Delete", data: { confirm: "Are you sure?" } do
                      %i.bi.bi-trash
    - else
      .alert.alert-info
        %h6.mb-2
          %i.bi.bi-info-circle.me-2
          No Assignments Created
        %p.mb-2 
          Create your first assignment to define clear roles and responsibilities for your team.
        = link_to "Create First Assignment", new_organization_assignment_path(@organization), class: "btn btn-primary btn-sm"

/ Modal for Filter & Sort
#assignmentFilterModal.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "assignmentFilterModalLabel", tabindex: "-1"}
  .modal-dialog.modal-lg
    .modal-content
      .modal-header
        %h5.modal-title#assignmentFilterModalLabel
          %i.bi.bi-funnel.me-2
          Filter & Sort Assignments (coming soon)
        %button.btn-close{"aria-label" => "Close", "data-bs-dismiss" => "modal", type: "button"}
      .modal-body
        .row
          .col-md-6
            %h6.mb-3
              %i.bi.bi-funnel.me-2
              Filters
            .mb-3
              %label.form-label Company
              %select.form-select
                %option All Companies
                %option CareerPlug
                %option Other Companies
            .mb-3
              %label.form-label Has Outcomes
              .form-check
                %input.form-check-input{type: "checkbox", name: "hasOutcomes"}
                %label.form-check-label
                  Only assignments with outcomes
            .mb-3
              %label.form-label Has Abilities
              .form-check
                %input.form-check-input{type: "checkbox", name: "hasAbilities"}
                %label.form-check-label
                  Only assignments with ability requirements
            .mb-3
              %label.form-label External References
              .form-check
                %input.form-check-input{type: "checkbox", name: "hasReferences"}
                %label.form-check-label
                  Only assignments with external references
          .col-md-6
            %h6.mb-3
              %i.bi.bi-sort-down.me-2
              Sort Options
            .mb-3
              %label.form-label Sort By
              %select.form-select
                %option Title (A-Z)
                %option Title (Z-A)
                %option Company (A-Z)
                %option Company (Z-A)
                %option Most Outcomes
                %option Fewest Outcomes
                %option Most Abilities
                %option Fewest Abilities
            .mb-3
              %label.form-label View Style
              .form-check
                %input.form-check-input{checked: "checked", type: "radio", name: "viewStyle", value: "table"}
                %label.form-check-label
                  %i.bi.bi-table.me-2
                  Table View
              .form-check
                %input.form-check-input{type: "radio", name: "viewStyle", value: "cards"}
                %label.form-check-label
                  %i.bi.bi-grid.me-2
                  Card View
              .form-check
                %input.form-check-input{type: "radio", name: "viewStyle", value: "list"}
                %label.form-check-label
                  %i.bi.bi-list.me-2
                  List View
            .mb-3
              %label.form-label Spotlight
              %select.form-select
                %option No Spotlight
                %option Most Popular Assignments
                %option Recently Created
                %option High-Impact Assignments
      .modal-footer
        %button.btn.btn-secondary{"data-bs-dismiss" => "modal", type: "button"} Cancel
        %button.btn.btn-primary.disabled{type: "button"}
          %i.bi.bi-check.me-2
          Apply Filters
