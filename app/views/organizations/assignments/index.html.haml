- content_for :go_back_link do
  = link_to organization_path(@organization), class: "go-back-link" do
    %i.bi.bi-arrow-left.me-2
    Back to #{@organization.display_name}

- content_for :header do
  .d-flex.justify-content-between.align-items-center
    %h1.mb-0 
      %i.bi.bi-briefcase.me-2
      Assignments
      = link_to new_organization_assignment_path(@organization), class: "btn btn-primary" do
        %i.bi.bi-plus

- content_for :header_action do
  - customize_params = params.except(:controller, :action, :page).permit!.to_h
  = link_to customize_view_organization_assignments_path(@organization, customize_params), class: "btn btn-outline-secondary" do
    %i.bi.bi-sliders.me-2
    Customize View

.row.justify-content-center
  .col-lg-12
    - if @assignments.any?
      .table-responsive
        %table.table.table-hover
          %thead
            %tr
              %th Assignment
              %th Version
              %th Company
              %th Outcomes
              %th Abilities
              %th External References
              %th Actions
          %tbody
            - @assignments.each do |assignment|
              %tr
                %td
                  %strong= assignment.title
                  %br
                  %small.text-muted= assignment.tagline
                %td= assignment.semantic_version
                %td
                  %i.bi.bi-building.me-1
                  = assignment.company_name
                %td
                  - if assignment.assignment_outcomes.any?
                    %span.badge.bg-info.me-1
                      = assignment.assignment_outcomes.count
                    - outcome_types = assignment.assignment_outcomes.group(:outcome_type).count
                    - outcome_types.each do |type, count|
                      %span.badge.me-1{class: type == 'sentiment' ? 'bg-warning' : 'bg-secondary'}
                        = "#{type.titleize}: #{count}"
                  - else
                    %span.text-muted
                      %i.bi.bi-exclamation-triangle.me-1
                      None
                %td
                  - if assignment.abilities.any?
                    %span.badge.bg-primary.me-1
                      = assignment.abilities.count
                    - assignment.abilities.limit(3).each do |ability|
                      %span.badge.bg-light.text-dark.me-1
                        = ability.name
                    - if assignment.abilities.count > 3
                      %span.text-muted +#{assignment.abilities.count - 3} more
                  - else
                    %span.text-muted
                      %i.bi.bi-exclamation-triangle.me-1
                      None
                %td
                  - if assignment.published_url.present? || assignment.draft_url.present?
                    %span.badge.bg-success.me-1
                      %i.bi.bi-link-45deg.me-1
                      Available
                  - else
                    %span.text-muted
                      %i.bi.bi-dash.me-1
                      None
                %td
                  .btn-group.btn-group-sm
                    = link_to organization_assignment_path(@organization, assignment), class: "btn btn-outline-primary", title: "View" do
                      %i.bi.bi-eye
                    = link_to edit_organization_assignment_path(@organization, assignment), class: "btn btn-outline-secondary", title: "Edit" do
                      %i.bi.bi-pencil
                    = link_to organization_assignment_path(@organization, assignment), method: :delete, class: "btn btn-outline-danger", title: "Delete", data: { confirm: "Are you sure?" } do
                      %i.bi.bi-trash
    - else
      .alert.alert-info
        %h6.mb-2
          %i.bi.bi-info-circle.me-2
          No Assignments Created
        %p.mb-2 
          Create your first assignment to define clear roles and responsibilities for your team.
        = link_to "Create First Assignment", new_organization_assignment_path(@organization), class: "btn btn-primary btn-sm"
