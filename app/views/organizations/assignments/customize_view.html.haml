- content_for :title, "Customize View"

- content_for :header do
  Customize Assignments View
- content_for :return_url do
  = @return_url || organization_assignments_path(@organization)
- content_for :return_text do
  = @return_text || 'Back to Assignments'

= form_with url: update_view_organization_assignments_path(@organization), method: :patch, local: true do |form|
  .row
    .col-md-4
      .mb-4
        %h2 Select What Assignments You See
    
    .col-md-8
      / Filters Section
      .card.mb-4
        .card-body
          %label.form-label.fw-bold Select What Assignments You See
          
          .mb-3
            %label.form-label Departments
            - root_company = @organization.root_company || @organization
            - departments = root_company.descendants.select { |org| org.department? }
            - selected_departments = (@current_filters[:departments] || []).map(&:to_s)
            .row.g-2
              / Add "No Department" option for assignments with nil department
              .col-md-6
                .form-check
                  = check_box_tag 'departments[]', 'none', selected_departments.include?('none'), class: 'form-check-input', id: 'department_none'
                  = label_tag 'department_none', "#{root_company.display_name} (No Department)", class: 'form-check-label'
              / Add all departments
              - departments.each do |department|
                .col-md-6
                  .form-check
                    = check_box_tag 'departments[]', department.id, selected_departments.include?(department.id.to_s), class: 'form-check-input', id: "department_#{department.id}"
                    = label_tag "department_#{department.id}", department.display_name, class: 'form-check-label'
          
          .mb-3
            %label.form-label Outcomes
            .btn-group.w-100{role: "group", "aria-label": "Outcomes filter"}
              = radio_button_tag 'outcomes_filter', 'all', (@current_filters[:outcomes_filter].blank? || @current_filters[:outcomes_filter] == 'all'), class: 'btn-check', id: 'outcomes_filter_all'
              = label_tag 'outcomes_filter_all', 'W/ or w/o outcomes', class: 'btn btn-outline-secondary', for: 'outcomes_filter_all'
              = radio_button_tag 'outcomes_filter', 'with', @current_filters[:outcomes_filter] == 'with', class: 'btn-check', id: 'outcomes_filter_with'
              = label_tag 'outcomes_filter_with', 'W/ outcomes', class: 'btn btn-outline-secondary', for: 'outcomes_filter_with'
              = radio_button_tag 'outcomes_filter', 'without', @current_filters[:outcomes_filter] == 'without', class: 'btn-check', id: 'outcomes_filter_without'
              = label_tag 'outcomes_filter_without', 'W/o outcomes', class: 'btn btn-outline-secondary', for: 'outcomes_filter_without'
          
          .mb-3
            %label.form-label Abilities
            .btn-group.w-100{role: "group", "aria-label": "Abilities filter"}
              = radio_button_tag 'abilities_filter', 'all', (@current_filters[:abilities_filter].blank? || @current_filters[:abilities_filter] == 'all'), class: 'btn-check', id: 'abilities_filter_all'
              = label_tag 'abilities_filter_all', 'W/ or w/o abilities', class: 'btn btn-outline-secondary', for: 'abilities_filter_all'
              = radio_button_tag 'abilities_filter', 'with', @current_filters[:abilities_filter] == 'with', class: 'btn-check', id: 'abilities_filter_with'
              = label_tag 'abilities_filter_with', 'W/ abilities', class: 'btn btn-outline-secondary', for: 'abilities_filter_with'
              = radio_button_tag 'abilities_filter', 'without', @current_filters[:abilities_filter] == 'without', class: 'btn-check', id: 'abilities_filter_without'
              = label_tag 'abilities_filter_without', 'W/o abilities', class: 'btn btn-outline-secondary', for: 'abilities_filter_without'
          
          .mb-3
            %label.form-label Major Version
            - major_version_options = [['All Versions', '']] + (0..10).map { |v| ["v#{v}.x.x", v] }
            = select_tag 'major_version', options_for_select(major_version_options, @current_filters[:major_version]), class: 'form-select'

  .row
    .col-md-4
      .mb-4
        %h2 Select What Order You See Them In
    
    .col-md-8
      / Sort Section
      .card.mb-4
        .card-body
          %label.form-label.fw-bold Select What Order You See Them In
          .mb-3
            %label.form-label Sort By
            - sort_options = [['Department and Title', 'department_and_title'], ['Title (A-Z)', 'title'], ['Title (Z-A)', 'title_desc'], ['Company (A-Z)', 'company'], ['Company (Z-A)', 'company_desc'], ['Most Outcomes', 'outcomes'], ['Fewest Outcomes', 'outcomes_desc'], ['Most Abilities', 'abilities'], ['Fewest Abilities', 'abilities_desc']]
            = select_tag 'sort', options_for_select(sort_options, @current_sort), class: 'form-select', id: 'sort_select'
          .mb-3
            %label.form-label Direction
            - direction_options = [['Ascending', 'asc'], ['Descending', 'desc']]
            = select_tag 'direction', options_for_select(direction_options, @current_filters[:direction] || 'asc'), class: 'form-select', id: 'direction_select'

  .row
    .col-md-4
      .mb-4
        %h2 Select the Spotlight for Them
    
    .col-md-8
      / Spotlight Section
      .card.mb-4
        .card-body
          %label.form-label.fw-bold Select the Spotlight for Them
          .form-check
            = radio_button_tag 'spotlight', 'by_department', (@current_spotlight.blank? || @current_spotlight == 'by_department'), class: 'form-check-input', id: 'spotlight_by_department'
            = label_tag 'spotlight_by_department', 'By Department', class: 'form-check-label'

  .row
    .col-12
      / Form Actions
      .d-flex.gap-2.mt-4.mb-4
        = form.submit 'Apply View', class: 'btn btn-primary'
        = link_to 'Cancel', @return_url || organization_assignments_path(@organization), class: 'btn btn-outline-secondary'

