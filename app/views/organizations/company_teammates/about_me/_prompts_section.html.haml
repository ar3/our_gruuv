= render 'shared/section_header', 
         title: 'Prompts / Reflections', 
         icon: 'bi-file-text', 
         description: 'Recent reflection prompts',
         collapsible: true,
         collapse_target: 'promptsSection'

-# Summary view (shown when collapsed)
%div.alert.alert-info.mb-4.collapse-summary{"data-bs-toggle" => "collapse", "data-bs-target" => "#promptsSection", "aria-expanded" => "false", "aria-controls" => "promptsSection", style: "cursor: pointer;"}
  %p.mb-0
    - if @open_prompts_count > 0
      %strong= pluralize(@open_prompts_count, 'open prompt')
      available
    - else
      No open prompts available.

-# Collapsible content
.collapse#promptsSection
  .card.mb-4
    .card-body
      - if @open_prompts_count > 0
        %p.mb-3
          %strong= pluralize(@open_prompts_count, 'open prompt')
          available
      
      - if @recent_prompts.any?
        .list-group.mb-3
          - @recent_prompts.each do |prompt|
            .list-group-item
              .d-flex.justify-content-between.align-items-start
                .flex-grow-1
                  %h6.mb-1
                    = prompt.prompt_template.title
                    - if prompt.open?
                      %span.badge.bg-warning.text-dark.ms-2 Open
                    - else
                      %span.badge.bg-secondary.ms-2 Closed
                  %p.mb-1.text-muted
                    = prompt.created_at.strftime('%B %d, %Y')
                  - if prompt.prompt_answers.any?
                    %small.text-muted
                      = pluralize(prompt.prompt_answers.count, 'answer')
                - if policy(prompt).show?
                  = link_to edit_organization_prompt_path(organization, prompt), 
                            class: "btn btn-sm btn-outline-primary ms-2",
                            target: "_blank" do
                    %i.bi.bi-eye.me-1
                    View
      - else
        %p.text-muted.mb-3 No recent prompts to display.
      
      .d-grid
        = link_to "View All Prompts", 
                  @prompts_url,
                  class: "btn btn-outline-primary"

