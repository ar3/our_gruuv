- assignments_indicator = assignments_check_in_status_indicator(@teammate, organization)
= render 'shared/section_header', 
         title: 'Assignments/Outcomes', 
         icon: 'bi-clipboard-check', 
         description: 'Evaluate project contributions and energy',
         collapsible: true,
         collapse_target: 'assignmentsCheckInSection',
         status_indicator: assignments_indicator

-# Summary view (shown when collapsed)
%div{class: "alert mb-4 collapse-summary #{status_indicator_alert_class(assignments_indicator)}", "data-bs-toggle" => "collapse", "data-bs-target" => "#assignmentsCheckInSection", "aria-expanded" => "false", "aria-controls" => "assignmentsCheckInSection", "data-status-popover" => "true", "data-bs-trigger" => "hover", "data-bs-placement" => "top", "data-bs-html" => "true", "data-bs-content" => status_conditions_popover_content(:assignments_check_in), style: "cursor: pointer;"}
  %p.mb-0
    %i{class: "#{status_indicator_icon(assignments_indicator)} #{status_indicator_badge_class(assignments_indicator)} me-2"}
    - if @required_assignments.any?
      %span.inline-sentence-highlight= @position_display_name_for_assignments
      = " has ".html_safe
      %span.inline-sentence-highlight= pluralize(@required_assignments.count, 'assignment')
      = " (required assignments and active assignments with energy > 0), and #{@teammate.person.casual_name} has had a check-in conversation about ".html_safe
      %span.inline-sentence-highlight= pluralize(@assignments_with_recent_check_ins_count, 'assignment')
      = " of these assignments in the last 90 days.".html_safe
    - else
      No assignments
  - if @viewing_own_about_me && @viewer_ready_assignment_count.to_i.positive?
    %p.mb-0.mt-2
      âœ… You have completed your side of the check-in for #{@viewer_ready_assignment_count} of the #{pluralize(@required_assignments.count, 'assignment')}.

-# Collapsible content
.collapse#assignmentsCheckInSection
  .card.mb-4
    .card-body
      - if @assignment_check_ins_data.any?
        .table-responsive
          %table.table.table-hover
            %thead
              %tr
                %th Assignment
                %th Last Finalized
                %th Employee Status
                %th Manager Status
            %tbody
              - @assignment_check_ins_data.each do |data|
                - assignment = data[:assignment]
                - check_in = data[:check_in]
                - latest_finalized = data[:latest_finalized]
                %tr
                  %td
                    = link_to assignment.title, organization_assignment_path(organization, assignment), class: "text-decoration-none"
                  %td
                    - if latest_finalized
                      = format_date_in_user_timezone(latest_finalized.official_check_in_completed_at)
                    - else
                      %span.text-muted Check-in not started
                  %td
                    - if check_in
                      - if check_in.employee_completed?
                        %span.badge.bg-success Ready
                        %br
                        %small.text-muted= format_date_in_user_timezone(check_in.employee_completed_at, format: '%b %d, %Y')
                      - else
                        %span.badge.bg-warning Not ready
                    - else
                      %span.text-muted Check-in not started
                  %td
                    - if check_in
                      - if check_in.manager_completed?
                        %span.badge.bg-success Ready
                        %br
                        %small.text-muted= format_date_in_user_timezone(check_in.manager_completed_at, format: '%b %d, %Y')
                      - else
                        %span.badge.bg-warning Not ready
                    - else
                      %span.text-muted Check-in not started
      - else
        %p.text-muted.mb-3 No assignments found.
      
      .d-grid.mt-3
        = link_to "Go to Check-In Mode", 
                  organization_company_teammate_check_ins_path(organization, @teammate),
                  class: "btn btn-outline-primary"

