= render 'shared/section_header', 
         title: "Stories about #{@person.casual_name}", 
         icon: 'bi-book', 
         description: 'Recent observations and feedback',
         collapsible: true,
         collapse_target: 'storiesSection'

-# Summary view (shown when collapsed)
.card.mb-4.collapse-summary
  .card-body
    %p.mb-0
      %strong= pluralize(@stories_count, 'observation')
      in the last 45 days

-# Collapsible content
.collapse#storiesSection
  .card.mb-4
    .card-body
      %p.mb-3
        %strong= pluralize(@stories_count, 'observation')
        in the last 45 days
      
      - if @recent_stories.any?
        .list-group.mb-3
          - @recent_stories.each do |observation|
            .list-group-item
              .d-flex.justify-content-between.align-items-start
                .flex-grow-1
                  %h6.mb-1
                    = observation.observer.display_name
                    %small.text-muted
                      = format_date_in_user_timezone(observation.observed_at)
                  %p.mb-1.text-muted
                    = truncate(observation.story, length: 100)
                  %small
                    %span.badge.bg-secondary= observation.privacy_level.humanize
                - if policy(observation).show?
                  = link_to organization_observation_path(@organization, observation), 
                            class: "btn btn-sm btn-outline-primary ms-2",
                            target: "_blank" do
                    %i.bi.bi-eye.me-1
                    View
      - else
        %p.text-muted.mb-3 No recent observations to display.
      
      .d-grid
        = button_to "View All Observations", 
                    save_and_redirect_organization_company_teammate_check_ins_path(organization, @teammate), 
                    method: :post,
                    params: { redirect_url: @stories_filter_url },
                    class: "btn btn-outline-primary"

