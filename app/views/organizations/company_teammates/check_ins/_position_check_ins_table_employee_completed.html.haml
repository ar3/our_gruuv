-# Position Check-In Table View - Employee Completed State
.table-responsive
  %table.table.table-striped
    %thead
      %tr
        %th Position
        %th Employee Rating
        %th Employee Notes
        %th Manager Status
        %th Actions
    %tbody
      %tr
        %td
          - return_text = "Return to #{check_in.teammate.person.casual_name}'s check-in"
          - return_url = organization_company_teammate_check_ins_path(organization, @teammate)
          = hidden_field_tag "return_text", return_text
          = hidden_field_tag "return_url", return_url
          = form.submit check_in.employment_tenure.position.display_name,
                        class: "btn btn-link text-decoration-none p-0 border-0 bg-transparent text-start",
                        name: "save_and_view_position",
                        "data-bs-toggle" => "popover",
                        "data-bs-trigger" => "hover",
                        "data-bs-placement" => "right",
                        "data-bs-html" => "true",
                        "data-bs-content" => latest_position_check_in_popover_content(check_in.teammate)
          %i.bi.bi-clock-history.ms-1.text-muted
        %td
          = position_rating_display(check_in.employee_rating)
        %td
          = simple_format(check_in.employee_private_notes)
        %td
          - if check_in.manager_completed?
            .badge.bg-success Ready for Finalization
            %br
            %small.text-muted #{check_in.manager_completed_by_teammate&.person&.first_name || 'Your manager'} has completed their assessment
          - else
            .badge.bg-warning Waiting for Manager
            %br
            %small.text-muted Your manager has not completed their assessment
        %td
          - if check_in.manager_completed?
            = link_to "Go to Finalization", organization_company_teammate_finalization_path(organization, @teammate), 
                      class: 'btn btn-success btn-sm',
                      data: { confirm: 'Your manager will review both assessments and set the official rating.' }

.form-group.mt-3
  %label Status
  = form.fields_for :position_check_in, check_in do |pf|
    -# Hidden fields to preserve existing values when form is submitted
    = pf.hidden_field :employee_rating, value: check_in.employee_rating
    = pf.hidden_field :employee_private_notes, value: check_in.employee_private_notes
    
    .btn-group-vertical{role: "group", "aria-label": "Status selection"}
      = pf.radio_button :status, 'draft', checked: !check_in.employee_completed?, class: 'btn-check', id: "position_employee_completed_status_draft_#{check_in.id}"
      = pf.label :status_draft, 'Make Changes', class: 'btn btn-outline-secondary', for: "position_employee_completed_status_draft_#{check_in.id}"
      = pf.radio_button :status, 'complete', checked: check_in.employee_completed?, class: 'btn-check', id: "position_employee_completed_status_complete_#{check_in.id}"
      = pf.label :status_complete, 'Ready for Manager', class: 'btn btn-outline-primary', for: "position_employee_completed_status_complete_#{check_in.id}"
  
  .small.text-muted.mt-1
    Select "Make Changes" to edit your assessment and notes
