- content_for :header do
  %h1.mb-0
    %i.bi.bi-gift.me-2
    Public Kudos

- content_for :go_back_link do
  = link_to organization_kudos_path(@organization), class: "text-muted text-decoration-none" do
    %i.bi.bi-arrow-left.me-2
    Back to #{@organization.name} Public Kudos

- content_for :header_action do
  - if current_person
    = link_to organization_observation_path(@organization, @observation), class: "btn btn-outline-primary btn-sm" do
      %i.bi.bi-eye.me-2
      Employee-only view
  - else
    .d-flex.align-items-center.gap-2
      %button.btn.btn-outline-secondary.btn-sm.disabled{disabled: true, "data-bs-toggle" => "tooltip", "data-bs-title" => "Requires login to view employee-only features"}
        %i.bi.bi-eye.me-2
        Employee-only view
      %i.bi.bi-exclamation-triangle.text-warning

/ Main content
.mb-4
  / Story section with left border
  .markdown-content--bordered.mb-4
    %p.mb-0{style: "font-size: 1.1rem; line-height: 1.6;"}
      = @observation.decorate.story_html.html_safe

  / Attribution section (right-aligned like a quote author)
  .text-end.mb-4
    %p.mb-1.text-muted
      - observer_link = link_to @observation.observer.casual_name, public_person_path(@observation.observer), class: "text-decoration-none"
      = "Observed by #{observer_link}".html_safe
      - if @observation.observed_teammates.any?
        |  â€¢ Recognizing: 
        - @observation.observed_teammates.map do |teammate|
          - person = teammate.person
          = link_to person.casual_name, public_person_path(person), class: "text-decoration-none"
    %p.mb-0.text-muted.small
      - full_datetime = @observation.observed_at.strftime('%B %d, %Y at %l:%M %p')
      - date_only = @observation.observed_at.strftime('%B %d, %Y')
      %span{title: full_datetime, "data-bs-toggle" => "tooltip", "data-bs-placement" => "top"}
        = date_only

  / Feelings and ratings card
  - has_feelings = @observation.primary_feeling.present? && @observation.feelings_display.present?
  - rating_sentences = @observation.format_ratings_by_type_and_level(format: :html)
  - has_ratings = rating_sentences.any?
  - if has_feelings || has_ratings
    .card.mb-4
      .card-body
        / Feelings sentence (if present)
        - if has_feelings
          %p.mb-3
            - observed_links = @observation.observed_teammates.map do |teammate|
              - person = teammate.person
              - link_to person.casual_name, public_person_path(person), class: "text-decoration-none"
            - story_part = if @observation.observed_teammates.any?
              - "This story about #{observed_links.join(', ')}"
            - else
              - "This story"
            - observer_link = link_to @observation.observer.casual_name, public_person_path(@observation.observer), class: "text-decoration-none"
            = "#{story_part} made #{observer_link} feel #{@observation.feelings_display}".html_safe

        / Ratings sentences
        - if has_ratings
          - rating_sentences.each do |sentence|
            %p.mb-3
              != sentence.html_safe