- if @hierarchy_tree.empty? && (@unassigned_seats.is_a?(Array) ? @unassigned_seats.empty? : @unassigned_seats.empty?)
  .alert.alert-info
    %h6.mb-2
      %i.bi.bi-info-circle.me-2
      No Seats Found
    %p.mb-2
      - if @has_active_filters
        No seats match your current filters. Try adjusting your filter settings.
      - else
        This organization doesn't have any seats yet.
- else
  - if @hierarchy_tree.any?
    .tree-visualization{style: "padding: 20px;"}
      - @hierarchy_tree.each do |root_node|
        = render 'organizations/seats/displays/seat_node', node: root_node, depth: 0, organization: organization
  
  - unassigned_array = @unassigned_seats.is_a?(Array) ? @unassigned_seats : @unassigned_seats.to_a
  - if unassigned_array.any?
    %hr.mt-5.mb-4
    .mt-4
      %h4.mb-3
        %i.bi.bi-briefcase.me-2
        Seats Without Parent
      .row
        - unassigned_array.each do |seat|
          .col-md-6.col-lg-4.mb-3
            .card
              .card-body.p-2
                .d-flex.align-items-start
                  .flex-grow-1
                    - if policy(seat).show?
                      = link_to seat.display_name, organization_seat_path(organization, seat), class: "text-decoration-none fw-bold"
                    - else
                      %span.fw-bold= seat.display_name
                    %br
                    %span.text-muted.small= seat.title.external_title
                    %br
                    %span.badge{class: seat_state_badge_class(seat.state)}
                      = seat.state.titleize

:javascript
  // Handle collapse/expand icon toggle
  document.addEventListener('DOMContentLoaded', function() {
    const toggleButtons = document.querySelectorAll('.toggle-children');
    
    toggleButtons.forEach(function(button) {
      const targetId = button.getAttribute('data-bs-target');
      const target = document.querySelector(targetId);
      const icon = button.querySelector('.toggle-icon');
      
      if (target) {
        // Set initial icon state based on whether it's expanded
        if (target.classList.contains('show')) {
          icon.classList.remove('bi-chevron-up');
          icon.classList.add('bi-chevron-down');
        } else {
          icon.classList.remove('bi-chevron-down');
          icon.classList.add('bi-chevron-up');
        }
        
        // Listen for Bootstrap collapse events
        target.addEventListener('show.bs.collapse', function() {
          icon.classList.remove('bi-chevron-up');
          icon.classList.add('bi-chevron-down');
        });
        
        target.addEventListener('hide.bs.collapse', function() {
          icon.classList.remove('bi-chevron-down');
          icon.classList.add('bi-chevron-up');
        });
      }
    });
  });

