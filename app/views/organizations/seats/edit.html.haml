- content_for :title, "Edit Seat"

- content_for :header do
  %h1.mb-0 Edit Seat

- content_for :go_back_link do
  = link_to organization_seat_path(@organization, @seat), class: "text-muted text-decoration-none" do
    %i.bi.bi-arrow-left.me-2
    Back to Seat

.row.justify-content-center
  .col-lg-10
    .card
      .card-header
        %h5.mb-0
          %i.bi.bi-pencil.me-2
          Edit Seat Details
      .card-body
        = form_with model: [@organization, @seat], url: organization_seat_path(@organization, @seat), local: true do |f|
          - if @seat.errors.any?
            .alert.alert-danger.mb-3
              %h5= "#{pluralize(@seat.errors.count, "error")} prohibited this seat from being saved:"
              %ul.mb-0
                - @seat.errors.full_messages.each do |message|
                  %li= message
          .row
            .col-md-6
              .mb-3
                = f.label :title_id, "Title", class: "form-label"
                = f.collection_select :title_id, @organization.titles, :id, :external_title, { prompt: "Select a title" }, { class: "form-select", required: true }
                - if @seat.errors[:title_id].any?
                  .invalid-feedback.d-block= @seat.errors[:title_id].join(", ")

              .mb-3
                = f.label :seat_needed_by, "Needed By Date", class: "form-label"
                = f.date_field :seat_needed_by, class: "form-control", required: true
                - if @seat.errors[:seat_needed_by].any?
                  .invalid-feedback.d-block= @seat.errors[:seat_needed_by].join(", ")

              .mb-3
                = f.label :job_classification, "Job Classification", class: "form-label"
                = f.select :job_classification, ["Salaried Exempt", "Salaried Non-Exempt", "Hourly", "Contractor", "Intern"], {}, { class: "form-select" }

            .col-md-6
              = render 'shared/department_dropdown',
                form: f,
                organization: @organization,
                field_name: :department_id,
                label_text: "Department (Optional)",
                selected_department_id: @seat.department_id,
                include_blank: true,
                help_text: "Select the department for this seat"

              = render 'shared/team_dropdown',
                form: f,
                organization: @organization,
                field_name: :team_id,
                label_text: "Team (Optional)",
                selected_team_id: @seat.team_id,
                include_blank: true,
                help_text: "Select the team for this seat"

              .mb-3
                = f.label :reports_to_seat_id, "Reports To Seat (Optional)", class: "form-label"
                - grouped_options = []
                - filled_seats = @filled_seats || []
                - unfilled_seats = @unfilled_seats || []
                - if filled_seats.any?
                  - filled_options = filled_seats.map do |item|
                    - person = item[:person]
                    - display_name = "#{person.last_name}, #{person.first_name} - #{item[:seat].display_name}"
                    - [display_name, item[:seat].id]
                  - grouped_options << ["Filled Seats", filled_options]
                - if unfilled_seats.any?
                  - unfilled_options = unfilled_seats.map { |seat| [seat.display_name, seat.id] }
                  - grouped_options << ["Unfilled Seats", unfilled_options]
                = f.select :reports_to_seat_id,
                  grouped_options_for_select(grouped_options, @seat.reports_to_seat_id),
                  { prompt: 'Select a seat (optional)', include_blank: 'No Seat' },
                  { class: "form-select" }
                %small.form-text.text-muted Select the seat that this seat reports to

              .mb-3
                = f.label :reports, "Direct Reports", class: "form-label"
                = f.text_area :reports, class: "form-control", rows: 3, placeholder: "Describe who this position will manage"

          .row
            .col-12
              .mb-3
                = f.label :measurable_outcomes, "Measurable Outcomes", class: "form-label"
                = f.text_area :measurable_outcomes, class: "form-control", rows: 4, placeholder: "List specific, measurable outcomes for this role"

          .row
            .col-12
              %h5.mt-4.mb-3
                %i.bi.bi-shield-check.me-2
                Seat Defense
              %p.text-muted.mb-3
                %em These fields help justify the need for this seat and should be completed before opening the position.

              .mb-3
                = f.label :why_needed, "Why do we need this role?", class: "form-label"
                = f.text_area :why_needed, class: "form-control", rows: 3, placeholder: "Explain the business need for this position"

              .mb-3
                = f.label :why_now, "Why is now the time to hire for this role?", class: "form-label"
                = f.text_area :why_now, class: "form-control", rows: 3, placeholder: "What has changed that makes this hire urgent now?"

              .mb-3
                = f.label :costs_risks, "What are the costs/risks if we choose not to hire for this role now?", class: "form-label"
                = f.text_area :costs_risks, class: "form-control", rows: 3, placeholder: "Describe the impact of delaying this hire"

          .row
            .col-12
              %h5.mt-4.mb-3
                %i.bi.bi-file-text.me-2
                HR Information
              %p.text-muted.mb-3
                %em These fields will appear in the job description. You can customize them or use the defaults.

              .mb-3
                = f.label :seat_disclaimer, "Job Description Disclaimer", class: "form-label"
                = f.text_area :seat_disclaimer, class: "form-control", rows: 2, placeholder: "Default disclaimer will be used if left blank"

              .mb-3
                = f.label :work_environment, "Work Environment", class: "form-label"
                = f.text_area :work_environment, class: "form-control", rows: 2, placeholder: "Default work environment will be used if left blank"

              .mb-3
                = f.label :physical_requirements, "Physical Requirements", class: "form-label"
                = f.text_area :physical_requirements, class: "form-control", rows: 3, placeholder: "Default physical requirements will be used if left blank"

              .mb-3
                = f.label :travel, "Travel Requirements", class: "form-label"
                = f.text_area :travel, class: "form-control", rows: 2, placeholder: "Default travel policy will be used if left blank"

          .row
            .col-12
              .d-flex.justify-content-end.gap-2.mt-4
                = link_to organization_seat_path(@organization, @seat), class: "btn btn-outline-secondary" do
                  %i.bi.bi-x.me-2
                  Cancel
                = f.submit "Update Seat", class: "btn btn-primary" do
                  %i.bi.bi-check.me-2
                  Update Seat
