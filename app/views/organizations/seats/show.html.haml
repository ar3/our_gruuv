- content_for :header do
  .d-flex.justify-content-between.align-items-center
    %h1.mb-0= @seat.display_name
    .d-flex.align-items-center.gap-2
      - if policy(@seat).update?
        = link_to edit_organization_seat_path(organization, @seat), class: "btn btn-outline-primary" do
          %i.bi.bi-pencil.me-2
          Edit
      - else
        .d-flex.align-items-center.gap-2
          = link_to edit_organization_seat_path(organization, @seat), class: "btn btn-outline-secondary", disabled: true do
            %i.bi.bi-pencil.me-2
            Edit
          %i.bi.bi-exclamation-triangle.text-warning{ data: { bs_toggle: "tooltip", bs_title: "Requires MAAP management permission" } }
      - if policy(@seat).destroy?
        = link_to organization_seat_path(organization, @seat), method: :delete, data: { confirm: "Are you sure you want to delete this seat?" }, class: "btn btn-outline-danger" do
          %i.bi.bi-trash.me-2
          Delete
      - else
        .d-flex.align-items-center.gap-2
          = link_to organization_seat_path(organization, @seat), method: :delete, data: { confirm: "Are you sure you want to delete this seat?" }, class: "btn btn-outline-secondary", disabled: true do
            %i.bi.bi-trash.me-2
            Delete
          %i.bi.bi-exclamation-triangle.text-warning{ data: { bs_toggle: "tooltip", bs_title: "Requires MAAP management permission" } }

- content_for :go_back_link do
  = link_to organization_seats_path(organization), class: "text-muted text-decoration-none" do
    %i.bi.bi-arrow-left.me-2
    Back to Seats

.row.justify-content-center
  .col-lg-10
    / Seat Defense (if any) - Moved to first
    .card.mb-4
      .card-body

        %p
          %strong Reports to:
          = @seat.reports_to.presence || '--Not answered yet--'

        
        %p
          %strong Team:
          = @seat.team.presence || '--Not answered yet--'

        
        %p
          %strong Reports:
          = @seat.reports.presence || '--Not answered yet--'

        %p
          %strong Job Classification:
          = @seat.job_classification


        %h4.mb-3
          %strong Seat Defense

        %p
          %strong State:
          %span.badge{class: seat_state_badge_class(@seat.state)}= @seat.state.humanize

        %p
          %strong Needed By:
          = @seat.seat_needed_by.strftime("%B %d, %Y")

        .mb-3
          %h6
            %strong Why do we need this role?
          %p= @seat.why_needed.presence || '--Not answered yet--'
        
        .mb-3
          %h6
            %strong Why is now the time to hire for this role?
          %p= @seat.why_now.presence || '--Not answered yet--'
        
        .mb-3
          %h6
            %strong What are the costs/risks if we choose not to hire for this role now?
          %p= @seat.costs_risks.presence || '--Not answered yet--'


        / State Reconciliation Warning
        - if @seat.needs_reconciliation?
          .card.mb-4.border-warning
            .card-header.bg-warning.text-dark
              %h5.mb-0
                %i.bi.bi-exclamation-triangle.me-2
                State Reconciliation Needed
            .card-body
              %p.mb-3
                This seat's state appears to be inconsistent with its current employment tenures. 
                Click the button below to automatically reconcile the state.
              - if policy(@seat).reconcile?
                = link_to reconcile_organization_seat_path(organization, @seat), method: :patch, class: "btn btn-warning" do
                  %i.bi.bi-arrow-clockwise.me-2
                  Reconcile State
              - else
                .d-flex.align-items-center.gap-2
                  = link_to reconcile_organization_seat_path(organization, @seat), method: :patch, class: "btn btn-outline-secondary", disabled: true do
                    %i.bi.bi-arrow-clockwise.me-2
                    Reconcile State
                  %i.bi.bi-exclamation-triangle.text-warning{ data: { bs_toggle: "tooltip", bs_title: "Requires MAAP management permission" } }

.row.justify-content-center
  .col-lg-10
    %hr.mb-4.mt-4/

.row.justify-content-center
  .col-12

    %h2.mb-3
      %strong= @seat.position_type.external_title
      ='- Job Description'

    %h4.mb-3
      %strong Summary:
    %p= @seat.summary.present? ? @seat.summary : "No summary provided"

    -# Required Assignments
    - if @seat.required_assignments.any?
      %h3.mb-3
        %strong Required Assignments:
      
      - @seat.required_assignments.each_with_index do |pa, index|
        - if index > 0
          %hr.my-4
        
        = render 'positions/assignment_job_description', pa: pa, assignment_type: 'required', organization: organization

    -# Suggested Assignments
    - if @seat.suggested_assignments.any?
      %hr.mb-4.mt-4/

      %h3.mb-1.mt-4
        %strong Optional / Elective / Uniquely-You Assignments
        %a.text-decoration-none{"data-bs-toggle" => "collapse", "data-bs-target" => "#suggestedAssignments", "aria-expanded" => "true", "aria-controls" => "suggestedAssignments"}
          %span#suggestedExpandIcon.not-collapsed
            %i.bi.bi-chevron-up
            %small.text-muted (Hide suggested Assignments)
          %span#suggestedCollapseText.collapsed
            %i.bi.bi-chevron-down
            %small.text-muted="(Show the #{pluralize(@seat.suggested_assignments.count, 'assignment')})"
      
      .collapse.show#suggestedAssignments
        %p.text-muted.mb-3
          %em We are all about growthâ€¦ as such, we do our best to make it possible to successfully complete required Assignments and have room for special/elective/unique-to-you Assignments. These should only be taken on if the required Assignments are being completed and we are meeting expectations across them.
      
        - @seat.suggested_assignments.each_with_index do |pa, index|
          - if index > 0
            %hr.my-4
          
          = render 'positions/assignment_job_description', pa: pa, assignment_type: 'suggested', organization: organization

    - if @seat.required_assignments.empty? && @seat.suggested_assignments.empty?
      .alert.alert-warning
        %h6.mb-2
          %i.bi.bi-exclamation-triangle.me-2
          No Assignments Defined
        %p.mb-2 This seat has no required or suggested assignments.
        = link_to "Add Assignments", edit_organization_seat_path(organization, @seat), class: "btn btn-warning btn-sm"

.row.justify-content-center
  .col-12
    %hr.mb-4.mt-4/

    .mt-5
      %p.text-muted
        %em This job description is not designed to cover or contain a comprehensive list of duties or responsibilities. Duties may change or new ones may be assigned at any time.
      
      - if @seat.work_environment.present?
        %p.text-muted
          %strong Work environment:
          = @seat.work_environment
      - else
        %p.text-muted
          %strong Work environment:
          Prolonged periods of sitting at a desk and working on a computer.
      
      - if @seat.physical_requirements.present?
        %p.text-muted
          %strong Physical requirements:
          = @seat.physical_requirements
      - else
        %p.text-muted
          %strong Physical requirements:
          While performing the duties of this job, the employee may be regularly required to stand, sit, talk, hear, and use hands and fingers to operate a computer and keyboard. Specific vision abilities required by this job include close vision requirements due to computer work.
      
      - if @seat.travel.present?
        %p.text-muted
          %strong Travel:
          = @seat.travel
      - else
        %p.text-muted
          %strong Travel:
          Travel is on a voluntary basis.
      
      %hr.my-4
      
      %p.text-muted
        %em Employee signature below indicates the employee's understanding of the requirements, essential functions and duties of the position.
      
      .row.mt-4
        .col-md-6
          %p.text-muted
            %strong Employee Signature:
            %br
            %small _____________________________
        .col-md-6
          %p.text-muted
            %strong Date:
            %br
            %small _____________________________


