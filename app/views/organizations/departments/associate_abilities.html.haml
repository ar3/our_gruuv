- content_for :title, "Associate Abilities with #{@department.name}"

- content_for :go_back_link do
  = link_to organization_department_path(@organization, @department), class: "go-back-link" do
    %i.bi.bi-arrow-left.me-2
    Back to #{@department.name}

- content_for :header do
  %h1.mb-0
    %i.bi.bi-award.me-2
    Associate Abilities

.row.justify-content-center
  .col-lg-10
    .card
      .card-header
        %h5.mb-0
          Select abilities to associate with 
          %strong= @department.name
      .card-body
        - if @unassociated_abilities.any?
          = form_with url: update_abilities_association_organization_department_path(@organization, @department), method: :patch, local: true do |form|
            .mb-3
              .form-check.mb-2
                %input.form-check-input#select-all{type: "checkbox", "data-action": "click->bulk-select#toggleAll"}
                %label.form-check-label.fw-bold{for: "select-all"}
                  Select All
              %hr
              
            .table-responsive
              %table.table.table-hover
                %thead
                  %tr
                    %th{style: "width: 40px;"}
                    %th Name
                    %th Description
                    %th Version
                %tbody
                  - @unassociated_abilities.each do |ability|
                    %tr
                      %td
                        .form-check
                          = check_box_tag "ability_ids[]", ability.id, false, class: "form-check-input bulk-select-item", id: "ability_#{ability.id}"
                      %td
                        %label.form-check-label{for: "ability_#{ability.id}"}
                          = ability.name
                      %td
                        = truncate(ability.description, length: 80)
                      %td
                        %span.badge.bg-secondary
                          v#{ability.semantic_version}
            
            .d-flex.justify-content-between.mt-4
              = link_to "Cancel", organization_department_path(@organization, @department), class: "btn btn-outline-secondary"
              = form.submit "Associate Selected Abilities", class: "btn btn-primary"
        - else
          .alert.alert-info
            %i.bi.bi-info-circle.me-2
            All abilities are already associated with a department.
          = link_to "Back to Department", organization_department_path(@organization, @department), class: "btn btn-outline-secondary"

:javascript
  document.addEventListener('DOMContentLoaded', function() {
    const selectAll = document.getElementById('select-all');
    const checkboxes = document.querySelectorAll('.bulk-select-item');
    
    if (selectAll) {
      selectAll.addEventListener('change', function() {
        checkboxes.forEach(function(checkbox) {
          checkbox.checked = selectAll.checked;
        });
      });
    }
  });
