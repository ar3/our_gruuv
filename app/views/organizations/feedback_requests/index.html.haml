- content_for :title, "Feedback Requests"

- content_for :header do
  .d-flex.align-items-center
    %h1.mb-0.me-2
      %i.bi.bi-chat-dots.me-2
      Feedback Requests
    .d-flex.align-items-center
      - if policy(FeedbackRequest.new(company: organization.root_company || organization)).create?
        = link_to new_organization_feedback_request_path(organization), class: "btn btn-primary ml-2" do
          %i.bi.bi-plus
          New Request

- content_for :go_back_link do
  = link_to dashboard_organization_path(organization), class: "go-back-link" do
    %i.bi.bi-arrow-left.me-2
    Back to Dashboard

= render partial: 'organizations/feedback_requests/tabs'

/ I'm the Respondent — requests where I'm the respondent
.row.justify-content-center.mb-4
  .col-lg-12
    .card.border-0.shadow-sm
      .card-header.bg-transparent.border-0.d-flex.justify-content-between.align-items-center
        %h5.mb-0
          %i.bi.bi-inbox.me-2
          Requests of me
        .btn-group.btn-group-sm
          = link_to "View open requests of me", organization_feedback_requests_path(organization, requests_of_me: 'open'), class: "btn #{@requests_of_me_filter == 'open' ? 'btn-primary' : 'btn-outline-primary'}"
          = link_to "View all requests of me", organization_feedback_requests_path(organization, requests_of_me: 'all'), class: "btn #{@requests_of_me_filter == 'all' ? 'btn-primary' : 'btn-outline-primary'}"
      .card-body
        - if @requests_of_me.any?
          %ul.list-group.list-group-flush
            - @requests_of_me.each do |request|
              - responder_record = request.feedback_request_responders.find { |frr| frr.teammate_id == current_company_teammate&.id }
              - completed = request.archived? || responder_record&.completed_at.present?
              %li.list-group-item.d-flex.justify-content-between.align-items-center.px-0
                .d-flex.flex-column
                  %span
                    Feedback on
                    %strong= request.subject_of_feedback_teammate.person.display_name
                  %small.text-muted
                    From #{request.requestor_teammate.person.display_name} · #{format_time_in_user_timezone(request.created_at)}
                - if completed
                  - if request.archived?
                    %span.badge.bg-secondary Archived
                  - else
                    %span.badge.bg-success Complete
                - else
                  = link_to "Respond", answer_organization_feedback_request_path(organization, request), class: "btn btn-sm btn-outline-primary"
        - else
          %p.text-muted.mb-0
            - if @requests_of_me_filter == 'open'
              You have no open feedback requests.
            - else
              No one has requested your feedback yet.
