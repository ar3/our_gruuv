- content_for :title, "Customize View"

- content_for :header do
  Customize Feedback Requests View
- content_for :return_url do
  = @return_url || organization_feedback_requests_path(@organization)
- content_for :return_text do
  = @return_text || "Back to Feedback Requests"

= form_with url: update_view_organization_feedback_requests_path(@organization), method: :patch, local: true do |form|
  - if @return_to.present?
    = hidden_field_tag :return_to, @return_to
  .row
    .col-md-4
      .mb-4
        %h2 Select What Feedback Requests You See
    
    .col-md-8
      / Filters Section
      .card.mb-4
        .card-body
          %label.form-label.fw-bold Select What Feedback Requests You See
          
          .mb-3
            %label.form-label Show Archived
            .form-check
              = check_box_tag 'show_archived', '1', @current_filters[:show_archived] == '1', class: 'form-check-input', id: 'show_archived'
              = label_tag 'show_archived', 'Include archived requests', class: 'form-check-label'
          
          .mb-3
            %label.form-label Subject (who the feedback is about)
            = select_tag 'subject', options_from_collection_for_select(@available_subjects, :id, ->(t) { t.person.display_name }, @current_filters[:subject]), { include_blank: 'All Subjects', class: 'form-select' }
          
          .mb-3
            %label.form-label Requestor (who created the request)
            = select_tag 'requestor', options_from_collection_for_select(@available_requestors, :id, ->(t) { t.person.display_name }, @current_filters[:requestor]), { include_blank: 'All Requestors', class: 'form-select' }
          
          .mb-3
            %label.form-label Resource Type
            = select_tag 'rateable_type', options_for_select([['All Types', ''], ['Assignment', 'Assignment'], ['Ability', 'Ability'], ['Aspiration', 'Aspiration']], @current_filters[:rateable_type]), { class: 'form-select', id: 'rateable_type_select' }
          
          .mb-3#rateable_id_field{style: "#{'display: none;' unless @current_filters[:rateable_type].present?}"}
            %label.form-label Resource
            - if @current_filters[:rateable_type] == 'Assignment'
              = select_tag 'rateable_id', options_from_collection_for_select(@available_assignments, :id, :title, @current_filters[:rateable_id]), { include_blank: 'All Assignments', class: 'form-select' }
            - elsif @current_filters[:rateable_type] == 'Ability'
              = select_tag 'rateable_id', options_from_collection_for_select(@available_abilities, :id, :name, @current_filters[:rateable_id]), { include_blank: 'All Abilities', class: 'form-select' }
            - elsif @current_filters[:rateable_type] == 'Aspiration'
              = select_tag 'rateable_id', options_from_collection_for_select(@available_aspirations, :id, :name, @current_filters[:rateable_id]), { include_blank: 'All Aspirations', class: 'form-select' }

  .row
    .col-md-4
      .mb-4
        %h2 Select What Order You See Them In
    
    .col-md-8
      / Sort Section
      .card.mb-4
        .card-body
          %label.form-label.fw-bold Select What Order You See Them In
          .mb-3
            %label.form-label Sort By
            - sort_options = [
                ['Created Date (Newest First)', 'created_at_desc'],
                ['Created Date (Oldest First)', 'created_at_asc'],
                ['Updated Date (Newest First)', 'updated_at_desc'],
                ['Updated Date (Oldest First)', 'updated_at_asc'],
                ['Subject Name (A-Z)', 'subject_name'],
                ['Subject Name (Z-A)', 'subject_name_desc']
              ]
            = select_tag 'sort', options_for_select(sort_options, @current_sort), class: 'form-select', id: 'sort_select'

  .row
    .col-md-4
      .mb-4
        %h2 Select How They Appear
    
    .col-md-8
      / View Style Section
      .card.mb-4
        .card-body
          %label.form-label.fw-bold Select How They Appear
          .form-check
            = radio_button_tag 'view', 'table', @current_view == 'table', class: 'form-check-input', id: 'view_table'
            = label_tag 'view_table', class: 'form-check-label' do
              %i.bi.bi-table.me-2
              Table View

  .row
    .col-md-4
      .mb-4
        %h2 Select Spotlight
    
    .col-md-8
      / Spotlight Section
      .card.mb-4
        .card-body
          %label.form-label.fw-bold Select Spotlight
          .form-check
            = radio_button_tag 'spotlight', 'overview', @current_spotlight == 'overview', class: 'form-check-input', id: 'spotlight_overview'
            = label_tag 'spotlight_overview', class: 'form-check-label' do
              Overview
          .form-check
            = radio_button_tag 'spotlight', 'open_requests', @current_spotlight == 'open_requests', class: 'form-check-input', id: 'spotlight_open_requests'
            = label_tag 'spotlight_open_requests', class: 'form-check-label' do
              Open Feedback Requests
          .form-check
            = radio_button_tag 'spotlight', 'open_responders', @current_spotlight == 'open_responders', class: 'form-check-input', id: 'spotlight_open_responders'
            = label_tag 'spotlight_open_responders', class: 'form-check-label' do
              Open Feedback Request Responders
          .form-check
            = radio_button_tag 'spotlight', 'responder_count', @current_spotlight == 'responder_count', class: 'form-check-input', id: 'spotlight_responder_count'
            = label_tag 'spotlight_responder_count', class: 'form-check-label' do
              Responder Count

  .row
    .col-12
      / Form Actions
      .d-flex.gap-2.mt-4.mb-4
        = form.submit 'Apply View', class: 'btn btn-primary'
        = link_to 'Cancel', @return_url || organization_feedback_requests_path(@organization), class: 'btn btn-outline-secondary'

:javascript
  document.addEventListener('DOMContentLoaded', function() {
    // Show/hide rateable_id field based on rateable_type selection
    const rateableTypeSelect = document.getElementById('rateable_type_select');
    const rateableIdField = document.getElementById('rateable_id_field');
    
    if (rateableTypeSelect) {
      rateableTypeSelect.addEventListener('change', function() {
        if (this.value) {
          rateableIdField.style.display = 'block';
          // Reload page to get correct options for the selected type
          const form = this.closest('form');
          const formData = new FormData(form);
          formData.set('rateable_type', this.value);
          formData.set('rateable_id', '');
          // Submit form to reload with correct options
          form.submit();
        } else {
          rateableIdField.style.display = 'none';
        }
      });
    }
  });
