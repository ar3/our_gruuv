= form_with model: @reward, url: (@reward.persisted? ? organization_kudos_rewards_reward_path(@organization, @reward) : organization_kudos_rewards_rewards_path(@organization)), local: true, class: "needs-validation", multipart: true do |f|
  .card
    .card-body
      .mb-3
        = f.label :name, class: "form-label"
        = f.text_field :name, class: "form-control", required: true, placeholder: "e.g., $25 Amazon Gift Card"

      .mb-3
        = f.label :description, class: "form-label"
        = f.text_area :description, class: "form-control", rows: 3, placeholder: "Describe the reward..."

      .row.mb-3
        .col-md-6
          = f.label :cost_in_points, "Cost (in points)", class: "form-label"
          .input-group
            = f.number_field :cost_in_points, class: "form-control", required: true, min: 0.5, step: 0.5, placeholder: "100"
            %span.input-group-text points
          %small.text-muted
            = number_to_currency((@reward.cost_in_points || 0) / 10.0)
            dollar value

        .col-md-6
          = f.label :reward_type, class: "form-label"
          = f.select :reward_type, KudosReward::REWARD_TYPES.map { |t| [t.titleize, t] }, {}, class: "form-select"

      .mb-3
        = f.label :image, "Upload Image", class: "form-label"
        = f.file_field :image, class: "form-control", accept: "image/*"
        .form-text Upload an image file (any image type accepted). This will upload to S3 and replace any existing image URL.
        - if @reward.persisted? && @reward.image_url.present?
          .mt-2
            %small.text-muted Current image:
            = link_to @reward.image_url, @reward.image_url, target: "_blank", class: "ms-2"
            = image_tag @reward.image_url, alt: "Current reward image", class: "img-thumbnail ms-2", style: "max-height: 100px;", onerror: "this.style.display='none'"
      .mb-3
        = f.label :image_url, "Or Image URL", class: "form-label"
        = f.url_field :image_url, class: "form-control", placeholder: "https://example.com/image.png"
        .form-text Optional: Alternatively, provide a direct URL to an image. Leave blank if uploading a file above.

      .mb-3
        .form-check
          = f.check_box :active, class: "form-check-input"
          = f.label :active, "Active (available for redemption)", class: "form-check-label"

    .card-footer
      = f.submit (@reward.persisted? ? "Update Reward" : "Create Reward"), class: "btn btn-primary"
      = link_to "Cancel", organization_kudos_rewards_rewards_path(@organization), class: "btn btn-outline-secondary ms-2"
