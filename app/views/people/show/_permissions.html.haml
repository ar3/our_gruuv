.card.mb-4{ role: "region", "aria-labelledby": "permissions-section" }
  .card-header
    %h5.mb-0{ id: "permissions-section" }
      %i.bi.bi-key.me-2
      Organization Permissions for #{current_organization.name}
  .card-body
    .row
      .col-md-8
        - current_access = @person.person_organization_accesses.find_by(organization: current_organization)
        - if current_access
          .table-responsive
            %table.table.table-hover
              %thead
                %tr
                  %th Permission Type
                  %th Status
                  %th Source
              %tbody
                %tr
                  %td Employment Management
                  %td
                    - if current_access.can_manage_employment?
                      %span.badge.bg-success ALLOWED
                    - elsif current_access.can_manage_employment.nil?
                      - if current_organization.parent
                        %span.badge.bg-warning INHERITED
                      - else
                        %span.badge.bg-danger BLOCKED
                    - else
                      %span.badge.bg-danger BLOCKED
                  %td
                    - if current_access.can_manage_employment.nil?
                      - if current_organization.parent
                        - parent_access = @person.person_organization_accesses.find_by(organization: current_organization.parent)
                        - if parent_access&.can_manage_employment?
                          %span.text-muted Inherited from #{current_organization.parent.name} (ALLOWED)
                        - else
                          %span.text-muted Inherited from #{current_organization.parent.name} (BLOCKED)
                      - else
                        %span.text-muted No parent organization (BLOCKED)
                    - else
                      %span.text-muted Direct
                %tr
                  %td Employment Creation
                  %td
                    - if current_access.can_create_employment?
                      %span.badge.bg-success ALLOWED
                    - elsif current_access.can_create_employment.nil?
                      - if current_organization.parent
                        %span.badge.bg-warning INHERITED
                      - else
                        %span.badge.bg-danger BLOCKED
                    - else
                      %span.badge.bg-danger BLOCKED
                  %td
                    - if current_access.can_create_employment.nil?
                      - if current_organization.parent
                        - parent_access = @person.person_organization_accesses.find_by(organization: current_organization.parent)
                        - if parent_access&.can_create_employment?
                          %span.text-muted Inherited from #{current_organization.parent.name} (ALLOWED)
                        - else
                          %span.text-muted Inherited from #{current_organization.parent.name} (BLOCKED)
                      - else
                        %span.text-muted No parent organization (BLOCKED)
                    - else
                      %span.text-muted Direct
                %tr
                  %td MAAP Management
                  %td
                    - if current_access.can_manage_maap?
                      %span.badge.bg-success ALLOWED
                    - elsif current_access.can_manage_maap.nil?
                      - if current_organization.parent
                        %span.badge.bg-warning INHERITED
                      - else
                        %span.badge.bg-danger BLOCKED
                    - else
                      %span.badge.bg-danger BLOCKED
                  %td
                    - if current_access.can_manage_maap.nil?
                      - if current_organization.parent
                        - parent_access = @person.person_organization_accesses.find_by(organization: current_organization.parent)
                        - if parent_access&.can_manage_maap?
                          %span.text-muted Inherited from #{current_organization.parent.name} (ALLOWED)
                        - else
                          %span.text-muted Inherited from #{current_organization.parent.name} (BLOCKED)
                      - else
                        %span.text-muted No parent organization (BLOCKED)
                    - else
                      %span.text-muted Direct
        - else
          %p.text-muted No permissions set for this organization.
      
      .col-md-4.border-start.border-secondary
        .d-grid.gap-2
          - can_modify = current_person.can_manage_employment?(current_organization)
          - if can_modify
            - if current_access
              = link_to edit_organization_person_access_path(current_organization, current_access), class: 'btn btn-warning' do
                %i.bi.bi-pencil.me-2
                Modify Permissions
            - else
              = link_to new_organization_person_access_path(current_organization), class: 'btn btn-success' do
                %i.bi.bi-plus.me-2
                Add Organization Permission
          - else
            .d-flex.align-items-center.gap-2
              .flex-grow-1
                %button.btn.btn-outline-secondary.w-100.disabled{disabled: true}
                  %i.bi.bi-pencil.me-2
                  Modify Permissions
              %i.bi.bi-exclamation-triangle.text-warning{ data: { bs_toggle: "tooltip", bs_title: "You need employment management permissions in this organization to modify permissions" } }
