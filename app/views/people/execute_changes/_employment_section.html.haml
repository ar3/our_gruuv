.card.mb-4
  .card-header
    .d-flex.justify-content-between.align-items-center
      %h5.mb-0 Employment
      - if employment_has_changes?
        %span.badge.bg-warning Changes
      - else
        %span.badge.bg-success No Changes
  .card-body
    - if employment_has_changes?
      .table-responsive
        %table.table.table-sm.table-borderless
          %thead
            %tr
              %th{style: "width: 30%"} Field
              %th{style: "width: 70%"} Change
          
          %tbody
            - if maap_snapshot.maap_data['employment_tenure']
              - employment = maap_snapshot.maap_data['employment_tenure']
              
              / Position
              %tr
                %td
                  %strong Position
                %td
                  - current_position = @current_employment&.position&.display_name || 'Not set'
                  - proposed_position = employment['position_id'] ? Position.find(employment['position_id']).display_name : 'Not set'
                  - if current_position != proposed_position
                    %span.badge.bg-warning.me-2 CHANGED
                    %span.text-muted #{current_position} 
                    %i.bi.bi-arrow-right.mx-1
                    %span.text-primary #{proposed_position}
                  - else
                    %span.text-muted #{current_position} (unchanged)
              
              / Manager
              %tr
                %td
                  %strong Manager
                %td
                  - current_manager = @current_employment&.manager&.display_name || 'Not set'
                  - proposed_manager = employment['manager_id'] ? Person.find(employment['manager_id']).display_name : 'Not set'
                  - if current_manager != proposed_manager
                    %span.badge.bg-warning.me-2 CHANGED
                    %span.text-muted #{current_manager} 
                    %i.bi.bi-arrow-right.mx-1
                    %span.text-primary #{proposed_manager}
                  - else
                    %span.text-muted #{current_manager} (unchanged)
              
              / Started Date
              %tr
                %td
                  %strong Started Date
                %td
                  - current_started = @current_employment&.started_at&.strftime('%Y-%m-%d') || 'Not set'
                  - proposed_started = employment['started_at'] || 'Not set'
                  - if current_started != proposed_started
                    %span.badge.bg-warning.me-2 CHANGED
                    %span.text-muted #{current_started} 
                    %i.bi.bi-arrow-right.mx-1
                    %span.text-primary #{proposed_started}
                  - else
                    %span.text-muted #{current_started} (unchanged)
              
              / Seat
              %tr
                %td
                  %strong Seat
                %td
                  - current_seat = @current_employment&.seat&.name || 'Not set'
                  - proposed_seat = employment['seat_id'] ? employment['seat_id'] : 'Not set'
                  - if current_seat != proposed_seat
                    %span.badge.bg-warning.me-2 CHANGED
                    %span.text-muted #{current_seat} 
                    %i.bi.bi-arrow-right.mx-1
                    %span.text-primary #{proposed_seat}
                  - else
                    %span.text-muted #{current_seat} (unchanged)
    - else
      / Show employment values in collapsible section when no changes
      .accordion#employmentNoChangesAccordion
        .accordion-item
          %h2.accordion-header#employmentNoChangesHeader
            %button.accordion-button.collapsed{"aria-controls" => "employmentNoChangesCollapse", "aria-expanded" => "false", "data-bs-target" => "#employmentNoChangesCollapse", "data-bs-toggle" => "collapse", :type => "button"}
              %i.bi.bi-chevron-down.me-2
              Employment Details (No Changes)
          .accordion-collapse.collapse#employmentNoChangesCollapse{"aria-labelledby" => "employmentNoChangesHeader", "data-bs-parent" => "#employmentNoChangesAccordion"}
            .accordion-body
              .table-responsive
                %table.table.table-sm.table-borderless
                  %thead
                    %tr
                      %th{style: "width: 30%"} Field
                      %th{style: "width: 70%"} Value
                  
                  %tbody
                    - if @current_employment
                      / Position
                      %tr
                        %td
                          %strong Position
                        %td
                          %span.text-muted #{@current_employment.position.display_name}
                      
                      / Manager
                      %tr
                        %td
                          %strong Manager
                        %td
                          %span.text-muted #{@current_employment.manager&.display_name || 'Not set'}
                      
                      / Started Date
                      %tr
                        %td
                          %strong Started Date
                        %td
                          %span.text-muted #{@current_employment.started_at.strftime('%Y-%m-%d')}
                      
                      / Seat
                      %tr
                        %td
                          %strong Seat
                        %td
                          %span.text-muted #{@current_employment.seat&.name || 'Not set'}
                    - else
                      %tr
                        %td{colspan: 2}
                          %span.text-muted No current employment