.card.mb-4
  .card-header
    .d-flex.justify-content-between.align-items-center
      %h5.mb-0 Assignments
      - assignment_changes_count = @assignment_data.count { |data| assignment_has_changes?(data[:assignment]) }
      - if assignment_changes_count > 0
        %span.badge.bg-warning #{assignment_changes_count} Change#{'s' if assignment_changes_count != 1}
      - else
        %span.badge.bg-success No Changes
  .card-body
    - assignments_with_changes = @assignment_data.select { |data| assignment_has_changes?(data[:assignment]) }
    - assignments_without_changes = @assignment_data.reject { |data| assignment_has_changes?(data[:assignment]) }
    
    / Show assignments with changes
    - if assignments_with_changes.any?
      - assignments_with_changes.each do |data|
        = render 'people/execute_changes/assignment_field_changes', data: data, maap_snapshot: @maap_snapshot
    
    / Collapsible section for assignments without changes
    - if assignments_without_changes.any?
      .accordion#assignmentsNoChangesAccordion
        .accordion-item
          %h2.accordion-header#assignmentsNoChangesHeader
            %button.accordion-button.collapsed{"aria-controls" => "assignmentsNoChangesCollapse", "aria-expanded" => "false", "data-bs-target" => "#assignmentsNoChangesCollapse", "data-bs-toggle" => "collapse", :type => "button"}
              %i.bi.bi-chevron-down.me-2
              Assignments with No Changes (#{assignments_without_changes.count})
          .accordion-collapse.collapse#assignmentsNoChangesCollapse{"aria-labelledby" => "assignmentsNoChangesHeader", "data-bs-parent" => "#assignmentsNoChangesAccordion"}
            .accordion-body
              - assignments_without_changes.each do |data|
                - assignment = data[:assignment]
                - current_tenure = data[:active_tenure]
                .assignment-no-change-item.mb-3.p-2.bg-light.rounded
                  %h6= assignment.title
                  - if current_tenure
                    %p.mb-0
                      %strong Energy: 
                      = "#{current_tenure.anticipated_energy_percentage}%"
                      %span.text-muted.ms-2 (No changes)
                  - else
                    %p.text-muted.mb-0 No active tenure