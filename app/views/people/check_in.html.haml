- content_for :go_back_link do
  = link_to person_path(@person), class: "go-back-link" do
    %i.bi.bi-arrow-left.me-2
    Back to #{@person.display_name}'s Profile

- content_for :header do
  .d-flex.justify-content-between.align-items-center
    %h1.mb-0 Check-In Mode for #{@person.display_name}
    = link_to person_assignment_tenures_path(@person), class: "btn btn-primary" do
      %i.bi.bi-clipboard-check.me-2
      Manage Assignments

- content_for :header_action do
  %button.btn.btn-outline-secondary{"data-bs-toggle" => "modal", "data-bs-target" => "#checkInFilterModal", type: "button"}
    %i.bi.bi-funnel.me-2
    Filter & Sort

.row.justify-content-center
  .col-lg-12
    / Assignment Check-ins Finalization Section
    .card.mb-4
      .card-header
        %h5.mb-0
          %i.bi.bi-clipboard-check.me-2
          Assignment Check-ins Ready for Finalization
      .card-body
        - if @ready_for_finalization.any?
          - @ready_for_finalization.each do |check_in|
            .assignment-finalization.mb-4.p-3.border.rounded
              .row
                .col-md-8
                  %h6.mb-2= check_in.assignment.title
                  %small.text-muted
                    Check-in started: #{check_in.check_in_started_on.strftime('%B %d, %Y')}
                    %br
                    Employee completed: #{check_in.employee_completed_at.strftime('%B %d, %Y at %l:%M %p')}
                    %br
                    Manager completed: #{check_in.manager_completed_at.strftime('%B %d, %Y at %l:%M %p')}
                  
                  .row.mt-3
                    .col-md-6
                      %h6.text-primary Employee's Input
                      %p.mb-1
                        %strong Actual Energy:
                        = "#{check_in.actual_energy_percentage}%" if check_in.actual_energy_percentage.present?
                      %p.mb-1
                        %strong Personal Alignment:
                        = check_in.employee_personal_alignment&.humanize if check_in.employee_personal_alignment.present?
                      %p.mb-1
                        %strong Rating:
                        = check_in.employee_rating&.humanize if check_in.employee_rating.present?
                    
                    .col-md-6
                      %h6.text-success Manager's Input
                      %p.mb-1
                        %strong Rating:
                        = check_in.manager_rating&.humanize if check_in.manager_rating.present?
                      %p.mb-1
                        %strong Private Notes:
                        = check_in.employee_private_notes if check_in.employee_private_notes.present?
                  
                  .row.mt-3
                    .col-12
                      = form_with url: finalize_check_in_person_path(@person), method: :patch, local: true do |form|
                        = form.hidden_field :check_in_id, value: check_in.id
                        .mb-3
                          = form.label :shared_notes, "Shared Notes (visible to both parties)", class: "form-label"
                          = form.text_area :shared_notes, value: check_in.shared_notes, rows: 3, class: "form-control", placeholder: "Notes that both employee and manager can see..."
                        
                        .mb-3
                          = form.label :final_rating, "Final Rating", class: "form-label"
                          %span.text-danger *
                          = form.select :final_rating, options_for_select([ ['Working to Meet Expectations', 'working_to_meet'], ['Meeting Expectations', 'meeting'], ['Exceeding Expectations', 'exceeding'] ], check_in.manager_rating), { prompt: 'Select final rating...' }, { class: "form-select", required: true }
                        
                        = form.submit "Finalize Check-in", class: "btn btn-success"
        - else
          .alert.alert-info
            %h6.mb-2
              %i.bi.bi-info-circle.me-2
              No Check-ins Ready for Finalization
            %p.mb-2 No assignment check-ins are ready for finalization yet. Both employee and manager must complete their sections first.
            = link_to "Manage Assignments", person_assignment_tenures_path(@person), class: "btn btn-primary btn-sm"

    / Coming Soon Sections
    .row
      .col-md-4
        .card.mb-4
          .card-header
            %h5.mb-0
              %i.bi.bi-chat-dots.me-2
              Discussion Topics
          .card-body
            .text-center.py-4
              %i.bi.bi-construction.text-muted{style: "font-size: 2rem;"}
              %p.text-muted.mt-2 Coming Soon
              %small.text-muted Discussion topics for 1:1 meetings

      .col-md-4
        .card.mb-4
          .card-header
            %h5.mb-0
              %i.bi.bi-target.me-2
              Personal Goals
          .card-body
            .text-center.py-4
              %i.bi.bi-construction.text-muted{style: "font-size: 2rem;"}
              %p.text-muted.mt-2 Coming Soon
              %small.text-muted Personal development goals

      .col-md-4
        .card.mb-4
          .card-header
            %h5.mb-0
              %i.bi.bi-list-check.me-2
              TODOs
          .card-body
            .text-center.py-4
              %i.bi.bi-construction.text-muted{style: "font-size: 2rem;"}
              %p.text-muted.mt-2 Coming Soon
              %small.text-muted Action items and follow-ups

/ Modal for Filter & Sort
#checkInFilterModal.modal.fade{"aria-hidden" => "true", "aria-labelledby" => "checkInFilterModalLabel", tabindex: "-1"}
  .modal-dialog.modal-lg
    .modal-content
      .modal-header
        %h5.modal-title#checkInFilterModalLabel
          %i.bi.bi-funnel.me-2
          Filter & Sort Check-ins (coming soon)
        %button.btn-close{"aria-label" => "Close", "data-bs-dismiss" => "modal", type: "button"}
      .modal-body
        .row
          .col-md-6
            %h6.mb-3
              %i.bi.bi-funnel.me-2
              Filters
            .mb-3
              %label.form-label Assignment
              %select.form-select
                %option All Assignments
                %option Employee Growth Plan Champion
                %option Quarterly Conversation Coordinator
                %option Learning Librarian
            .mb-3
              %label.form-label Completion Status
              .form-check
                %input.form-check-input{checked: "checked", type: "checkbox", name: "status", value: "ready"}
                %label.form-check-label Ready for Finalization
              .form-check
                %input.form-check-input{type: "checkbox", name: "status", value: "completed"}
                %label.form-check-label Completed
          .col-md-6
            %h6.mb-3
              %i.bi.bi-sort-down.me-2
              Sort Options
            .mb-3
              %label.form-label Sort By
              %select.form-select
                %option Check-in Date
                %option Assignment Name
                %option Completion Date
            .mb-3
              %label.form-label View Style
              .form-check
                %input.form-check-input{checked: "checked", type: "radio", name: "viewStyle", value: "cards"}
                %label.form-check-label
                  %i.bi.bi-grid.me-2
                  Card View
              .form-check
                %input.form-check-input{type: "radio", name: "viewStyle", value: "table"}
                %label.form-check-label
                  %i.bi.bi-table.me-2
                  Table View
      .modal-footer
        %button.btn.btn-secondary{"data-bs-dismiss" => "modal", type: "button"} Cancel
        %button.btn.btn-primary.disabled{type: "button"}
          %i.bi.bi-check.me-2
          Apply Filters
